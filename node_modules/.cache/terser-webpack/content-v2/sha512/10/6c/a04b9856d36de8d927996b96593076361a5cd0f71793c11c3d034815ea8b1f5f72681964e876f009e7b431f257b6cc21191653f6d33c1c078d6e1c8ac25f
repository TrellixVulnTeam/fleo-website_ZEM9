{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{RQpc:function(e,t,n){\"use strict\";n.r(t),n.d(t,\"PostsModule\",function(){return ft});var r=n(\"tyNb\"),o=n(\"ofXK\"),i=n(\"8PDw\"),a=n(\"lJxs\"),s=n(\"fXoL\"),u=n(\"I/3d\"),c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l=function(){function e(e){this.afs=e,this.postsCollection=this.afs.collection(\"posts\",function(e){return e.orderBy(\"published\",\"desc\")})}return e.prototype.getPosts=function(){return this.postsCollection.snapshotChanges().pipe(Object(a.a)(function(e){return e.map(function(e){var t=e.payload.doc.data();return c({id:e.payload.doc.id},t)})}))},e.prototype.getPostData=function(e){return this.postDoc=this.afs.doc(\"posts/\"+e),this.postDoc.valueChanges()},e.prototype.getPost=function(e){return this.afs.doc(\"posts/\"+e)},e.prototype.create=function(e){this.postsCollection.add(e)},e.prototype.delete=function(e){return this.getPost(e).delete()},e.prototype.update=function(e,t){return this.getPost(e).update(t)},e.\\u0275fac=function(t){return new(t||e)(s.bc(u.a))},e.\\u0275prov=s.Lb({token:e,factory:e.\\u0275fac}),e}(),h=n(\"1OyB\"),p=n(\"vuIU\"),f=n(\"HDdC\"),d=n(\"LRne\"),b=n(\"Cfvw\"),g=n(\"Kj3r\"),_=n(\"pxpQ\"),m=n(\"eIep\"),v=n(\"spgP\"),y=n(\"zIRd\"),w=n(\"mrSG\"),R=n(\"qOnz\"),T=n(\"/6Yf\"),O=\"firebasestorage.googleapis.com\",k=function(e){function t(n,r){var o=e.call(this,U(n),\"Firebase Storage: \"+r+\" (\"+U(n)+\")\")||this;return o.customData={serverResponse:null},Object.setPrototypeOf(o,t.prototype),o}return Object(w.d)(t,e),t.prototype._codeEquals=function(e){return U(e)===this.code},Object.defineProperty(t.prototype,\"message\",{get:function(){return this.customData.serverResponse?this.message+\"\\n\"+this.customData.serverResponse:this.message},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"serverResponse\",{get:function(){return this.customData.serverResponse},set:function(e){this.customData.serverResponse=e},enumerable:!1,configurable:!0}),t}(R.c);function U(e){return\"storage/\"+e}function P(){return new k(\"unknown\",\"An unknown error occurred, please check the error payload for server response.\")}function x(){return new k(\"canceled\",\"User canceled the upload/download.\")}function C(){return new k(\"cannot-slice-blob\",\"Cannot slice blob for upload. Please retry the upload.\")}function S(e){return new k(\"invalid-argument\",e)}function j(){return new k(\"app-deleted\",\"The Firebase app was deleted.\")}function I(e){return new k(\"invalid-root-operation\",\"The operation '\"+e+\"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').\")}function E(e,t){return new k(\"invalid-format\",\"String does not match format '\"+e+\"': \"+t)}function A(e){throw new k(\"internal-error\",\"Internal error: \"+e)}var M={RAW:\"raw\",BASE64:\"base64\",BASE64URL:\"base64url\",DATA_URL:\"data_url\"},L=function(){return function(e,t){this.data=e,this.contentType=t||null}}();function D(e,t){switch(e){case M.RAW:return new L(F(t));case M.BASE64:case M.BASE64URL:return new L(q(e,t));case M.DATA_URL:return new L((n=new N(t)).base64?q(M.BASE64,n.rest):function(e){var t;try{t=decodeURIComponent(e)}catch(n){throw E(M.DATA_URL,\"Malformed data URL.\")}return F(t)}(n.rest),new N(t).contentType)}var n;throw P()}function F(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<e.length-1&&56320==(64512&e.charCodeAt(n+1))){var o=r,i=e.charCodeAt(++n);t.push(240|(r=65536|(1023&o)<<10|1023&i)>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189);else 56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function q(e,t){switch(e){case M.BASE64:var n=-1!==t.indexOf(\"-\"),r=-1!==t.indexOf(\"_\");if(n||r)throw E(e,\"Invalid character '\"+(n?\"-\":\"_\")+\"' found: is it base64url encoded?\");break;case M.BASE64URL:var o=-1!==t.indexOf(\"+\"),i=-1!==t.indexOf(\"/\");if(o||i)throw E(e,\"Invalid character '\"+(o?\"+\":\"/\")+\"' found: is it base64 encoded?\");t=t.replace(/-/g,\"+\").replace(/_/g,\"/\")}var a;try{a=atob(t)}catch(c){throw E(e,\"Invalid character found\")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var N=function(){return function(e){this.base64=!1,this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw E(M.DATA_URL,\"Must be formatted 'data:[<mediatype>][;base64],<data>\");var n,r,o=t[1]||null;null!=o&&(this.base64=(n=o).length>=(r=\";base64\").length&&n.substring(n.length-r.length)===r,this.contentType=this.base64?o.substring(0,o.length-\";base64\".length):o),this.rest=e.substring(e.indexOf(\",\")+1)}}(),B={RUNNING:\"running\",PAUSED:\"paused\",SUCCESS:\"success\",CANCELED:\"canceled\",ERROR:\"error\"};function z(e){switch(e){case\"running\":case\"pausing\":case\"canceling\":return B.RUNNING;case\"paused\":return B.PAUSED;case\"success\":return B.SUCCESS;case\"canceled\":return B.CANCELED;case\"error\":default:return B.ERROR}}var H=function(e){return e[e.NO_ERROR=0]=\"NO_ERROR\",e[e.NETWORK_ERROR=1]=\"NETWORK_ERROR\",e[e.ABORT=2]=\"ABORT\",e}({}),G=function(){function e(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=H.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener(\"abort\",function(){e.errorCode_=H.ABORT,t(e)}),e.xhr_.addEventListener(\"error\",function(){e.errorCode_=H.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener(\"load\",function(){t(e)})})}return e.prototype.send=function(e,t,n,r){if(this.sent_)throw A(\"cannot .send() more than once\");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(var o in r)r.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,r[o].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},e.prototype.getErrorCode=function(){if(!this.sent_)throw A(\"cannot .getErrorCode() before sending\");return this.errorCode_},e.prototype.getStatus=function(){if(!this.sent_)throw A(\"cannot .getStatus() before sending\");try{return this.xhr_.status}catch(e){return-1}},e.prototype.getResponseText=function(){if(!this.sent_)throw A(\"cannot .getResponseText() before sending\");return this.xhr_.responseText},e.prototype.abort=function(){this.xhr_.abort()},e.prototype.getResponseHeader=function(e){return this.xhr_.getResponseHeader(e)},e.prototype.addUploadProgressListener=function(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener(\"progress\",e)},e.prototype.removeUploadProgressListener=function(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener(\"progress\",e)},e}(),X=function(){function e(){}return e.prototype.createXhrIo=function(){return new G},e}(),V=function(){function e(e,t){this.bucket=e,this.path_=t}return Object.defineProperty(e.prototype,\"path\",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"isRoot\",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),e.prototype.fullServerUrl=function(){var e=encodeURIComponent;return\"/b/\"+e(this.bucket)+\"/o/\"+e(this.path)},e.prototype.bucketOnlyServerUrl=function(){return\"/b/\"+encodeURIComponent(this.bucket)+\"/o\"},e.makeFromBucketSpec=function(t){var n;try{n=e.makeFromUrl(t)}catch(r){return new e(t,\"\")}if(\"\"===n.path)return n;throw new k(\"invalid-default-bucket\",\"Invalid default bucket '\"+t+\"'.\")},e.makeFromUrl=function(t){var n=null,r=\"([A-Za-z0-9.\\\\-_]+)\",o=new RegExp(\"^gs://\"+r+\"(/(.*))?$\",\"i\");function i(e){e.path_=decodeURIComponent(e.path)}for(var a=O.replace(/[.]/g,\"\\\\.\"),s=[{regex:o,indices:{bucket:1,path:3},postModify:function(e){\"/\"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(\"^https?://\"+a+\"/v[A-Za-z0-9_]+/b/\"+r+\"/o(/([^?#]*).*)?$\",\"i\"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp(\"^https?://(?:storage.googleapis.com|storage.cloud.google.com)/\"+r+\"/([^?#]*)\",\"i\"),indices:{bucket:1,path:2},postModify:i}],u=0;u<s.length;u++){var c=s[u],l=c.regex.exec(t);if(l){var h=l[c.indices.path];h||(h=\"\"),n=new e(l[c.indices.bucket],h),c.postModify(n);break}}if(null==n)throw function(e){return new k(\"invalid-url\",\"Invalid URL '\"+e+\"'.\")}(t);return n},e}(),Q=function(){function e(e){this.promise_=Promise.reject(e)}return e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){},e}();function W(e){return\"string\"==typeof e||e instanceof String}function J(e){return K()&&e instanceof Blob}function K(){return\"undefined\"!=typeof Blob}function $(e,t,n,r){if(r<t)throw S(\"Invalid value for '\"+e+\"'. Expected \"+t+\" or greater.\");if(r>n)throw S(\"Invalid value for '\"+e+\"'. Expected \"+n+\" or less.\")}function Y(e){return\"https://\"+O+\"/v0\"+e}function Z(e){var t=encodeURIComponent,n=\"?\";for(var r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+\"=\")+t(e[r])+\"&\");return n.slice(0,-1)}var ee=function(){function e(e,t,n,r,o,i,a,s,u,c,l){var h=this;this.pendingXhr_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=o.slice(),this.additionalRetryCodes_=i.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=l,this.promise_=new Promise(function(e,t){h.resolve_=e,h.reject_=t,h.start_()})}return e.prototype.start_=function(){var e=this;function t(t,n){var r,o=e.resolve_,i=e.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=e.callback_(a,a.getResponseText());void 0!==s?o(s):o()}catch(u){i(u)}else null!==a?((r=P()).serverResponse=a.getResponseText(),i(e.errorCallback_?e.errorCallback_(a,r):r)):i(r=n.canceled?e.appDelete_?j():x():new k(\"retry-limit-exceeded\",\"Max retry time for operation exceeded, please try again.\"))}this.canceled_?t(0,new te(!1,null,!0)):this.backoffId_=function(t,n,r){var o=1,i=null,a=!1,s=0;function u(){return 2===s}var c=!1;function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c||(c=!0,n.apply(null,e))}function h(t){i=setTimeout(function(){i=null,function(t,n){if(n)t(!1,new te(!1,null,!0));else{var r=e.pool_.createXhrIo();e.pendingXhr_=r,null!==e.progressCallback_&&r.addUploadProgressListener(o),r.send(e.url_,e.method_,e.body_,e.headers_).then(function(n){null!==e.progressCallback_&&n.removeUploadProgressListener(o),e.pendingXhr_=null;var r=(n=n).getErrorCode()===H.NO_ERROR,i=n.getStatus();if(r&&!e.isRetryStatusCode_(i)){var a=-1!==e.successCodes_.indexOf(i);t(!0,new te(a,n))}else{var s=n.getErrorCode()===H.ABORT;t(!1,new te(!1,null,s))}})}function o(t){null!==e.progressCallback_&&e.progressCallback_(t.loaded,t.lengthComputable?t.total:-1)}}(p,u())},t)}function p(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!c)if(e)l.call.apply(l,Object(w.h)([null,e],t));else{var r;u()||a?l.call.apply(l,Object(w.h)([null,e],t)):(o<64&&(o*=2),1===s?(s=2,r=0):r=1e3*(o+Math.random()),h(r))}}var f=!1;function d(e){f||(f=!0,c||(null!==i?(e||(s=2),clearTimeout(i),h(0)):e||(s=1)))}return h(0),setTimeout(function(){a=!0,d(!0)},r),d}(0,t,this.timeout_)},e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},e.prototype.isRetryStatusCode_=function(e){var t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r},e}(),te=function(){return function(e,t,n){this.wasSuccessCode=e,this.xhr=t,this.canceled=!!n}}();function ne(){return\"undefined\"!=typeof BlobBuilder?BlobBuilder:\"undefined\"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function re(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ne();if(void 0!==n){for(var r=new n,o=0;o<e.length;o++)r.append(e[o]);return r.getBlob()}if(K())return new Blob(e);throw new k(\"unsupported-environment\",\"This browser doesn't seem to support creating Blobs\")}var oe=function(){function e(e,t){var n=0,r=\"\";J(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}return e.prototype.size=function(){return this.size_},e.prototype.type=function(){return this.type_},e.prototype.slice=function(t,n){if(J(this.data_)){var r=(i=t,a=n,(o=this.data_).webkitSlice?o.webkitSlice(i,a):o.mozSlice?o.mozSlice(i,a):o.slice?o.slice(i,a):null);return null===r?null:new e(r)}var o,i,a;return new e(new Uint8Array(this.data_.buffer,t,n-t),!0)},e.getBlob=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(K()){var r=t.map(function(t){return t instanceof e?t.data_:t});return new e(re.apply(null,r))}var o=t.map(function(e){return W(e)?D(M.RAW,e).data:e.data_}),i=0;o.forEach(function(e){i+=e.byteLength});var a=new Uint8Array(i),s=0;return o.forEach(function(e){for(var t=0;t<e.length;t++)a[s++]=e[t]}),new e(a,!0)},e.prototype.uploadData=function(){return this.data_},e}();function ie(e){var t,n;try{t=JSON.parse(e)}catch(r){return null}return\"object\"!=typeof(n=t)||Array.isArray(n)?null:t}function ae(e){var t=e.lastIndexOf(\"/\",e.length-2);return-1===t?e:e.slice(t+1)}function se(e,t){return t}var ue=function(){return function(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||se}}(),ce=null;function le(){if(ce)return ce;var e=[];e.push(new ue(\"bucket\")),e.push(new ue(\"generation\")),e.push(new ue(\"metageneration\")),e.push(new ue(\"name\",\"fullPath\",!0));var t=new ue(\"name\");t.xform=function(e,t){return function(e){return!W(e)||e.length<2?e:ae(e)}(t)},e.push(t);var n=new ue(\"size\");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new ue(\"timeCreated\")),e.push(new ue(\"updated\")),e.push(new ue(\"md5Hash\",null,!0)),e.push(new ue(\"cacheControl\",null,!0)),e.push(new ue(\"contentDisposition\",null,!0)),e.push(new ue(\"contentEncoding\",null,!0)),e.push(new ue(\"contentLanguage\",null,!0)),e.push(new ue(\"contentType\",null,!0)),e.push(new ue(\"metadata\",\"customMetadata\",!0)),ce=e}function he(e,t,n){var r=ie(t);return null===r?null:function(e,t,n){for(var r={type:\"file\"},o=n.length,i=0;i<o;i++){var a=n[i];r[a.local]=a.xform(r,t[a.server])}return function(e,t){Object.defineProperty(e,\"ref\",{get:function(){var n=new V(e.bucket,e.fullPath);return t._makeStorageReference(n)}})}(r,e),r}(e,r,n)}function pe(e,t){for(var n={},r=t.length,o=0;o<r;o++){var i=t[o];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}var fe=function(){return function(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();function de(e){if(!e)throw P()}function be(e,t){return function(n,r){var o=he(e,r,t);return de(null!==o),o}}function ge(e){return function(t,n){var r;return(r=401===t.getStatus()?new k(\"unauthenticated\",\"User is not authenticated, please authenticate using Firebase Authentication and try again.\"):402===t.getStatus()?new k(\"quota-exceeded\",\"Quota for bucket '\"+e.bucket+\"' exceeded, please view quota on https://firebase.google.com/pricing/.\"):403===t.getStatus()?new k(\"unauthorized\",\"User does not have permission to access '\"+e.path+\"'.\"):n).serverResponse=n.serverResponse,r}}function _e(e){var t=ge(e);return function(n,r){var o=t(n,r);return 404===n.getStatus()&&(o=new k(\"object-not-found\",\"Object '\"+e.path+\"' does not exist.\")),o.serverResponse=r.serverResponse,o}}function me(e,t,n){var r=Y(t.fullServerUrl()),o=e.maxOperationRetryTime,i=new fe(r,\"GET\",be(e,n),o);return i.errorHandler=_e(t),i}function ve(e,t,n){var r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||\"application/octet-stream\"}(0,t)),r}var ye=function(){return function(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}();function we(e,t){var n=null;try{n=e.getResponseHeader(\"X-Goog-Upload-Status\")}catch(r){de(!1)}return de(!!n&&-1!==(t||[\"active\"]).indexOf(n)),n}var Re=262144,Te=function(){return function(e,t,n){if(\"function\"==typeof e||null!=t||null!=n)this.next=e,this.error=t,this.complete=n;else{var r=e;this.next=r.next,this.error=r.error,this.complete=r.complete}}}();function Oe(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Promise.resolve().then(function(){return e.apply(void 0,t)})}}var ke=function(){function e(e,t,n){var r=this;void 0===n&&(n=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=le(),this._resumable=this._shouldDoResumable(this._blob),this._state=\"running\",this._errorHandler=function(e){r._request=void 0,r._chunkMultiplier=1,e._codeEquals(\"canceled\")?(r._needToFetchStatus=!0,r.completeTransitions_()):(r._error=e,r._transition(\"error\"))},this._metadataErrorHandler=function(e){r._request=void 0,e._codeEquals(\"canceled\")?r.completeTransitions_():(r._error=e,r._transition(\"error\"))},this._promise=new Promise(function(e,t){r._resolve=e,r._reject=t,r._start()}),this._promise.then(null,function(){})}return e.prototype._makeProgressCallback=function(){var e=this,t=this._transferred;return function(n){return e._updateProgress(t+n)}},e.prototype._shouldDoResumable=function(e){return e.size()>262144},e.prototype._start=function(){\"running\"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},e.prototype._resolveToken=function(e){var t=this;this._ref.storage._getAuthToken().then(function(n){switch(t._state){case\"running\":e(n);break;case\"canceling\":t._transition(\"canceled\");break;case\"pausing\":t._transition(\"paused\")}})},e.prototype._createResumable=function(){var e=this;this._resolveToken(function(t){var n=function(e,t,n,r,o){var i=t.bucketOnlyServerUrl(),a=ve(t,r,o),s={name:a.fullPath},u=Y(i),c={\"X-Goog-Upload-Protocol\":\"resumable\",\"X-Goog-Upload-Command\":\"start\",\"X-Goog-Upload-Header-Content-Length\":r.size(),\"X-Goog-Upload-Header-Content-Type\":a.contentType,\"Content-Type\":\"application/json; charset=utf-8\"},l=pe(a,n),h=new fe(u,\"POST\",function(e){var t;we(e);try{t=e.getResponseHeader(\"X-Goog-Upload-URL\")}catch(n){de(!1)}return de(W(t)),t},e.maxUploadRetryTime);return h.urlParams=s,h.headers=c,h.body=l,h.errorHandler=ge(t),h}(e._ref.storage,e._ref._location,e._mappings,e._blob,e._metadata),r=e._ref.storage._makeRequest(n,t);e._request=r,r.getPromise().then(function(t){e._request=void 0,e._uploadUrl=t,e._needToFetchStatus=!1,e.completeTransitions_()},e._errorHandler)})},e.prototype._fetchStatus=function(){var e=this,t=this._uploadUrl;this._resolveToken(function(n){var r=function(e,t,n,r){var o=new fe(n,\"POST\",function(e){var t=we(e,[\"active\",\"final\"]),n=null;try{n=e.getResponseHeader(\"X-Goog-Upload-Size-Received\")}catch(i){de(!1)}n||de(!1);var o=Number(n);return de(!isNaN(o)),new ye(o,r.size(),\"final\"===t)},e.maxUploadRetryTime);return o.headers={\"X-Goog-Upload-Command\":\"query\"},o.errorHandler=ge(t),o}(e._ref.storage,e._ref._location,t,e._blob),o=e._ref.storage._makeRequest(r,n);e._request=o,o.getPromise().then(function(t){t=t,e._request=void 0,e._updateProgress(t.current),e._needToFetchStatus=!1,t.finalized&&(e._needToFetchMetadata=!0),e.completeTransitions_()},e._errorHandler)})},e.prototype._continueUpload=function(){var e=this,t=Re*this._chunkMultiplier,n=new ye(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken(function(o){var i;try{i=function(e,t,n,r,o,i,a,s){var u=new ye(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new k(\"server-file-wrong-size\",\"Server recorded incorrect upload file size, please retry the upload.\");var c=u.total-u.current,l=c;o>0&&(l=Math.min(l,o));var h=u.current,p={\"X-Goog-Upload-Command\":l===c?\"upload, finalize\":\"upload\",\"X-Goog-Upload-Offset\":u.current},f=r.slice(h,h+l);if(null===f)throw C();var d=new fe(n,\"POST\",function(e,n){var o,a=we(e,[\"active\",\"final\"]),s=u.current+l,c=r.size();return o=\"final\"===a?be(t,i)(e,n):null,new ye(s,c,\"final\"===a,o)},t.maxUploadRetryTime);return d.headers=p,d.body=f.uploadData(),d.progressCallback=s||null,d.errorHandler=ge(e),d}(e._ref._location,e._ref.storage,r,e._blob,t,e._mappings,n,e._makeProgressCallback())}catch(s){return e._error=s,void e._transition(\"error\")}var a=e._ref.storage._makeRequest(i,o);e._request=a,a.getPromise().then(function(t){e._increaseMultiplier(),e._request=void 0,e._updateProgress(t.current),t.finalized?(e._metadata=t.metadata,e._transition(\"success\")):e.completeTransitions_()},e._errorHandler)})},e.prototype._increaseMultiplier=function(){Re*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},e.prototype._fetchMetadata=function(){var e=this;this._resolveToken(function(t){var n=me(e._ref.storage,e._ref._location,e._mappings),r=e._ref.storage._makeRequest(n,t);e._request=r,r.getPromise().then(function(t){e._request=void 0,e._metadata=t,e._transition(\"success\")},e._metadataErrorHandler)})},e.prototype._oneShotUpload=function(){var e=this;this._resolveToken(function(t){var n=function(e,t,n,r,o){var i=t.bucketOnlyServerUrl(),a={\"X-Goog-Upload-Protocol\":\"multipart\"},s=function(){for(var e=\"\",t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a[\"Content-Type\"]=\"multipart/related; boundary=\"+s;var u=ve(t,r,o),c=pe(u,n),l=oe.getBlob(\"--\"+s+\"\\r\\nContent-Type: application/json; charset=utf-8\\r\\n\\r\\n\"+c+\"\\r\\n--\"+s+\"\\r\\nContent-Type: \"+u.contentType+\"\\r\\n\\r\\n\",r,\"\\r\\n--\"+s+\"--\");if(null===l)throw C();var h={name:u.fullPath},p=Y(i),f=e.maxUploadRetryTime,d=new fe(p,\"POST\",be(e,n),f);return d.urlParams=h,d.headers=a,d.body=l.uploadData(),d.errorHandler=ge(t),d}(e._ref.storage,e._ref._location,e._mappings,e._blob,e._metadata),r=e._ref.storage._makeRequest(n,t);e._request=r,r.getPromise().then(function(t){e._request=void 0,e._metadata=t,e._updateProgress(e._blob.size()),e._transition(\"success\")},e._errorHandler)})},e.prototype._updateProgress=function(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()},e.prototype._transition=function(e){if(this._state!==e)switch(e){case\"canceling\":case\"pausing\":this._state=e,void 0!==this._request&&this._request.cancel();break;case\"running\":var t=\"paused\"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case\"paused\":this._state=e,this._notifyObservers();break;case\"canceled\":this._error=x(),this._state=e,this._notifyObservers();break;case\"error\":case\"success\":this._state=e,this._notifyObservers()}},e.prototype.completeTransitions_=function(){switch(this._state){case\"pausing\":this._transition(\"paused\");break;case\"canceling\":this._transition(\"canceled\");break;case\"running\":this._start()}},Object.defineProperty(e.prototype,\"snapshot\",{get:function(){var e=z(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t,n,r){var o=this,i=new Te(t,n,r);return this._addObserver(i),function(){o._removeObserver(i)}},e.prototype.then=function(e,t){return this._promise.then(e,t)},e.prototype.catch=function(e){return this.then(null,e)},e.prototype._addObserver=function(e){this._observers.push(e),this._notifyObserver(e)},e.prototype._removeObserver=function(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)},e.prototype._notifyObservers=function(){var e=this;this._finishPromise(),this._observers.slice().forEach(function(t){e._notifyObserver(t)})},e.prototype._finishPromise=function(){if(void 0!==this._resolve){var e=!0;switch(z(this._state)){case B.SUCCESS:Oe(this._resolve.bind(null,this.snapshot))();break;case B.CANCELED:case B.ERROR:Oe(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}},e.prototype._notifyObserver=function(e){switch(z(this._state)){case B.RUNNING:case B.PAUSED:e.next&&Oe(e.next.bind(e,this.snapshot))();break;case B.SUCCESS:e.complete&&Oe(e.complete.bind(e))();break;case B.CANCELED:case B.ERROR:e.error&&Oe(e.error.bind(e,this._error))();break;default:e.error&&Oe(e.error.bind(e,this._error))()}},e.prototype.resume=function(){var e=\"paused\"===this._state||\"pausing\"===this._state;return e&&this._transition(\"running\"),e},e.prototype.pause=function(){var e=\"running\"===this._state;return e&&this._transition(\"pausing\"),e},e.prototype.cancel=function(){var e=\"running\"===this._state||\"pausing\"===this._state;return e&&this._transition(\"canceling\"),e},e}(),Ue=function(){function e(e,t){this._service=e,this._location=t instanceof V?t:V.makeFromUrl(t)}return e.prototype.toString=function(){return\"gs://\"+this._location.bucket+\"/\"+this._location.path},e.prototype._newRef=function(t,n){return new e(t,n)},Object.defineProperty(e.prototype,\"root\",{get:function(){var e=new V(this._location.bucket,\"\");return this._newRef(this._service,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"bucket\",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"fullPath\",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"name\",{get:function(){return ae(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"storage\",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"parent\",{get:function(){var t=function(e){if(0===e.length)return null;var t=e.lastIndexOf(\"/\");return-1===t?\"\":e.slice(0,t)}(this._location.path);if(null===t)return null;var n=new V(this._location.bucket,t);return new e(this._service,n)},enumerable:!1,configurable:!0}),e.prototype._throwIfRoot=function(e){if(\"\"===this._location.path)throw I(e)},e}();function Pe(e){var t={prefixes:[],items:[]};return xe(e,t).then(function(){return t})}function xe(e,t,n){return Object(w.b)(this,void 0,void 0,function(){var r,o,i;return Object(w.e)(this,function(a){switch(a.label){case 0:return[4,Ce(e,{pageToken:n})];case 1:return r=a.sent(),(o=t.prefixes).push.apply(o,r.prefixes),(i=t.items).push.apply(i,r.items),null==r.nextPageToken?[3,3]:[4,xe(e,t,r.nextPageToken)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function Ce(e,t){return Object(w.b)(this,void 0,void 0,function(){var n,r,o;return Object(w.e)(this,function(i){switch(i.label){case 0:return null!=t&&\"number\"==typeof t.maxResults&&$(\"options.maxResults\",1,1e3,t.maxResults),[4,e.storage._getAuthToken()];case 1:return n=i.sent(),o=function(e,t,n,r,o){var i={};i.prefix=t.isRoot?\"\":t.path+\"/\",n&&n.length>0&&(i.delimiter=n),r&&(i.pageToken=r),o&&(i.maxResults=o);var a=Y(t.bucketOnlyServerUrl()),s=e.maxOperationRetryTime,u=new fe(a,\"GET\",function(e,t){return function(n,r){var o=function(e,t,n){var r=ie(n);return null===r?null:function(e,t,n){var r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(var o=0,i=n.prefixes;o<i.length;o++){var a=i[o].replace(/\\/$/,\"\"),s=e._makeStorageReference(new V(t,a));r.prefixes.push(s)}if(n.items)for(var u=0,c=n.items;u<c.length;u++)s=e._makeStorageReference(new V(t,c[u].name)),r.items.push(s);return r}(e,t,r)}(e,t,r);return de(null!==o),o}}(e,t.bucket),s);return u.urlParams=i,u.errorHandler=ge(t),u}(e.storage,e._location,\"/\",(r=t||{}).pageToken,r.maxResults),[2,e.storage._makeRequest(o,n).getPromise()]}})})}function Se(e,t){var n=function(e,t){var n=t.split(\"/\").filter(function(e){return e.length>0}).join(\"/\");return 0===e.length?n:e+\"/\"+n}(e._location.path,t),r=new V(e._location.bucket,n);return new Ue(e.storage,r)}function je(e){return/^[A-Za-z]+:\\/\\//.test(e)}function Ie(e,t){if(e instanceof Ae){var n=e;if(null==n._bucket)throw new k(\"no-default-bucket\",\"No default bucket found. Did you set the 'storageBucket' property when initializing the app?\");var r=new Ue(n,n._bucket);return null!=t?Ie(r,t):r}if(void 0!==t){if(t.includes(\"..\"))throw S('`path` param cannot contain \"..\"');return Se(e,t)}return e}function Ee(e,t){if(t&&je(t)){if(e instanceof Ae)return new Ue(e,t);throw S(\"To use ref(service, url), the first argument must be a Storage instance.\")}return Ie(e,t)}var Ae=function(){function e(e,t,n,r,o){var i,a;this.app=e,this._authProvider=t,this._pool=n,this._url=r,this._firebaseVersion=o,this._bucket=null,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?V.makeFromBucketSpec(r):null==(a=null==(i=this.app.options)?void 0:i.storageBucket)?null:V.makeFromBucketSpec(a)}return Object.defineProperty(e.prototype,\"maxUploadRetryTime\",{get:function(){return this._maxUploadRetryTime},set:function(e){$(\"time\",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"maxOperationRetryTime\",{get:function(){return this._maxOperationRetryTime},set:function(e){$(\"time\",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e},enumerable:!1,configurable:!0}),e.prototype._getAuthToken=function(){return Object(w.b)(this,void 0,void 0,function(){var e,t;return Object(w.e)(this,function(n){switch(n.label){case 0:return(e=this._authProvider.getImmediate({optional:!0}))?[4,e.getToken()]:[3,2];case 1:if(null!==(t=n.sent()))return[2,t.accessToken];n.label=2;case 2:return[2,null]}})})},e.prototype._delete=function(){return this._deleted=!0,this._requests.forEach(function(e){return e.cancel()}),this._requests.clear(),Promise.resolve()},e.prototype._makeStorageReference=function(e){return new Ue(this,e)},e.prototype._makeRequest=function(e,t){var n=this;if(this._deleted)return new Q(j());var r=function(e,t,n,r,o){var i=Z(e.urlParams),a=e.url+i,s=Object.assign({},e.headers);return function(e,t){t&&(e[\"X-Firebase-GMPID\"]=t)}(s,t),function(e,t){null!==t&&t.length>0&&(e.Authorization=\"Firebase \"+t)}(s,n),function(e,t){e[\"X-Firebase-Storage-Version\"]=\"webjs/\"+(null!=t?t:\"AppManager\")}(s,o),new ee(a,e.method,s,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r)}(e,this._appId,t,this._pool,this._firebaseVersion);return this._requests.add(r),r.getPromise().then(function(){return n._requests.delete(r)},function(){return n._requests.delete(r)}),r},e}();function Me(e,t){return Ee(e,t)}var Le,De,Fe=function(){function e(e,t,n){this._delegate=e,this.task=t,this.ref=n}return Object.defineProperty(e.prototype,\"bytesTransferred\",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"metadata\",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"state\",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"totalBytes\",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),e}(),qe=function(){function e(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}return Object.defineProperty(e.prototype,\"snapshot\",{get:function(){return new Fe(this._delegate.snapshot,this,this._ref)},enumerable:!1,configurable:!0}),e.prototype.then=function(e,t){var n=this;return this._delegate.then(function(t){if(e)return e(new Fe(t,n,n._ref))},t)},e.prototype.on=function(e,t,n,r){var o=this,i=void 0;return t&&(i=\"function\"==typeof t?function(e){return t(new Fe(e,o,o._ref))}:{next:t.next?function(e){return t.next(new Fe(e,o,o._ref))}:void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)},e}(),Ne=function(){function e(e,t){this._delegate=e,this._service=t}return Object.defineProperty(e.prototype,\"prefixes\",{get:function(){var e=this;return this._delegate.prefixes.map(function(t){return new Be(t,e._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"items\",{get:function(){var e=this;return this._delegate.items.map(function(t){return new Be(t,e._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"nextPageToken\",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),e}(),Be=function(){function e(e,t){this._delegate=e,this.storage=t}return Object.defineProperty(e.prototype,\"name\",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"bucket\",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"fullPath\",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this._delegate.toString()},e.prototype.child=function(t){return new e(function(e,t){return Se(e,t)}(this._delegate,t),this.storage)},Object.defineProperty(e.prototype,\"root\",{get:function(){return new e(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"parent\",{get:function(){var t=this._delegate.parent;return null==t?null:new e(t,this.storage)},enumerable:!1,configurable:!0}),e.prototype.put=function(e,t){return this._throwIfRoot(\"put\"),new qe(function(e,t,n){return function(e,t,n){return e._throwIfRoot(\"uploadBytesResumable\"),new ke(e,new oe(t),n)}(e,t,n)}(this._delegate,e,t),this)},e.prototype.putString=function(e,t,n){void 0===t&&(t=M.RAW),this._throwIfRoot(\"putString\");var r=D(t,e),o=Object(w.a)({},n);return null==o.contentType&&null!=r.contentType&&(o.contentType=r.contentType),new qe(new ke(this._delegate,new oe(r.data,!0),o),this)},e.prototype.listAll=function(){var e,t=this;return(e=this._delegate,Pe(e)).then(function(e){return new Ne(e,t.storage)})},e.prototype.list=function(e){var t=this;return function(e,t){return Ce(e,t)}(this._delegate,e||void 0).then(function(e){return new Ne(e,t.storage)})},e.prototype.getMetadata=function(){return function(e){return Object(w.b)(this,void 0,void 0,function(){var t,n;return Object(w.e)(this,function(r){switch(r.label){case 0:return e._throwIfRoot(\"getMetadata\"),[4,e.storage._getAuthToken()];case 1:return t=r.sent(),n=me(e.storage,e._location,le()),[2,e.storage._makeRequest(n,t).getPromise()]}})})}(this._delegate)},e.prototype.updateMetadata=function(e){return function(e,t){return function(e,t){return Object(w.b)(this,void 0,void 0,function(){var n,r;return Object(w.e)(this,function(o){switch(o.label){case 0:return e._throwIfRoot(\"updateMetadata\"),[4,e.storage._getAuthToken()];case 1:return n=o.sent(),r=function(e,t,n,r){var o=Y(t.fullServerUrl()),i=pe(n,r),a=e.maxOperationRetryTime,s=new fe(o,\"PATCH\",be(e,r),a);return s.headers={\"Content-Type\":\"application/json; charset=utf-8\"},s.body=i,s.errorHandler=_e(t),s}(e.storage,e._location,t,le()),[2,e.storage._makeRequest(r,n).getPromise()]}})})}(e,t)}(this._delegate,e)},e.prototype.getDownloadURL=function(){return function(e){return Object(w.b)(this,void 0,void 0,function(){var t,n;return Object(w.e)(this,function(r){switch(r.label){case 0:return e._throwIfRoot(\"getDownloadURL\"),[4,e.storage._getAuthToken()];case 1:return t=r.sent(),n=function(e,t,n){var r=Y(t.fullServerUrl()),o=e.maxOperationRetryTime,i=new fe(r,\"GET\",function(e,t){return function(n,r){var o=he(e,r,t);return de(null!==o),function(e,t){var n=ie(t);if(null===n)return null;if(!W(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var o=encodeURIComponent;return r.split(\",\").map(function(t){var n=e.fullPath;return Y(\"/b/\"+o(e.bucket)+\"/o/\"+o(n))+Z({alt:\"media\",token:t})})[0]}(o,r)}}(e,n),o);return i.errorHandler=_e(t),i}(e.storage,e._location,le()),[2,e.storage._makeRequest(n,t).getPromise().then(function(e){if(null===e)throw new k(\"no-download-url\",\"The given file does not have any download URLs.\");return e})]}})})}(this._delegate)},e.prototype.delete=function(){return this._throwIfRoot(\"delete\"),function(e){return Object(w.b)(this,void 0,void 0,function(){var t,n;return Object(w.e)(this,function(r){switch(r.label){case 0:return e._throwIfRoot(\"deleteObject\"),[4,e.storage._getAuthToken()];case 1:return t=r.sent(),n=function(e,t){var n=Y(t.fullServerUrl()),r=new fe(n,\"DELETE\",function(e,t){},e.maxOperationRetryTime);return r.successCodes=[200,204],r.errorHandler=_e(t),r}(e.storage,e._location),[2,e.storage._makeRequest(n,t).getPromise()]}})})}(this._delegate)},e.prototype._throwIfRoot=function(e){if(\"\"===this._delegate._location.path)throw I(e)},e}(),ze=function(){function e(e,t){var n=this;this.app=e,this._delegate=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return Object.defineProperty(e.prototype,\"maxOperationRetryTime\",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"maxUploadRetryTime\",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),e.prototype.ref=function(e){if(je(e))throw S(\"ref() expected a child path but got a URL, use refFromURL instead.\");return new Be(Me(this._delegate,e),this)},e.prototype.refFromURL=function(e){if(!je(e))throw S(\"refFromURL() expected a full URL but got a child path, use ref() instead.\");try{V.makeFromUrl(e)}catch(t){throw S(\"refFromUrl() expected a valid full URL but got an invalid one.\")}return new Be(Me(this._delegate,e),this)},e.prototype.setMaxUploadRetryTime=function(e){this._delegate.maxUploadRetryTime=e},e.prototype.setMaxOperationRetryTime=function(e){this._delegate.maxOperationRetryTime=e},e}();function He(e){var t=function(e){return new f.a(function(t){var n=function(e){return t.next(e)};n(e.snapshot);var r=e.on(\"state_changed\",n);return e.then(function(e){n(e),t.complete()},function(r){n(e.snapshot),function(e){t.error(e)}(r)}),function(){r()}}).pipe(Object(g.a)(0))}(e);return{task:e,then:e.then.bind(e),catch:e.catch.bind(e),pause:e.pause.bind(e),cancel:e.cancel.bind(e),resume:e.resume.bind(e),snapshotChanges:function(){return t},percentageChanges:function(){return t.pipe(Object(a.a)(function(e){return e.bytesTransferred/e.totalBytes*100}))}}}function Ge(e,t,n){return{getDownloadURL:function(){return Object(d.a)(void 0).pipe(Object(_.b)(t.outsideAngular),Object(m.a)(function(){return e.getDownloadURL()}),n)},getMetadata:function(){return Object(d.a)(void 0).pipe(Object(_.b)(t.outsideAngular),Object(m.a)(function(){return e.getMetadata()}),n)},delete:function(){return Object(b.a)(e.delete())},child:function(r){return Ge(e.child(r),t,n)},updateMetadata:function(t){return Object(b.a)(e.updateMetadata(t))},put:function(t,n){return He(e.put(t,n))},putString:function(t,n,r){return He(e.putString(t,n,r))},listAll:function(){return Object(b.a)(e.listAll())}}}De={TaskState:B,TaskEvent:{STATE_CHANGED:\"state_changed\"},StringFormat:M,Storage:Ae,Reference:Be},(Le=y.a).INTERNAL.registerComponent(new T.a(\"storage\",function(e,t){var n=t.instanceIdentifier,r=e.getProvider(\"app\").getImmediate(),o=e.getProvider(\"auth-internal\");return new ze(r,new Ae(r,o,new X,n,y.a.SDK_VERSION))},\"PUBLIC\").setServiceProps(De).setMultipleInstances(!0)),Le.registerVersion(\"@firebase/storage\",\"0.4.5\");var Xe=new s.s(\"angularfire2.storageBucket\"),Ve=new s.s(\"angularfire2.storage.maxUploadRetryTime\"),Qe=new s.s(\"angularfire2.storage.maxOperationRetryTime\"),We=function(){var e=function(){function e(t,n,r,o,i,a,s){Object(h.a)(this,e),this.schedulers=new v.d(i),this.keepUnstableUntilFirst=Object(v.h)(this.schedulers);var u=Object(v.g)(t,i,n);this.storage=Object(v.f)(\"\".concat(u.name,\".storage.\").concat(r),\"AngularFireStorage\",u,function(){var e=i.runOutsideAngular(function(){return u.storage(r||void 0)});return a&&e.setMaxUploadRetryTime(a),s&&e.setMaxOperationRetryTime(s),e},[a,s])}return Object(p.a)(e,[{key:\"ref\",value:function(e){return Ge(this.storage.ref(e),this.schedulers,this.keepUnstableUntilFirst)}},{key:\"refFromURL\",value:function(e){return Ge(this.storage.refFromURL(e),this.schedulers,this.keepUnstableUntilFirst)}},{key:\"upload\",value:function(e,t,n){return Ge(this.storage.ref(e),this.schedulers,this.keepUnstableUntilFirst).put(t,n)}}]),e}();return e.\\u0275fac=function(t){return new(t||e)(s.bc(v.c),s.bc(v.b,8),s.bc(Xe,8),s.bc(s.D),s.bc(s.B),s.bc(Ve,8),s.bc(Qe,8))},e.\\u0275prov=Object(s.Lb)({factory:function(){return new e(Object(s.bc)(v.c),Object(s.bc)(v.b,8),Object(s.bc)(Xe,8),Object(s.bc)(s.D),Object(s.bc)(s.B),Object(s.bc)(Ve,8),Object(s.bc)(Qe,8))},token:e,providedIn:\"any\"}),e}(),Je=n(\"7EHt\"),Ke=n(\"bv9b\"),$e=n(\"kmnG\"),Ye=n(\"qFsG\"),Ze=n(\"3Pt+\"),et=n(\"bTqV\"),tt=function(){function e(e,t,n,r){this.auth=e,this.postService=t,this.storage=n,this.router=r,this.saving=\"Create Post\"}return e.prototype.ngOnInit=function(){},e.prototype.createPost=function(){var e=this,t={author:this.auth.authState.displayName||this.auth.authState.email,authorId:this.auth.currentUserId,content:this.content,image:this.image||null,published:new Date,title:this.title};this.postService.create(t),this.title=\"\",this.content=\"\",this.image=\"\",this.saving=\"Post Created!\",setTimeout(function(){return e.saving=\"Create Post\"},3e3),this.router.navigateByUrl(\"blog\")},e.prototype.uploadImage=function(e){return t=this,void 0,r=function(){var t,n,r,o,i;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(a){switch(a.label){case 0:return n=\"posts/\"+(t=e.target.files[0]).name,\"image\"===t.type.split(\"/\")[0]?[3,1]:[2,alert(\"only image files\")];case 1:return r=this.storage.upload(n,t),o=this.storage.ref(n),this.uploadPercent=r.percentageChanges(),[4,r];case 2:return a.sent(),console.log(\"Image uploaded!\"),i=this,[4,o.getDownloadURL().toPromise()];case 3:i.image=a.sent(),a.label=4;case 4:return[2]}})},new((n=void 0)||(n=Promise))(function(e,o){function i(e){try{s(r.next(e))}catch(t){o(t)}}function a(e){try{s(r.throw(e))}catch(t){o(t)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n(function(e){e(r)})).then(i,a)}s((r=r.apply(t,[])).next())});var t,n,r},e.\\u0275fac=function(t){return new(t||e)(s.Pb(i.a),s.Pb(l),s.Pb(We),s.Pb(r.c))},e.\\u0275cmp=s.Jb({type:e,selectors:[[\"app-post-dashboard\"]],decls:20,vars:9,consts:[[\"type\",\"file\",\"name\",\"file\",\"id\",\"file\",3,\"change\"],[3,\"hidden\"],[\"mode\",\"determinate\",3,\"value\"],[3,\"src\"],[\"matInput\",\"\",\"placeholder\",\"Post title\",\"name\",\"title\",3,\"ngModel\",\"ngModelChange\"],[\"matInput\",\"\",\"placeholder\",\"Post content\",\"name\",\"content\",\"rows\",\"10\",3,\"ngModel\",\"ngModelChange\"],[\"mat-raised-button\",\"\",\"color\",\"accent\",3,\"click\"]],template:function(e,t){1&e&&(s.Ub(0,\"section\"),s.Ub(1,\"mat-accordion\"),s.Ub(2,\"mat-expansion-panel\"),s.Ub(3,\"mat-expansion-panel-header\"),s.Ub(4,\"mat-panel-title\"),s.Fc(5,\" Create a Post \"),s.Tb(),s.Tb(),s.Ub(6,\"input\",0),s.ec(\"change\",function(e){return t.uploadImage(e)}),s.Tb(),s.Ub(7,\"div\",1),s.Qb(8,\"mat-progress-bar\",2),s.jc(9,\"async\"),s.Tb(),s.Ub(10,\"div\",1),s.Qb(11,\"img\",3),s.Tb(),s.Ub(12,\"mat-form-field\"),s.Ub(13,\"input\",4),s.ec(\"ngModelChange\",function(e){return t.title=e}),s.Tb(),s.Tb(),s.Qb(14,\"br\"),s.Ub(15,\"mat-form-field\"),s.Ub(16,\"textarea\",5),s.ec(\"ngModelChange\",function(e){return t.content=e}),s.Tb(),s.Tb(),s.Qb(17,\"br\"),s.Ub(18,\"button\",6),s.ec(\"click\",function(){return t.createPost()}),s.Fc(19),s.Tb(),s.Tb(),s.Tb(),s.Tb()),2&e&&(s.Cb(7),s.oc(\"hidden\",!t.uploadPercent),s.Cb(1),s.pc(\"value\",s.kc(9,7,t.uploadPercent)),s.Cb(2),s.oc(\"hidden\",!t.image),s.Cb(1),s.oc(\"src\",t.image||\"//:0\",s.yc),s.Cb(2),s.oc(\"ngModel\",t.title),s.Cb(3),s.oc(\"ngModel\",t.content),s.Cb(3),s.Gc(t.saving))},directives:[Je.a,Je.c,Je.d,Je.e,Ke.a,$e.b,Ye.a,Ze.b,Ze.h,Ze.j,et.a],pipes:[o.b],styles:[\"section[_ngcontent-%COMP%]{max-width:700px;margin:2em auto}img[_ngcontent-%COMP%], mat-form-field[_ngcontent-%COMP%]{width:100%}\"]}),e}(),nt=n(\"Wp6s\"),rt=n(\"NFeN\");function ot(e,t){if(1&e){var n=s.Vb();s.Ub(0,\"button\",8),s.ec(\"click\",function(){return s.wc(n),s.ic(2).editing=!1}),s.Fc(1,\"Cancel\"),s.Tb()}}function it(e,t){if(1&e){var n=s.Vb();s.Ub(0,\"mat-card-actions\",9),s.Ub(1,\"button\",10),s.ec(\"click\",function(){return s.wc(n),s.ic(2).editing=!0}),s.Ub(2,\"mat-icon\"),s.Fc(3,\"edit\"),s.Tb(),s.Tb(),s.Ub(4,\"button\",10),s.ec(\"click\",function(){s.wc(n);var e=s.ic(2);return e.delete(e.post.id)}),s.Ub(5,\"mat-icon\"),s.Fc(6,\"delete\"),s.Tb(),s.Tb(),s.Tb()}}function at(e,t){if(1&e){var n=s.Vb();s.Sb(0),s.Ub(1,\"div\",1),s.Ub(2,\"mat-card\"),s.Ub(3,\"h1\"),s.Fc(4,\"Edit Post\"),s.Tb(),s.Ub(5,\"mat-form-field\"),s.Ub(6,\"input\",2),s.ec(\"ngModelChange\",function(e){return s.wc(n),s.ic().post.title=e}),s.Tb(),s.Tb(),s.Qb(7,\"br\"),s.Ub(8,\"mat-form-field\"),s.Ub(9,\"textarea\",3),s.ec(\"ngModelChange\",function(e){return s.wc(n),s.ic().post.content=e}),s.Tb(),s.Tb(),s.Qb(10,\"br\"),s.Ub(11,\"button\",4),s.ec(\"click\",function(){return s.wc(n),s.ic().updatePost()}),s.Fc(12,\"Save\"),s.Tb(),s.Dc(13,ot,2,0,\"button\",5),s.Tb(),s.Tb(),s.Ub(14,\"div\",1),s.Ub(15,\"mat-card\"),s.Qb(16,\"img\",6),s.Ub(17,\"h2\"),s.Fc(18),s.Tb(),s.Ub(19,\"p\"),s.Ub(20,\"small\"),s.Fc(21),s.jc(22,\"date\"),s.Tb(),s.Tb(),s.Ub(23,\"mat-card-content\"),s.Ub(24,\"p\"),s.Fc(25),s.Tb(),s.Tb(),s.Dc(26,it,7,0,\"mat-card-actions\",7),s.Tb(),s.Tb(),s.Rb()}if(2&e){var r=s.ic();s.Cb(1),s.oc(\"hidden\",!r.editing),s.Cb(5),s.oc(\"ngModel\",r.post.title),s.Cb(3),s.oc(\"ngModel\",r.post.content),s.Cb(4),s.oc(\"ngIf\",r.editing),s.Cb(1),s.oc(\"hidden\",r.editing),s.Cb(2),s.pc(\"src\",r.post.image,s.yc),s.pc(\"alt\",r.post.title),s.Cb(2),s.Gc(r.post.title),s.Cb(3),s.Ic(\"Posted by \",r.post.author,\" \\u2022 on \",s.lc(22,12,r.post.published.toDate(),\"fullDate\"),\"\"),s.Cb(4),s.Gc(r.post.content),s.Cb(1),s.oc(\"ngIf\",r.auth.currentUserId===r.post.authorId)}}var st=function(){function e(e,t,n,r){this.route=e,this.router=t,this.postService=n,this.auth=r,this.editing=!1}return e.prototype.ngOnInit=function(){console.log(\"detal loaded\"),this.getPost()},e.prototype.getPost=function(){var e=this,t=this.route.snapshot.paramMap.get(\"id\");this.postService.getPostData(t).subscribe(function(t){return e.post=t})},e.prototype.updatePost=function(){var e={title:this.post.title,content:this.post.content},t=this.route.snapshot.paramMap.get(\"id\");this.postService.update(t,e),this.editing=!1},e.prototype.delete=function(){var e=this.route.snapshot.paramMap.get(\"id\");this.postService.delete(e),this.router.navigate([\"/blog\"])},e.\\u0275fac=function(t){return new(t||e)(s.Pb(r.a),s.Pb(r.c),s.Pb(l),s.Pb(i.a))},e.\\u0275cmp=s.Jb({type:e,selectors:[[\"app-post-detail\"]],decls:1,vars:1,consts:[[4,\"ngIf\"],[3,\"hidden\"],[\"matInput\",\"\",\"placeholder\",\"Post title\",\"name\",\"title\",3,\"ngModel\",\"ngModelChange\"],[\"matInput\",\"\",\"placeholder\",\"Post content\",\"name\",\"content\",\"rows\",\"10\",3,\"ngModel\",\"ngModelChange\"],[\"mat-raised-button\",\"\",\"color\",\"accent\",3,\"click\"],[\"mat-button\",\"\",3,\"click\",4,\"ngIf\"],[\"mat-card-image\",\"\",3,\"src\",\"alt\"],[\"align\",\"end\",4,\"ngIf\"],[\"mat-button\",\"\",3,\"click\"],[\"align\",\"end\"],[\"mat-icon-button\",\"\",3,\"click\"]],template:function(e,t){1&e&&s.Dc(0,at,27,15,\"ng-container\",0),2&e&&s.oc(\"ngIf\",t.post)},directives:[o.m,nt.a,$e.b,Ye.a,Ze.b,Ze.h,Ze.j,et.a,nt.d,nt.c,nt.b,rt.a],pipes:[o.e],styles:[\"mat-card[_ngcontent-%COMP%]{margin:10px auto;max-width:700px}mat-form-field[_ngcontent-%COMP%]{width:100%}\"]}),e}();function ut(e,t){if(1&e){var n=s.Vb();s.Ub(0,\"mat-card-actions\",4),s.Ub(1,\"button\",5),s.ec(\"click\",function(){s.wc(n);var e=s.ic().$implicit;return s.ic().delete(e.id)}),s.Ub(2,\"mat-icon\"),s.Fc(3,\"delete\"),s.Tb(),s.Tb(),s.Tb()}}function ct(e,t){if(1&e&&(s.Ub(0,\"mat-card\"),s.Ub(1,\"mat-card-content\",1),s.Qb(2,\"img\",2),s.Ub(3,\"h2\"),s.Fc(4),s.Tb(),s.Ub(5,\"p\"),s.Ub(6,\"small\"),s.Fc(7),s.jc(8,\"date\"),s.Tb(),s.Tb(),s.Tb(),s.Dc(9,ut,4,0,\"mat-card-actions\",3),s.Tb()),2&e){var n=t.$implicit,r=s.ic();s.Cb(1),s.pc(\"routerLink\",n.id),s.Cb(1),s.pc(\"src\",n.image,s.yc),s.pc(\"alt\",n.title),s.Cb(2),s.Gc(n.title),s.Cb(3),s.Ic(\"Posted by \",n.author,\" \\u2022 on \",s.lc(8,7,n.published.toDate(),\"fullDate\"),\"\"),s.Cb(2),s.oc(\"ngIf\",r.auth.currentUserId===n.authorId)}}var lt=function(){function e(e,t){this.postService=e,this.auth=t}return e.prototype.ngOnInit=function(){console.log(\"loaded\"),this.posts=this.postService.getPosts()},e.prototype.delete=function(e){this.postService.delete(e)},e.\\u0275fac=function(t){return new(t||e)(s.Pb(l),s.Pb(i.a))},e.\\u0275cmp=s.Jb({type:e,selectors:[[\"app-post-list\"]],decls:3,vars:3,consts:[[4,\"ngFor\",\"ngForOf\"],[3,\"routerLink\"],[\"mat-card-image\",\"\",3,\"src\",\"alt\"],[\"align\",\"end\",4,\"ngIf\"],[\"align\",\"end\"],[\"mat-icon-button\",\"\",3,\"click\"]],template:function(e,t){1&e&&(s.Ub(0,\"section\"),s.Dc(1,ct,10,10,\"mat-card\",0),s.jc(2,\"async\"),s.Tb()),2&e&&(s.Cb(1),s.oc(\"ngForOf\",s.kc(2,1,t.posts)))},directives:[o.l,nt.a,nt.c,r.d,nt.d,o.m,nt.b,et.a,rt.a],pipes:[o.b,o.e],styles:[\"section[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));grid-template-rows:auto;grid-gap:10px;margin:0 auto;max-width:90%}mat-card[_ngcontent-%COMP%]{margin:10px 0}\"]}),e}(),ht=n(\"/t3+\"),pt=[{path:\"\",component:lt},{path:\"dashboard\",component:tt,canActivate:[function(){function e(e,t){this.authService=e,this.router=t,this.routeURL=this.router.url}return e.prototype.canActivate=function(e,t){var n=this;return new Promise(function(e,t){n.authService.user.subscribe(function(t){return t||\"/homepage\"===n.routeURL?(n.routeURL=n.router.url,e(!0)):(n.routeURL=\"/login\",n.router.navigate([\"/homepage\"],{queryParams:{return:\"login\"}}),alert(\"Not logged in\"),e(!1))})})},e.\\u0275fac=function(t){return new(t||e)(s.bc(i.a),s.bc(r.c))},e.\\u0275prov=s.Lb({token:e,factory:e.\\u0275fac,providedIn:\"root\"}),e}()]},{path:\":id\",component:st}],ft=function(){function e(){}return e.\\u0275mod=s.Nb({type:e}),e.\\u0275inj=s.Mb({factory:function(t){return new(t||e)},providers:[l],imports:[[r.f.forChild(pt),o.c,nt.e,et.b,nt.e,Je.b,Ke.b,rt.b,Ye.b,ht.a,Ze.d]]}),e}()}}]);","name":"5.8b879ae2cd04765b28bc.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[5],{\n\n/***/ \"RQpc\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"PostsModule\", function() { return /* binding */ posts_module_PostsModule; });\n\n// EXTERNAL MODULE: ./node_modules/@angular/router/__ivy_ngcc__/fesm2015/router.js\nvar router = __webpack_require__(\"tyNb\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/common/__ivy_ngcc__/fesm2015/common.js\nvar common = __webpack_require__(\"ofXK\");\n\n// EXTERNAL MODULE: ./src/app/core/auth.service.ts\nvar auth_service = __webpack_require__(\"8PDw\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/map.js\nvar map = __webpack_require__(\"lJxs\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/core/__ivy_ngcc__/fesm2015/core.js + 3 modules\nvar core = __webpack_require__(\"fXoL\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/fire/__ivy_ngcc__/fesm2015/angular-fire-firestore.js + 4 modules\nvar angular_fire_firestore = __webpack_require__(\"I/3d\");\n\n// CONCATENATED MODULE: ./src/app/components/post/post.service.ts\nvar __assign = (undefined && undefined.__assign) || function () {\n    __assign = Object.assign || function (t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s)\n                if (Object.prototype.hasOwnProperty.call(s, p))\n                    t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\n\n\n\n\nvar post_service_PostService = /** @class */ /*@__PURE__*/ (function () {\n    function PostService(afs) {\n        this.afs = afs;\n        this.postsCollection = this.afs.collection('posts', function (ref) {\n            return ref.orderBy('published', 'desc');\n        });\n    }\n    PostService.prototype.getPosts = function () {\n        return this.postsCollection.snapshotChanges().pipe(Object(map[\"a\" /* map */])(function (actions) {\n            return actions.map(function (a) {\n                var data = a.payload.doc.data();\n                var id = a.payload.doc.id;\n                return __assign({ id: id }, data);\n            });\n        }));\n    };\n    PostService.prototype.getPostData = function (id) {\n        this.postDoc = this.afs.doc(\"posts/\" + id);\n        return this.postDoc.valueChanges();\n    };\n    PostService.prototype.getPost = function (id) {\n        return this.afs.doc(\"posts/\" + id);\n    };\n    PostService.prototype.create = function (data) {\n        this.postsCollection.add(data);\n    };\n    PostService.prototype.delete = function (id) {\n        return this.getPost(id).delete();\n    };\n    PostService.prototype.update = function (id, formData) {\n        return this.getPost(id).update(formData);\n    };\n    PostService.ɵfac = function PostService_Factory(t) { return new (t || PostService)(core[\"bc\" /* ɵɵinject */](angular_fire_firestore[\"a\" /* AngularFirestore */])); };\n    PostService.ɵprov = core[\"Lb\" /* ɵɵdefineInjectable */]({ token: PostService, factory: PostService.ɵfac });\n    return PostService;\n}());\n\n\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/classCallCheck.js\nvar classCallCheck = __webpack_require__(\"1OyB\");\n\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/createClass.js\nvar createClass = __webpack_require__(\"vuIU\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/Observable.js + 1 modules\nvar Observable = __webpack_require__(\"HDdC\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/observable/of.js\nvar of = __webpack_require__(\"LRne\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/observable/from.js\nvar from = __webpack_require__(\"Cfvw\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/debounceTime.js\nvar debounceTime = __webpack_require__(\"Kj3r\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/observeOn.js\nvar observeOn = __webpack_require__(\"pxpQ\");\n\n// EXTERNAL MODULE: ./node_modules/rxjs/_esm2015/internal/operators/switchMap.js\nvar switchMap = __webpack_require__(\"eIep\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/fire/__ivy_ngcc__/fesm2015/angular-fire.js\nvar angular_fire = __webpack_require__(\"spgP\");\n\n// EXTERNAL MODULE: ./node_modules/@firebase/app/dist/index.esm.js\nvar index_esm = __webpack_require__(\"zIRd\");\n\n// EXTERNAL MODULE: ./node_modules/tslib/tslib.es6.js\nvar tslib_es6 = __webpack_require__(\"mrSG\");\n\n// EXTERNAL MODULE: ./node_modules/@firebase/util/dist/index.esm.js\nvar dist_index_esm = __webpack_require__(\"qOnz\");\n\n// EXTERNAL MODULE: ./node_modules/@firebase/component/dist/index.esm.js\nvar component_dist_index_esm = __webpack_require__(\"/6Yf\");\n\n// CONCATENATED MODULE: ./node_modules/@firebase/storage/dist/index.esm.js\n\n\n\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Constants used in the Firebase Storage library.\n */\n\n/**\n * Domain name for firebase storage.\n */\n\nvar DEFAULT_HOST = 'firebasestorage.googleapis.com';\n/**\n * The key in Firebase config json for the storage bucket.\n */\n\nvar CONFIG_STORAGE_BUCKET_KEY = 'storageBucket';\n/**\n * 2 minutes\n *\n * The timeout for all operations except upload.\n */\n\nvar DEFAULT_MAX_OPERATION_RETRY_TIME = 2 * 60 * 1000;\n/**\n * 10 minutes\n *\n * The timeout for upload.\n */\n\nvar DEFAULT_MAX_UPLOAD_RETRY_TIME = 10 * 60 * 1000;\n/**\n * An error returned by the Firebase Storage SDK.\n * @public\n */\n\nvar index_esm_FirebaseStorageError =\n/** @class */\n\n/*@__PURE__*/\nfunction (_super) {\n  Object(tslib_es6[\"d\" /* __extends */])(FirebaseStorageError, _super);\n  /**\n   * @param code - A StorageErrorCode string to be prefixed with 'storage/' and\n   *  added to the end of the message.\n   * @param message  - Error message.\n   */\n\n\n  function FirebaseStorageError(code, message) {\n    var _this = _super.call(this, prependCode(code), \"Firebase Storage: \" + message + \" (\" + prependCode(code) + \")\") || this;\n    /**\n     * Stores custom error data unque to FirebaseStorageError.\n     */\n\n\n    _this.customData = {\n      serverResponse: null\n    }; // Without this, `instanceof FirebaseStorageError`, in tests for example,\n    // returns false.\n\n    Object.setPrototypeOf(_this, FirebaseStorageError.prototype);\n    return _this;\n  }\n  /**\n   * Compares a StorageErrorCode against this error's code, filtering out the prefix.\n   */\n\n\n  FirebaseStorageError.prototype._codeEquals = function (code) {\n    return prependCode(code) === this.code;\n  };\n\n  Object.defineProperty(FirebaseStorageError.prototype, \"message\", {\n    /**\n     * Error message including serverResponse if available.\n     */\n    get: function get() {\n      if (this.customData.serverResponse) {\n        return this.message + \"\\n\" + this.customData.serverResponse;\n      } else {\n        return this.message;\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(FirebaseStorageError.prototype, \"serverResponse\", {\n    /**\n     * Optional response message that was added by the server.\n     */\n    get: function get() {\n      return this.customData.serverResponse;\n    },\n    set: function set(serverResponse) {\n      this.customData.serverResponse = serverResponse;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return FirebaseStorageError;\n}(dist_index_esm[\"c\" /* FirebaseError */]);\n\nfunction prependCode(code) {\n  return 'storage/' + code;\n}\n\nfunction unknown() {\n  var message = 'An unknown error occurred, please check the error payload for ' + 'server response.';\n  return new index_esm_FirebaseStorageError(\"unknown\"\n  /* UNKNOWN */\n  , message);\n}\n\nfunction objectNotFound(path) {\n  return new index_esm_FirebaseStorageError(\"object-not-found\"\n  /* OBJECT_NOT_FOUND */\n  , \"Object '\" + path + \"' does not exist.\");\n}\n\nfunction quotaExceeded(bucket) {\n  return new index_esm_FirebaseStorageError(\"quota-exceeded\"\n  /* QUOTA_EXCEEDED */\n  , \"Quota for bucket '\" + bucket + \"' exceeded, please view quota on \" + 'https://firebase.google.com/pricing/.');\n}\n\nfunction unauthenticated() {\n  var message = 'User is not authenticated, please authenticate using Firebase ' + 'Authentication and try again.';\n  return new index_esm_FirebaseStorageError(\"unauthenticated\"\n  /* UNAUTHENTICATED */\n  , message);\n}\n\nfunction unauthorized(path) {\n  return new index_esm_FirebaseStorageError(\"unauthorized\"\n  /* UNAUTHORIZED */\n  , \"User does not have permission to access '\" + path + \"'.\");\n}\n\nfunction retryLimitExceeded() {\n  return new index_esm_FirebaseStorageError(\"retry-limit-exceeded\"\n  /* RETRY_LIMIT_EXCEEDED */\n  , 'Max retry time for operation exceeded, please try again.');\n}\n\nfunction index_esm_canceled() {\n  return new index_esm_FirebaseStorageError(\"canceled\"\n  /* CANCELED */\n  , 'User canceled the upload/download.');\n}\n\nfunction invalidUrl(url) {\n  return new index_esm_FirebaseStorageError(\"invalid-url\"\n  /* INVALID_URL */\n  , \"Invalid URL '\" + url + \"'.\");\n}\n\nfunction invalidDefaultBucket(bucket) {\n  return new index_esm_FirebaseStorageError(\"invalid-default-bucket\"\n  /* INVALID_DEFAULT_BUCKET */\n  , \"Invalid default bucket '\" + bucket + \"'.\");\n}\n\nfunction noDefaultBucket() {\n  return new index_esm_FirebaseStorageError(\"no-default-bucket\"\n  /* NO_DEFAULT_BUCKET */\n  , 'No default bucket ' + \"found. Did you set the '\" + CONFIG_STORAGE_BUCKET_KEY + \"' property when initializing the app?\");\n}\n\nfunction cannotSliceBlob() {\n  return new index_esm_FirebaseStorageError(\"cannot-slice-blob\"\n  /* CANNOT_SLICE_BLOB */\n  , 'Cannot slice blob for upload. Please retry the upload.');\n}\n\nfunction serverFileWrongSize() {\n  return new index_esm_FirebaseStorageError(\"server-file-wrong-size\"\n  /* SERVER_FILE_WRONG_SIZE */\n  , 'Server recorded incorrect upload file size, please retry the upload.');\n}\n\nfunction noDownloadURL() {\n  return new index_esm_FirebaseStorageError(\"no-download-url\"\n  /* NO_DOWNLOAD_URL */\n  , 'The given file does not have any download URLs.');\n}\n\nfunction invalidArgument(message) {\n  return new index_esm_FirebaseStorageError(\"invalid-argument\"\n  /* INVALID_ARGUMENT */\n  , message);\n}\n\nfunction appDeleted() {\n  return new index_esm_FirebaseStorageError(\"app-deleted\"\n  /* APP_DELETED */\n  , 'The Firebase app was deleted.');\n}\n/**\n * @param name - The name of the operation that was invalid.\n */\n\n\nfunction invalidRootOperation(name) {\n  return new index_esm_FirebaseStorageError(\"invalid-root-operation\"\n  /* INVALID_ROOT_OPERATION */\n  , \"The operation '\" + name + \"' cannot be performed on a root reference, create a non-root \" + \"reference using child, such as .child('file.png').\");\n}\n/**\n * @param format - The format that was not valid.\n * @param message - A message describing the format violation.\n */\n\n\nfunction invalidFormat(format, message) {\n  return new index_esm_FirebaseStorageError(\"invalid-format\"\n  /* INVALID_FORMAT */\n  , \"String does not match format '\" + format + \"': \" + message);\n}\n/**\n * @param message - A message describing the internal error.\n */\n\n\nfunction internalError(message) {\n  throw new index_esm_FirebaseStorageError(\"internal-error\"\n  /* INTERNAL_ERROR */\n  , 'Internal error: ' + message);\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * An enumeration of the possible string formats for upload.\n * @public\n */\n\n\nvar StringFormat = {\n  /**\n   * Indicates the string should be interpreted \"raw\", that is, as normal text.\n   * The string will be interpreted as UTF-16, then uploaded as a UTF-8 byte\n   * sequence.\n   * Example: The string 'Hello! \\\\ud83d\\\\ude0a' becomes the byte sequence\n   * 48 65 6c 6c 6f 21 20 f0 9f 98 8a\n   */\n  RAW: 'raw',\n\n  /**\n   * Indicates the string should be interpreted as base64-encoded data.\n   * Padding characters (trailing '='s) are optional.\n   * Example: The string 'rWmO++E6t7/rlw==' becomes the byte sequence\n   * ad 69 8e fb e1 3a b7 bf eb 97\n   */\n  BASE64: 'base64',\n\n  /**\n   * Indicates the string should be interpreted as base64url-encoded data.\n   * Padding characters (trailing '='s) are optional.\n   * Example: The string 'rWmO--E6t7_rlw==' becomes the byte sequence\n   * ad 69 8e fb e1 3a b7 bf eb 97\n   */\n  BASE64URL: 'base64url',\n\n  /**\n   * Indicates the string is a data URL, such as one obtained from\n   * canvas.toDataURL().\n   * Example: the string 'data:application/octet-stream;base64,aaaa'\n   * becomes the byte sequence\n   * 69 a6 9a\n   * (the content-type \"application/octet-stream\" is also applied, but can\n   * be overridden in the metadata object).\n   */\n  DATA_URL: 'data_url'\n};\n\nvar StringData =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function StringData(data, contentType) {\n    this.data = data;\n    this.contentType = contentType || null;\n  }\n\n  return StringData;\n}();\n\nfunction dataFromString(format, stringData) {\n  switch (format) {\n    case StringFormat.RAW:\n      return new StringData(utf8Bytes_(stringData));\n\n    case StringFormat.BASE64:\n    case StringFormat.BASE64URL:\n      return new StringData(base64Bytes_(format, stringData));\n\n    case StringFormat.DATA_URL:\n      return new StringData(dataURLBytes_(stringData), dataURLContentType_(stringData));\n    // do nothing\n  } // assert(false);\n\n\n  throw unknown();\n}\n\nfunction utf8Bytes_(value) {\n  var b = [];\n\n  for (var i = 0; i < value.length; i++) {\n    var c = value.charCodeAt(i);\n\n    if (c <= 127) {\n      b.push(c);\n    } else {\n      if (c <= 2047) {\n        b.push(192 | c >> 6, 128 | c & 63);\n      } else {\n        if ((c & 64512) === 55296) {\n          // The start of a surrogate pair.\n          var valid = i < value.length - 1 && (value.charCodeAt(i + 1) & 64512) === 56320;\n\n          if (!valid) {\n            // The second surrogate wasn't there.\n            b.push(239, 191, 189);\n          } else {\n            var hi = c;\n            var lo = value.charCodeAt(++i);\n            c = 65536 | (hi & 1023) << 10 | lo & 1023;\n            b.push(240 | c >> 18, 128 | c >> 12 & 63, 128 | c >> 6 & 63, 128 | c & 63);\n          }\n        } else {\n          if ((c & 64512) === 56320) {\n            // Invalid low surrogate.\n            b.push(239, 191, 189);\n          } else {\n            b.push(224 | c >> 12, 128 | c >> 6 & 63, 128 | c & 63);\n          }\n        }\n      }\n    }\n  }\n\n  return new Uint8Array(b);\n}\n\nfunction percentEncodedBytes_(value) {\n  var decoded;\n\n  try {\n    decoded = decodeURIComponent(value);\n  } catch (e) {\n    throw invalidFormat(StringFormat.DATA_URL, 'Malformed data URL.');\n  }\n\n  return utf8Bytes_(decoded);\n}\n\nfunction base64Bytes_(format, value) {\n  switch (format) {\n    case StringFormat.BASE64:\n      {\n        var hasMinus = value.indexOf('-') !== -1;\n        var hasUnder = value.indexOf('_') !== -1;\n\n        if (hasMinus || hasUnder) {\n          var invalidChar = hasMinus ? '-' : '_';\n          throw invalidFormat(format, \"Invalid character '\" + invalidChar + \"' found: is it base64url encoded?\");\n        }\n\n        break;\n      }\n\n    case StringFormat.BASE64URL:\n      {\n        var hasPlus = value.indexOf('+') !== -1;\n        var hasSlash = value.indexOf('/') !== -1;\n\n        if (hasPlus || hasSlash) {\n          var invalidChar = hasPlus ? '+' : '/';\n          throw invalidFormat(format, \"Invalid character '\" + invalidChar + \"' found: is it base64 encoded?\");\n        }\n\n        value = value.replace(/-/g, '+').replace(/_/g, '/');\n        break;\n      }\n    // do nothing\n  }\n\n  var bytes;\n\n  try {\n    bytes = atob(value);\n  } catch (e) {\n    throw invalidFormat(format, 'Invalid character found');\n  }\n\n  var array = new Uint8Array(bytes.length);\n\n  for (var i = 0; i < bytes.length; i++) {\n    array[i] = bytes.charCodeAt(i);\n  }\n\n  return array;\n}\n\nvar DataURLParts =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function DataURLParts(dataURL) {\n    this.base64 = false;\n    this.contentType = null;\n    var matches = dataURL.match(/^data:([^,]+)?,/);\n\n    if (matches === null) {\n      throw invalidFormat(StringFormat.DATA_URL, \"Must be formatted 'data:[<mediatype>][;base64],<data>\");\n    }\n\n    var middle = matches[1] || null;\n\n    if (middle != null) {\n      this.base64 = endsWith(middle, ';base64');\n      this.contentType = this.base64 ? middle.substring(0, middle.length - ';base64'.length) : middle;\n    }\n\n    this.rest = dataURL.substring(dataURL.indexOf(',') + 1);\n  }\n\n  return DataURLParts;\n}();\n\nfunction dataURLBytes_(dataUrl) {\n  var parts = new DataURLParts(dataUrl);\n\n  if (parts.base64) {\n    return base64Bytes_(StringFormat.BASE64, parts.rest);\n  } else {\n    return percentEncodedBytes_(parts.rest);\n  }\n}\n\nfunction dataURLContentType_(dataUrl) {\n  var parts = new DataURLParts(dataUrl);\n  return parts.contentType;\n}\n\nfunction endsWith(s, end) {\n  var longEnough = s.length >= end.length;\n\n  if (!longEnough) {\n    return false;\n  }\n\n  return s.substring(s.length - end.length) === end;\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * An event that is triggered on a task.\n */\n\n\nvar TaskEvent = {\n  /**\n   * For this event,\n   * <ul>\n   *   <li>The `next` function is triggered on progress updates and when the\n   *       task is paused/resumed with an `UploadTaskSnapshot` as the first\n   *       argument.</li>\n   *   <li>The `error` function is triggered if the upload is canceled or fails\n   *       for another reason.</li>\n   *   <li>The `complete` function is triggered if the upload completes\n   *       successfully.</li>\n   * </ul>\n   */\n  STATE_CHANGED: 'state_changed'\n};\n/**\n * Represents the current state of a running upload.\n */\n\nvar TaskState = {\n  /** The task is currently transferring data. */\n  RUNNING: 'running',\n\n  /** The task was paused by the user. */\n  PAUSED: 'paused',\n\n  /** The task completed successfully. */\n  SUCCESS: 'success',\n\n  /** The task was canceled. */\n  CANCELED: 'canceled',\n\n  /** The task failed with an error. */\n  ERROR: 'error'\n};\n\nfunction taskStateFromInternalTaskState(state) {\n  switch (state) {\n    case \"running\"\n    /* RUNNING */\n    :\n    case \"pausing\"\n    /* PAUSING */\n    :\n    case \"canceling\"\n    /* CANCELING */\n    :\n      return TaskState.RUNNING;\n\n    case \"paused\"\n    /* PAUSED */\n    :\n      return TaskState.PAUSED;\n\n    case \"success\"\n    /* SUCCESS */\n    :\n      return TaskState.SUCCESS;\n\n    case \"canceled\"\n    /* CANCELED */\n    :\n      return TaskState.CANCELED;\n\n    case \"error\"\n    /* ERROR */\n    :\n      return TaskState.ERROR;\n\n    default:\n      // TODO(andysoto): assert(false);\n      return TaskState.ERROR;\n  }\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Error codes for requests made by the the XhrIo wrapper.\n */\n\n\nvar ErrorCode = /*@__PURE__*/function (ErrorCode) {\n  ErrorCode[ErrorCode[\"NO_ERROR\"] = 0] = \"NO_ERROR\";\n  ErrorCode[ErrorCode[\"NETWORK_ERROR\"] = 1] = \"NETWORK_ERROR\";\n  ErrorCode[ErrorCode[\"ABORT\"] = 2] = \"ABORT\";\n  return ErrorCode;\n}({});\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * We use this instead of goog.net.XhrIo because goog.net.XhrIo is hyuuuuge and\n * doesn't work in React Native on Android.\n */\n\n\nvar NetworkXhrIo =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function NetworkXhrIo() {\n    var _this = this;\n\n    this.sent_ = false;\n    this.xhr_ = new XMLHttpRequest();\n    this.errorCode_ = ErrorCode.NO_ERROR;\n    this.sendPromise_ = new Promise(function (resolve) {\n      _this.xhr_.addEventListener('abort', function () {\n        _this.errorCode_ = ErrorCode.ABORT;\n        resolve(_this);\n      });\n\n      _this.xhr_.addEventListener('error', function () {\n        _this.errorCode_ = ErrorCode.NETWORK_ERROR;\n        resolve(_this);\n      });\n\n      _this.xhr_.addEventListener('load', function () {\n        resolve(_this);\n      });\n    });\n  }\n  /**\n   * @override\n   */\n\n\n  NetworkXhrIo.prototype.send = function (url, method, body, headers) {\n    if (this.sent_) {\n      throw internalError('cannot .send() more than once');\n    }\n\n    this.sent_ = true;\n    this.xhr_.open(method, url, true);\n\n    if (headers !== undefined) {\n      for (var key in headers) {\n        if (headers.hasOwnProperty(key)) {\n          this.xhr_.setRequestHeader(key, headers[key].toString());\n        }\n      }\n    }\n\n    if (body !== undefined) {\n      this.xhr_.send(body);\n    } else {\n      this.xhr_.send();\n    }\n\n    return this.sendPromise_;\n  };\n  /**\n   * @override\n   */\n\n\n  NetworkXhrIo.prototype.getErrorCode = function () {\n    if (!this.sent_) {\n      throw internalError('cannot .getErrorCode() before sending');\n    }\n\n    return this.errorCode_;\n  };\n  /**\n   * @override\n   */\n\n\n  NetworkXhrIo.prototype.getStatus = function () {\n    if (!this.sent_) {\n      throw internalError('cannot .getStatus() before sending');\n    }\n\n    try {\n      return this.xhr_.status;\n    } catch (e) {\n      return -1;\n    }\n  };\n  /**\n   * @override\n   */\n\n\n  NetworkXhrIo.prototype.getResponseText = function () {\n    if (!this.sent_) {\n      throw internalError('cannot .getResponseText() before sending');\n    }\n\n    return this.xhr_.responseText;\n  };\n  /**\n   * Aborts the request.\n   * @override\n   */\n\n\n  NetworkXhrIo.prototype.abort = function () {\n    this.xhr_.abort();\n  };\n  /**\n   * @override\n   */\n\n\n  NetworkXhrIo.prototype.getResponseHeader = function (header) {\n    return this.xhr_.getResponseHeader(header);\n  };\n  /**\n   * @override\n   */\n\n\n  NetworkXhrIo.prototype.addUploadProgressListener = function (listener) {\n    if (this.xhr_.upload != null) {\n      this.xhr_.upload.addEventListener('progress', listener);\n    }\n  };\n  /**\n   * @override\n   */\n\n\n  NetworkXhrIo.prototype.removeUploadProgressListener = function (listener) {\n    if (this.xhr_.upload != null) {\n      this.xhr_.upload.removeEventListener('progress', listener);\n    }\n  };\n\n  return NetworkXhrIo;\n}();\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Factory-like class for creating XhrIo instances.\n */\n\n\nvar XhrIoPool =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function XhrIoPool() {}\n\n  XhrIoPool.prototype.createXhrIo = function () {\n    return new NetworkXhrIo();\n  };\n\n  return XhrIoPool;\n}();\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Firebase Storage location data.\n *\n * @internal\n */\n\n\nvar Location =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function Location(bucket, path) {\n    this.bucket = bucket;\n    this.path_ = path;\n  }\n\n  Object.defineProperty(Location.prototype, \"path\", {\n    get: function get() {\n      return this.path_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Location.prototype, \"isRoot\", {\n    get: function get() {\n      return this.path.length === 0;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  Location.prototype.fullServerUrl = function () {\n    var encode = encodeURIComponent;\n    return '/b/' + encode(this.bucket) + '/o/' + encode(this.path);\n  };\n\n  Location.prototype.bucketOnlyServerUrl = function () {\n    var encode = encodeURIComponent;\n    return '/b/' + encode(this.bucket) + '/o';\n  };\n\n  Location.makeFromBucketSpec = function (bucketString) {\n    var bucketLocation;\n\n    try {\n      bucketLocation = Location.makeFromUrl(bucketString);\n    } catch (e) {\n      // Not valid URL, use as-is. This lets you put bare bucket names in\n      // config.\n      return new Location(bucketString, '');\n    }\n\n    if (bucketLocation.path === '') {\n      return bucketLocation;\n    } else {\n      throw invalidDefaultBucket(bucketString);\n    }\n  };\n\n  Location.makeFromUrl = function (url) {\n    var location = null;\n    var bucketDomain = '([A-Za-z0-9.\\\\-_]+)';\n\n    function gsModify(loc) {\n      if (loc.path.charAt(loc.path.length - 1) === '/') {\n        loc.path_ = loc.path_.slice(0, -1);\n      }\n    }\n\n    var gsPath = '(/(.*))?$';\n    var gsRegex = new RegExp('^gs://' + bucketDomain + gsPath, 'i');\n    var gsIndices = {\n      bucket: 1,\n      path: 3\n    };\n\n    function httpModify(loc) {\n      loc.path_ = decodeURIComponent(loc.path);\n    }\n\n    var version = 'v[A-Za-z0-9_]+';\n    var firebaseStorageHost = DEFAULT_HOST.replace(/[.]/g, '\\\\.');\n    var firebaseStoragePath = '(/([^?#]*).*)?$';\n    var firebaseStorageRegExp = new RegExp(\"^https?://\" + firebaseStorageHost + \"/\" + version + \"/b/\" + bucketDomain + \"/o\" + firebaseStoragePath, 'i');\n    var firebaseStorageIndices = {\n      bucket: 1,\n      path: 3\n    };\n    var cloudStorageHost = '(?:storage.googleapis.com|storage.cloud.google.com)';\n    var cloudStoragePath = '([^?#]*)';\n    var cloudStorageRegExp = new RegExp(\"^https?://\" + cloudStorageHost + \"/\" + bucketDomain + \"/\" + cloudStoragePath, 'i');\n    var cloudStorageIndices = {\n      bucket: 1,\n      path: 2\n    };\n    var groups = [{\n      regex: gsRegex,\n      indices: gsIndices,\n      postModify: gsModify\n    }, {\n      regex: firebaseStorageRegExp,\n      indices: firebaseStorageIndices,\n      postModify: httpModify\n    }, {\n      regex: cloudStorageRegExp,\n      indices: cloudStorageIndices,\n      postModify: httpModify\n    }];\n\n    for (var i = 0; i < groups.length; i++) {\n      var group = groups[i];\n      var captures = group.regex.exec(url);\n\n      if (captures) {\n        var bucketValue = captures[group.indices.bucket];\n        var pathValue = captures[group.indices.path];\n\n        if (!pathValue) {\n          pathValue = '';\n        }\n\n        location = new Location(bucketValue, pathValue);\n        group.postModify(location);\n        break;\n      }\n    }\n\n    if (location == null) {\n      throw invalidUrl(url);\n    }\n\n    return location;\n  };\n\n  return Location;\n}();\n/**\n * A request whose promise always fails.\n */\n\n\nvar FailRequest =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function FailRequest(error) {\n    this.promise_ = Promise.reject(error);\n  }\n  /** @inheritDoc */\n\n\n  FailRequest.prototype.getPromise = function () {\n    return this.promise_;\n  };\n  /** @inheritDoc */\n\n\n  FailRequest.prototype.cancel = function (_appDelete) {};\n\n  return FailRequest;\n}();\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @param f May be invoked\n *     before the function returns.\n * @param callback Get all the arguments passed to the function\n *     passed to f, including the initial boolean.\n */\n\n\nfunction start(f, // eslint-disable-next-line @typescript-eslint/no-explicit-any\ncallback, timeout) {\n  // TODO(andysoto): make this code cleaner (probably refactor into an actual\n  // type instead of a bunch of functions with state shared in the closure)\n  var waitSeconds = 1; // Would type this as \"number\" but that doesn't work for Node so ¯\\_(ツ)_/¯\n  // TODO: find a way to exclude Node type definition for storage because storage only works in browser\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n  var timeoutId = null;\n  var hitTimeout = false;\n  var cancelState = 0;\n\n  function canceled() {\n    return cancelState === 2;\n  }\n\n  var triggeredCallback = false;\n\n  function triggerCallback() {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (!triggeredCallback) {\n      triggeredCallback = true;\n      callback.apply(null, args);\n    }\n  }\n\n  function callWithDelay(millis) {\n    timeoutId = setTimeout(function () {\n      timeoutId = null;\n      f(handler, canceled());\n    }, millis);\n  }\n\n  function handler(success) {\n    var args = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n\n    if (triggeredCallback) {\n      return;\n    }\n\n    if (success) {\n      triggerCallback.call.apply(triggerCallback, Object(tslib_es6[\"h\" /* __spreadArray */])([null, success], args));\n      return;\n    }\n\n    var mustStop = canceled() || hitTimeout;\n\n    if (mustStop) {\n      triggerCallback.call.apply(triggerCallback, Object(tslib_es6[\"h\" /* __spreadArray */])([null, success], args));\n      return;\n    }\n\n    if (waitSeconds < 64) {\n      /* TODO(andysoto): don't back off so quickly if we know we're offline. */\n      waitSeconds *= 2;\n    }\n\n    var waitMillis;\n\n    if (cancelState === 1) {\n      cancelState = 2;\n      waitMillis = 0;\n    } else {\n      waitMillis = (waitSeconds + Math.random()) * 1000;\n    }\n\n    callWithDelay(waitMillis);\n  }\n\n  var stopped = false;\n\n  function stop(wasTimeout) {\n    if (stopped) {\n      return;\n    }\n\n    stopped = true;\n\n    if (triggeredCallback) {\n      return;\n    }\n\n    if (timeoutId !== null) {\n      if (!wasTimeout) {\n        cancelState = 2;\n      }\n\n      clearTimeout(timeoutId);\n      callWithDelay(0);\n    } else {\n      if (!wasTimeout) {\n        cancelState = 1;\n      }\n    }\n  }\n\n  callWithDelay(0);\n  setTimeout(function () {\n    hitTimeout = true;\n    stop(true);\n  }, timeout);\n  return stop;\n}\n/**\n * Stops the retry loop from repeating.\n * If the function is currently \"in between\" retries, it is invoked immediately\n * with the second parameter as \"true\". Otherwise, it will be invoked once more\n * after the current invocation finishes iff the current invocation would have\n * triggered another retry.\n */\n\n\nfunction index_esm_stop(id) {\n  id(false);\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nfunction isJustDef(p) {\n  return p !== void 0;\n} // eslint-disable-next-line @typescript-eslint/ban-types\n\n\nfunction isFunction(p) {\n  return typeof p === 'function';\n}\n\nfunction isNonArrayObject(p) {\n  return typeof p === 'object' && !Array.isArray(p);\n}\n\nfunction isString(p) {\n  return typeof p === 'string' || p instanceof String;\n}\n\nfunction isNativeBlob(p) {\n  return isNativeBlobDefined() && p instanceof Blob;\n}\n\nfunction isNativeBlobDefined() {\n  return typeof Blob !== 'undefined';\n}\n\nfunction validateNumber(argument, minValue, maxValue, value) {\n  if (value < minValue) {\n    throw invalidArgument(\"Invalid value for '\" + argument + \"'. Expected \" + minValue + \" or greater.\");\n  }\n\n  if (value > maxValue) {\n    throw invalidArgument(\"Invalid value for '\" + argument + \"'. Expected \" + maxValue + \" or less.\");\n  }\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nfunction makeUrl(urlPart) {\n  return \"https://\" + DEFAULT_HOST + \"/v0\" + urlPart;\n}\n\nfunction makeQueryString(params) {\n  var encode = encodeURIComponent;\n  var queryPart = '?';\n\n  for (var key in params) {\n    if (params.hasOwnProperty(key)) {\n      var nextPart = encode(key) + '=' + encode(params[key]);\n      queryPart = queryPart + nextPart + '&';\n    }\n  } // Chop off the extra '&' or '?' on the end\n\n\n  queryPart = queryPart.slice(0, -1);\n  return queryPart;\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nvar NetworkRequest =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function NetworkRequest(url, method, headers, body, successCodes, additionalRetryCodes, callback, errorCallback, timeout, progressCallback, pool) {\n    var _this = this;\n\n    this.pendingXhr_ = null;\n    this.backoffId_ = null;\n    this.canceled_ = false;\n    this.appDelete_ = false;\n    this.url_ = url;\n    this.method_ = method;\n    this.headers_ = headers;\n    this.body_ = body;\n    this.successCodes_ = successCodes.slice();\n    this.additionalRetryCodes_ = additionalRetryCodes.slice();\n    this.callback_ = callback;\n    this.errorCallback_ = errorCallback;\n    this.progressCallback_ = progressCallback;\n    this.timeout_ = timeout;\n    this.pool_ = pool;\n    this.promise_ = new Promise(function (resolve, reject) {\n      _this.resolve_ = resolve;\n      _this.reject_ = reject;\n\n      _this.start_();\n    });\n  }\n  /**\n   * Actually starts the retry loop.\n   */\n\n\n  NetworkRequest.prototype.start_ = function () {\n    var self = this;\n\n    function doTheRequest(backoffCallback, canceled) {\n      if (canceled) {\n        backoffCallback(false, new RequestEndStatus(false, null, true));\n        return;\n      }\n\n      var xhr = self.pool_.createXhrIo();\n      self.pendingXhr_ = xhr;\n\n      function progressListener(progressEvent) {\n        var loaded = progressEvent.loaded;\n        var total = progressEvent.lengthComputable ? progressEvent.total : -1;\n\n        if (self.progressCallback_ !== null) {\n          self.progressCallback_(loaded, total);\n        }\n      }\n\n      if (self.progressCallback_ !== null) {\n        xhr.addUploadProgressListener(progressListener);\n      } // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n      xhr.send(self.url_, self.method_, self.body_, self.headers_).then(function (xhr) {\n        if (self.progressCallback_ !== null) {\n          xhr.removeUploadProgressListener(progressListener);\n        }\n\n        self.pendingXhr_ = null;\n        xhr = xhr;\n        var hitServer = xhr.getErrorCode() === ErrorCode.NO_ERROR;\n        var status = xhr.getStatus();\n\n        if (!hitServer || self.isRetryStatusCode_(status)) {\n          var wasCanceled = xhr.getErrorCode() === ErrorCode.ABORT;\n          backoffCallback(false, new RequestEndStatus(false, null, wasCanceled));\n          return;\n        }\n\n        var successCode = self.successCodes_.indexOf(status) !== -1;\n        backoffCallback(true, new RequestEndStatus(successCode, xhr));\n      });\n    }\n    /**\n     * @param requestWentThrough - True if the request eventually went\n     *     through, false if it hit the retry limit or was canceled.\n     */\n\n\n    function backoffDone(requestWentThrough, status) {\n      var resolve = self.resolve_;\n      var reject = self.reject_;\n      var xhr = status.xhr;\n\n      if (status.wasSuccessCode) {\n        try {\n          var result = self.callback_(xhr, xhr.getResponseText());\n\n          if (isJustDef(result)) {\n            resolve(result);\n          } else {\n            resolve();\n          }\n        } catch (e) {\n          reject(e);\n        }\n      } else {\n        if (xhr !== null) {\n          var err = unknown();\n          err.serverResponse = xhr.getResponseText();\n\n          if (self.errorCallback_) {\n            reject(self.errorCallback_(xhr, err));\n          } else {\n            reject(err);\n          }\n        } else {\n          if (status.canceled) {\n            var err = self.appDelete_ ? appDeleted() : index_esm_canceled();\n            reject(err);\n          } else {\n            var err = retryLimitExceeded();\n            reject(err);\n          }\n        }\n      }\n    }\n\n    if (this.canceled_) {\n      backoffDone(false, new RequestEndStatus(false, null, true));\n    } else {\n      this.backoffId_ = start(doTheRequest, backoffDone, this.timeout_);\n    }\n  };\n  /** @inheritDoc */\n\n\n  NetworkRequest.prototype.getPromise = function () {\n    return this.promise_;\n  };\n  /** @inheritDoc */\n\n\n  NetworkRequest.prototype.cancel = function (appDelete) {\n    this.canceled_ = true;\n    this.appDelete_ = appDelete || false;\n\n    if (this.backoffId_ !== null) {\n      index_esm_stop(this.backoffId_);\n    }\n\n    if (this.pendingXhr_ !== null) {\n      this.pendingXhr_.abort();\n    }\n  };\n\n  NetworkRequest.prototype.isRetryStatusCode_ = function (status) {\n    // The codes for which to retry came from this page:\n    // https://cloud.google.com/storage/docs/exponential-backoff\n    var isFiveHundredCode = status >= 500 && status < 600;\n    var extraRetryCodes = [// Request Timeout: web server didn't receive full request in time.\n    408, // Too Many Requests: you're getting rate-limited, basically.\n    429];\n    var isExtraRetryCode = extraRetryCodes.indexOf(status) !== -1;\n    var isRequestSpecificRetryCode = this.additionalRetryCodes_.indexOf(status) !== -1;\n    return isFiveHundredCode || isExtraRetryCode || isRequestSpecificRetryCode;\n  };\n\n  return NetworkRequest;\n}();\n/**\n * A collection of information about the result of a network request.\n * @param opt_canceled - Defaults to false.\n */\n\n\nvar RequestEndStatus =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function RequestEndStatus(wasSuccessCode, xhr, canceled) {\n    this.wasSuccessCode = wasSuccessCode;\n    this.xhr = xhr;\n    this.canceled = !!canceled;\n  }\n\n  return RequestEndStatus;\n}();\n\nfunction addAuthHeader_(headers, authToken) {\n  if (authToken !== null && authToken.length > 0) {\n    headers['Authorization'] = 'Firebase ' + authToken;\n  }\n}\n\nfunction addVersionHeader_(headers, firebaseVersion) {\n  headers['X-Firebase-Storage-Version'] = 'webjs/' + (firebaseVersion !== null && firebaseVersion !== void 0 ? firebaseVersion : 'AppManager');\n}\n\nfunction addGmpidHeader_(headers, appId) {\n  if (appId) {\n    headers['X-Firebase-GMPID'] = appId;\n  }\n}\n\nfunction makeRequest(requestInfo, appId, authToken, pool, firebaseVersion) {\n  var queryPart = makeQueryString(requestInfo.urlParams);\n  var url = requestInfo.url + queryPart;\n  var headers = Object.assign({}, requestInfo.headers);\n  addGmpidHeader_(headers, appId);\n  addAuthHeader_(headers, authToken);\n  addVersionHeader_(headers, firebaseVersion);\n  return new NetworkRequest(url, requestInfo.method, headers, requestInfo.body, requestInfo.successCodes, requestInfo.additionalRetryCodes, requestInfo.handler, requestInfo.errorHandler, requestInfo.timeout, requestInfo.progressCallback, pool);\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nfunction getBlobBuilder() {\n  if (typeof BlobBuilder !== 'undefined') {\n    return BlobBuilder;\n  } else if (typeof WebKitBlobBuilder !== 'undefined') {\n    return WebKitBlobBuilder;\n  } else {\n    return undefined;\n  }\n}\n/**\n * Concatenates one or more values together and converts them to a Blob.\n *\n * @param args The values that will make up the resulting blob.\n * @return The blob.\n */\n\n\nfunction getBlob() {\n  var args = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    args[_i] = arguments[_i];\n  }\n\n  var BlobBuilder = getBlobBuilder();\n\n  if (BlobBuilder !== undefined) {\n    var bb = new BlobBuilder();\n\n    for (var i = 0; i < args.length; i++) {\n      bb.append(args[i]);\n    }\n\n    return bb.getBlob();\n  } else {\n    if (isNativeBlobDefined()) {\n      return new Blob(args);\n    } else {\n      throw new index_esm_FirebaseStorageError(\"unsupported-environment\"\n      /* UNSUPPORTED_ENVIRONMENT */\n      , \"This browser doesn't seem to support creating Blobs\");\n    }\n  }\n}\n/**\n * Slices the blob. The returned blob contains data from the start byte\n * (inclusive) till the end byte (exclusive). Negative indices cannot be used.\n *\n * @param blob The blob to be sliced.\n * @param start Index of the starting byte.\n * @param end Index of the ending byte.\n * @return The blob slice or null if not supported.\n */\n\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  } else if (blob.mozSlice) {\n    return blob.mozSlice(start, end);\n  } else if (blob.slice) {\n    return blob.slice(start, end);\n  }\n\n  return null;\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @param opt_elideCopy - If true, doesn't copy mutable input data\n *     (e.g. Uint8Arrays). Pass true only if you know the objects will not be\n *     modified after this blob's construction.\n *\n * @internal\n */\n\n\nvar FbsBlob =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function FbsBlob(data, elideCopy) {\n    var size = 0;\n    var blobType = '';\n\n    if (isNativeBlob(data)) {\n      this.data_ = data;\n      size = data.size;\n      blobType = data.type;\n    } else if (data instanceof ArrayBuffer) {\n      if (elideCopy) {\n        this.data_ = new Uint8Array(data);\n      } else {\n        this.data_ = new Uint8Array(data.byteLength);\n        this.data_.set(new Uint8Array(data));\n      }\n\n      size = this.data_.length;\n    } else if (data instanceof Uint8Array) {\n      if (elideCopy) {\n        this.data_ = data;\n      } else {\n        this.data_ = new Uint8Array(data.length);\n        this.data_.set(data);\n      }\n\n      size = data.length;\n    }\n\n    this.size_ = size;\n    this.type_ = blobType;\n  }\n\n  FbsBlob.prototype.size = function () {\n    return this.size_;\n  };\n\n  FbsBlob.prototype.type = function () {\n    return this.type_;\n  };\n\n  FbsBlob.prototype.slice = function (startByte, endByte) {\n    if (isNativeBlob(this.data_)) {\n      var realBlob = this.data_;\n      var sliced = sliceBlob(realBlob, startByte, endByte);\n\n      if (sliced === null) {\n        return null;\n      }\n\n      return new FbsBlob(sliced);\n    } else {\n      var slice = new Uint8Array(this.data_.buffer, startByte, endByte - startByte);\n      return new FbsBlob(slice, true);\n    }\n  };\n\n  FbsBlob.getBlob = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (isNativeBlobDefined()) {\n      var blobby = args.map(function (val) {\n        if (val instanceof FbsBlob) {\n          return val.data_;\n        } else {\n          return val;\n        }\n      });\n      return new FbsBlob(getBlob.apply(null, blobby));\n    } else {\n      var uint8Arrays = args.map(function (val) {\n        if (isString(val)) {\n          return dataFromString(StringFormat.RAW, val).data;\n        } else {\n          // Blobs don't exist, so this has to be a Uint8Array.\n          return val.data_;\n        }\n      });\n      var finalLength_1 = 0;\n      uint8Arrays.forEach(function (array) {\n        finalLength_1 += array.byteLength;\n      });\n      var merged_1 = new Uint8Array(finalLength_1);\n      var index_1 = 0;\n      uint8Arrays.forEach(function (array) {\n        for (var i = 0; i < array.length; i++) {\n          merged_1[index_1++] = array[i];\n        }\n      });\n      return new FbsBlob(merged_1, true);\n    }\n  };\n\n  FbsBlob.prototype.uploadData = function () {\n    return this.data_;\n  };\n\n  return FbsBlob;\n}();\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Returns the Object resulting from parsing the given JSON, or null if the\n * given string does not represent a JSON object.\n */\n\n\nfunction jsonObjectOrNull(s) {\n  var obj;\n\n  try {\n    obj = JSON.parse(s);\n  } catch (e) {\n    return null;\n  }\n\n  if (isNonArrayObject(obj)) {\n    return obj;\n  } else {\n    return null;\n  }\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Contains helper methods for manipulating paths.\n */\n\n/**\n * @return Null if the path is already at the root.\n */\n\n\nfunction index_esm_parent(path) {\n  if (path.length === 0) {\n    return null;\n  }\n\n  var index = path.lastIndexOf('/');\n\n  if (index === -1) {\n    return '';\n  }\n\n  var newPath = path.slice(0, index);\n  return newPath;\n}\n\nfunction child(path, childPath) {\n  var canonicalChildPath = childPath.split('/').filter(function (component) {\n    return component.length > 0;\n  }).join('/');\n\n  if (path.length === 0) {\n    return canonicalChildPath;\n  } else {\n    return path + '/' + canonicalChildPath;\n  }\n}\n/**\n * Returns the last component of a path.\n * '/foo/bar' -> 'bar'\n * '/foo/bar/baz/' -> 'baz/'\n * '/a' -> 'a'\n */\n\n\nfunction lastComponent(path) {\n  var index = path.lastIndexOf('/', path.length - 2);\n\n  if (index === -1) {\n    return path;\n  } else {\n    return path.slice(index + 1);\n  }\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nfunction noXform_(metadata, value) {\n  return value;\n}\n\nvar Mapping =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function Mapping(server, local, writable, xform) {\n    this.server = server;\n    this.local = local || server;\n    this.writable = !!writable;\n    this.xform = xform || noXform_;\n  }\n\n  return Mapping;\n}();\n\nvar mappings_ = null;\n\nfunction xformPath(fullPath) {\n  if (!isString(fullPath) || fullPath.length < 2) {\n    return fullPath;\n  } else {\n    return lastComponent(fullPath);\n  }\n}\n\nfunction getMappings() {\n  if (mappings_) {\n    return mappings_;\n  }\n\n  var mappings = [];\n  mappings.push(new Mapping('bucket'));\n  mappings.push(new Mapping('generation'));\n  mappings.push(new Mapping('metageneration'));\n  mappings.push(new Mapping('name', 'fullPath', true));\n\n  function mappingsXformPath(_metadata, fullPath) {\n    return xformPath(fullPath);\n  }\n\n  var nameMapping = new Mapping('name');\n  nameMapping.xform = mappingsXformPath;\n  mappings.push(nameMapping);\n  /**\n   * Coerces the second param to a number, if it is defined.\n   */\n\n  function xformSize(_metadata, size) {\n    if (size !== undefined) {\n      return Number(size);\n    } else {\n      return size;\n    }\n  }\n\n  var sizeMapping = new Mapping('size');\n  sizeMapping.xform = xformSize;\n  mappings.push(sizeMapping);\n  mappings.push(new Mapping('timeCreated'));\n  mappings.push(new Mapping('updated'));\n  mappings.push(new Mapping('md5Hash', null, true));\n  mappings.push(new Mapping('cacheControl', null, true));\n  mappings.push(new Mapping('contentDisposition', null, true));\n  mappings.push(new Mapping('contentEncoding', null, true));\n  mappings.push(new Mapping('contentLanguage', null, true));\n  mappings.push(new Mapping('contentType', null, true));\n  mappings.push(new Mapping('metadata', 'customMetadata', true));\n  mappings_ = mappings;\n  return mappings_;\n}\n\nfunction addRef(metadata, service) {\n  function generateRef() {\n    var bucket = metadata['bucket'];\n    var path = metadata['fullPath'];\n    var loc = new Location(bucket, path);\n    return service._makeStorageReference(loc);\n  }\n\n  Object.defineProperty(metadata, 'ref', {\n    get: generateRef\n  });\n}\n\nfunction fromResource(service, resource, mappings) {\n  var metadata = {};\n  metadata['type'] = 'file';\n  var len = mappings.length;\n\n  for (var i = 0; i < len; i++) {\n    var mapping = mappings[i];\n    metadata[mapping.local] = mapping.xform(metadata, resource[mapping.server]);\n  }\n\n  addRef(metadata, service);\n  return metadata;\n}\n\nfunction fromResourceString(service, resourceString, mappings) {\n  var obj = jsonObjectOrNull(resourceString);\n\n  if (obj === null) {\n    return null;\n  }\n\n  var resource = obj;\n  return fromResource(service, resource, mappings);\n}\n\nfunction downloadUrlFromResourceString(metadata, resourceString) {\n  var obj = jsonObjectOrNull(resourceString);\n\n  if (obj === null) {\n    return null;\n  }\n\n  if (!isString(obj['downloadTokens'])) {\n    // This can happen if objects are uploaded through GCS and retrieved\n    // through list, so we don't want to throw an Error.\n    return null;\n  }\n\n  var tokens = obj['downloadTokens'];\n\n  if (tokens.length === 0) {\n    return null;\n  }\n\n  var encode = encodeURIComponent;\n  var tokensList = tokens.split(',');\n  var urls = tokensList.map(function (token) {\n    var bucket = metadata['bucket'];\n    var path = metadata['fullPath'];\n    var urlPart = '/b/' + encode(bucket) + '/o/' + encode(path);\n    var base = makeUrl(urlPart);\n    var queryString = makeQueryString({\n      alt: 'media',\n      token: token\n    });\n    return base + queryString;\n  });\n  return urls[0];\n}\n\nfunction toResourceString(metadata, mappings) {\n  var resource = {};\n  var len = mappings.length;\n\n  for (var i = 0; i < len; i++) {\n    var mapping = mappings[i];\n\n    if (mapping.writable) {\n      resource[mapping.server] = metadata[mapping.local];\n    }\n  }\n\n  return JSON.stringify(resource);\n}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nvar PREFIXES_KEY = 'prefixes';\nvar ITEMS_KEY = 'items';\n\nfunction fromBackendResponse(service, bucket, resource) {\n  var listResult = {\n    prefixes: [],\n    items: [],\n    nextPageToken: resource['nextPageToken']\n  };\n\n  if (resource[PREFIXES_KEY]) {\n    for (var _i = 0, _a = resource[PREFIXES_KEY]; _i < _a.length; _i++) {\n      var path = _a[_i];\n      var pathWithoutTrailingSlash = path.replace(/\\/$/, '');\n\n      var reference = service._makeStorageReference(new Location(bucket, pathWithoutTrailingSlash));\n\n      listResult.prefixes.push(reference);\n    }\n  }\n\n  if (resource[ITEMS_KEY]) {\n    for (var _b = 0, _c = resource[ITEMS_KEY]; _b < _c.length; _b++) {\n      var item = _c[_b];\n\n      var reference = service._makeStorageReference(new Location(bucket, item['name']));\n\n      listResult.items.push(reference);\n    }\n  }\n\n  return listResult;\n}\n\nfunction fromResponseString(service, bucket, resourceString) {\n  var obj = jsonObjectOrNull(resourceString);\n\n  if (obj === null) {\n    return null;\n  }\n\n  var resource = obj;\n  return fromBackendResponse(service, bucket, resource);\n}\n\nvar RequestInfo =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function RequestInfo(url, method,\n  /**\n   * Returns the value with which to resolve the request's promise. Only called\n   * if the request is successful. Throw from this function to reject the\n   * returned Request's promise with the thrown error.\n   * Note: The XhrIo passed to this function may be reused after this callback\n   * returns. Do not keep a reference to it in any way.\n   */\n  handler, timeout) {\n    this.url = url;\n    this.method = method;\n    this.handler = handler;\n    this.timeout = timeout;\n    this.urlParams = {};\n    this.headers = {};\n    this.body = null;\n    this.errorHandler = null;\n    /**\n     * Called with the current number of bytes uploaded and total size (-1 if not\n     * computable) of the request body (i.e. used to report upload progress).\n     */\n\n    this.progressCallback = null;\n    this.successCodes = [200];\n    this.additionalRetryCodes = [];\n  }\n\n  return RequestInfo;\n}();\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Throws the UNKNOWN FirebaseStorageError if cndn is false.\n */\n\n\nfunction handlerCheck(cndn) {\n  if (!cndn) {\n    throw unknown();\n  }\n}\n\nfunction metadataHandler(service, mappings) {\n  function handler(xhr, text) {\n    var metadata = fromResourceString(service, text, mappings);\n    handlerCheck(metadata !== null);\n    return metadata;\n  }\n\n  return handler;\n}\n\nfunction listHandler(service, bucket) {\n  function handler(xhr, text) {\n    var listResult = fromResponseString(service, bucket, text);\n    handlerCheck(listResult !== null);\n    return listResult;\n  }\n\n  return handler;\n}\n\nfunction downloadUrlHandler(service, mappings) {\n  function handler(xhr, text) {\n    var metadata = fromResourceString(service, text, mappings);\n    handlerCheck(metadata !== null);\n    return downloadUrlFromResourceString(metadata, text);\n  }\n\n  return handler;\n}\n\nfunction sharedErrorHandler(location) {\n  function errorHandler(xhr, err) {\n    var newErr;\n\n    if (xhr.getStatus() === 401) {\n      newErr = unauthenticated();\n    } else {\n      if (xhr.getStatus() === 402) {\n        newErr = quotaExceeded(location.bucket);\n      } else {\n        if (xhr.getStatus() === 403) {\n          newErr = unauthorized(location.path);\n        } else {\n          newErr = err;\n        }\n      }\n    }\n\n    newErr.serverResponse = err.serverResponse;\n    return newErr;\n  }\n\n  return errorHandler;\n}\n\nfunction objectErrorHandler(location) {\n  var shared = sharedErrorHandler(location);\n\n  function errorHandler(xhr, err) {\n    var newErr = shared(xhr, err);\n\n    if (xhr.getStatus() === 404) {\n      newErr = objectNotFound(location.path);\n    }\n\n    newErr.serverResponse = err.serverResponse;\n    return newErr;\n  }\n\n  return errorHandler;\n}\n\nfunction index_esm_getMetadata(service, location, mappings) {\n  var urlPart = location.fullServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'GET';\n  var timeout = service.maxOperationRetryTime;\n  var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\n  requestInfo.errorHandler = objectErrorHandler(location);\n  return requestInfo;\n}\n\nfunction list(service, location, delimiter, pageToken, maxResults) {\n  var urlParams = {};\n\n  if (location.isRoot) {\n    urlParams['prefix'] = '';\n  } else {\n    urlParams['prefix'] = location.path + '/';\n  }\n\n  if (delimiter && delimiter.length > 0) {\n    urlParams['delimiter'] = delimiter;\n  }\n\n  if (pageToken) {\n    urlParams['pageToken'] = pageToken;\n  }\n\n  if (maxResults) {\n    urlParams['maxResults'] = maxResults;\n  }\n\n  var urlPart = location.bucketOnlyServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'GET';\n  var timeout = service.maxOperationRetryTime;\n  var requestInfo = new RequestInfo(url, method, listHandler(service, location.bucket), timeout);\n  requestInfo.urlParams = urlParams;\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n\nfunction getDownloadUrl(service, location, mappings) {\n  var urlPart = location.fullServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'GET';\n  var timeout = service.maxOperationRetryTime;\n  var requestInfo = new RequestInfo(url, method, downloadUrlHandler(service, mappings), timeout);\n  requestInfo.errorHandler = objectErrorHandler(location);\n  return requestInfo;\n}\n\nfunction index_esm_updateMetadata(service, location, metadata, mappings) {\n  var urlPart = location.fullServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'PATCH';\n  var body = toResourceString(metadata, mappings);\n  var headers = {\n    'Content-Type': 'application/json; charset=utf-8'\n  };\n  var timeout = service.maxOperationRetryTime;\n  var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\n  requestInfo.headers = headers;\n  requestInfo.body = body;\n  requestInfo.errorHandler = objectErrorHandler(location);\n  return requestInfo;\n}\n\nfunction deleteObject(service, location) {\n  var urlPart = location.fullServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'DELETE';\n  var timeout = service.maxOperationRetryTime;\n\n  function handler(_xhr, _text) {}\n\n  var requestInfo = new RequestInfo(url, method, handler, timeout);\n  requestInfo.successCodes = [200, 204];\n  requestInfo.errorHandler = objectErrorHandler(location);\n  return requestInfo;\n}\n\nfunction determineContentType_(metadata, blob) {\n  return metadata && metadata['contentType'] || blob && blob.type() || 'application/octet-stream';\n}\n\nfunction metadataForUpload_(location, blob, metadata) {\n  var metadataClone = Object.assign({}, metadata);\n  metadataClone['fullPath'] = location.path;\n  metadataClone['size'] = blob.size();\n\n  if (!metadataClone['contentType']) {\n    metadataClone['contentType'] = determineContentType_(null, blob);\n  }\n\n  return metadataClone;\n}\n/**\n * Prepare RequestInfo for uploads as Content-Type: multipart.\n */\n\n\nfunction multipartUpload(service, location, mappings, blob, metadata) {\n  var urlPart = location.bucketOnlyServerUrl();\n  var headers = {\n    'X-Goog-Upload-Protocol': 'multipart'\n  };\n\n  function genBoundary() {\n    var str = '';\n\n    for (var i = 0; i < 2; i++) {\n      str = str + Math.random().toString().slice(2);\n    }\n\n    return str;\n  }\n\n  var boundary = genBoundary();\n  headers['Content-Type'] = 'multipart/related; boundary=' + boundary;\n  var metadata_ = metadataForUpload_(location, blob, metadata);\n  var metadataString = toResourceString(metadata_, mappings);\n  var preBlobPart = '--' + boundary + '\\r\\n' + 'Content-Type: application/json; charset=utf-8\\r\\n\\r\\n' + metadataString + '\\r\\n--' + boundary + '\\r\\n' + 'Content-Type: ' + metadata_['contentType'] + '\\r\\n\\r\\n';\n  var postBlobPart = '\\r\\n--' + boundary + '--';\n  var body = FbsBlob.getBlob(preBlobPart, blob, postBlobPart);\n\n  if (body === null) {\n    throw cannotSliceBlob();\n  }\n\n  var urlParams = {\n    name: metadata_['fullPath']\n  };\n  var url = makeUrl(urlPart);\n  var method = 'POST';\n  var timeout = service.maxUploadRetryTime;\n  var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\n  requestInfo.urlParams = urlParams;\n  requestInfo.headers = headers;\n  requestInfo.body = body.uploadData();\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n/**\n * @param current The number of bytes that have been uploaded so far.\n * @param total The total number of bytes in the upload.\n * @param opt_finalized True if the server has finished the upload.\n * @param opt_metadata The upload metadata, should\n *     only be passed if opt_finalized is true.\n */\n\n\nvar ResumableUploadStatus =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function ResumableUploadStatus(current, total, finalized, metadata) {\n    this.current = current;\n    this.total = total;\n    this.finalized = !!finalized;\n    this.metadata = metadata || null;\n  }\n\n  return ResumableUploadStatus;\n}();\n\nfunction checkResumeHeader_(xhr, allowed) {\n  var status = null;\n\n  try {\n    status = xhr.getResponseHeader('X-Goog-Upload-Status');\n  } catch (e) {\n    handlerCheck(false);\n  }\n\n  var allowedStatus = allowed || ['active'];\n  handlerCheck(!!status && allowedStatus.indexOf(status) !== -1);\n  return status;\n}\n\nfunction createResumableUpload(service, location, mappings, blob, metadata) {\n  var urlPart = location.bucketOnlyServerUrl();\n  var metadataForUpload = metadataForUpload_(location, blob, metadata);\n  var urlParams = {\n    name: metadataForUpload['fullPath']\n  };\n  var url = makeUrl(urlPart);\n  var method = 'POST';\n  var headers = {\n    'X-Goog-Upload-Protocol': 'resumable',\n    'X-Goog-Upload-Command': 'start',\n    'X-Goog-Upload-Header-Content-Length': blob.size(),\n    'X-Goog-Upload-Header-Content-Type': metadataForUpload['contentType'],\n    'Content-Type': 'application/json; charset=utf-8'\n  };\n  var body = toResourceString(metadataForUpload, mappings);\n  var timeout = service.maxUploadRetryTime;\n\n  function handler(xhr) {\n    checkResumeHeader_(xhr);\n    var url;\n\n    try {\n      url = xhr.getResponseHeader('X-Goog-Upload-URL');\n    } catch (e) {\n      handlerCheck(false);\n    }\n\n    handlerCheck(isString(url));\n    return url;\n  }\n\n  var requestInfo = new RequestInfo(url, method, handler, timeout);\n  requestInfo.urlParams = urlParams;\n  requestInfo.headers = headers;\n  requestInfo.body = body;\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n/**\n * @param url From a call to fbs.requests.createResumableUpload.\n */\n\n\nfunction getResumableUploadStatus(service, location, url, blob) {\n  var headers = {\n    'X-Goog-Upload-Command': 'query'\n  };\n\n  function handler(xhr) {\n    var status = checkResumeHeader_(xhr, ['active', 'final']);\n    var sizeString = null;\n\n    try {\n      sizeString = xhr.getResponseHeader('X-Goog-Upload-Size-Received');\n    } catch (e) {\n      handlerCheck(false);\n    }\n\n    if (!sizeString) {\n      // null or empty string\n      handlerCheck(false);\n    }\n\n    var size = Number(sizeString);\n    handlerCheck(!isNaN(size));\n    return new ResumableUploadStatus(size, blob.size(), status === 'final');\n  }\n\n  var method = 'POST';\n  var timeout = service.maxUploadRetryTime;\n  var requestInfo = new RequestInfo(url, method, handler, timeout);\n  requestInfo.headers = headers;\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n/**\n * Any uploads via the resumable upload API must transfer a number of bytes\n * that is a multiple of this number.\n */\n\n\nvar RESUMABLE_UPLOAD_CHUNK_SIZE = 256 * 1024;\n/**\n * @param url From a call to fbs.requests.createResumableUpload.\n * @param chunkSize Number of bytes to upload.\n * @param status The previous status.\n *     If not passed or null, we start from the beginning.\n * @throws fbs.Error If the upload is already complete, the passed in status\n *     has a final size inconsistent with the blob, or the blob cannot be sliced\n *     for upload.\n */\n\nfunction continueResumableUpload(location, service, url, blob, chunkSize, mappings, status, progressCallback) {\n  // TODO(andysoto): standardize on internal asserts\n  // assert(!(opt_status && opt_status.finalized));\n  var status_ = new ResumableUploadStatus(0, 0);\n\n  if (status) {\n    status_.current = status.current;\n    status_.total = status.total;\n  } else {\n    status_.current = 0;\n    status_.total = blob.size();\n  }\n\n  if (blob.size() !== status_.total) {\n    throw serverFileWrongSize();\n  }\n\n  var bytesLeft = status_.total - status_.current;\n  var bytesToUpload = bytesLeft;\n\n  if (chunkSize > 0) {\n    bytesToUpload = Math.min(bytesToUpload, chunkSize);\n  }\n\n  var startByte = status_.current;\n  var endByte = startByte + bytesToUpload;\n  var uploadCommand = bytesToUpload === bytesLeft ? 'upload, finalize' : 'upload';\n  var headers = {\n    'X-Goog-Upload-Command': uploadCommand,\n    'X-Goog-Upload-Offset': status_.current\n  };\n  var body = blob.slice(startByte, endByte);\n\n  if (body === null) {\n    throw cannotSliceBlob();\n  }\n\n  function handler(xhr, text) {\n    // TODO(andysoto): Verify the MD5 of each uploaded range:\n    // the 'x-range-md5' header comes back with status code 308 responses.\n    // We'll only be able to bail out though, because you can't re-upload a\n    // range that you previously uploaded.\n    var uploadStatus = checkResumeHeader_(xhr, ['active', 'final']);\n    var newCurrent = status_.current + bytesToUpload;\n    var size = blob.size();\n    var metadata;\n\n    if (uploadStatus === 'final') {\n      metadata = metadataHandler(service, mappings)(xhr, text);\n    } else {\n      metadata = null;\n    }\n\n    return new ResumableUploadStatus(newCurrent, size, uploadStatus === 'final', metadata);\n  }\n\n  var method = 'POST';\n  var timeout = service.maxUploadRetryTime;\n  var requestInfo = new RequestInfo(url, method, handler, timeout);\n  requestInfo.headers = headers;\n  requestInfo.body = body.uploadData();\n  requestInfo.progressCallback = progressCallback || null;\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nvar Observer =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function Observer(nextOrObserver, error, complete) {\n    var asFunctions = isFunction(nextOrObserver) || error != null || complete != null;\n\n    if (asFunctions) {\n      this.next = nextOrObserver;\n      this.error = error;\n      this.complete = complete;\n    } else {\n      var observer = nextOrObserver;\n      this.next = observer.next;\n      this.error = observer.error;\n      this.complete = observer.complete;\n    }\n  }\n\n  return Observer;\n}();\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Returns a function that invokes f with its arguments asynchronously as a\n * microtask, i.e. as soon as possible after the current script returns back\n * into browser code.\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\n\n\nfunction index_esm_async(f) {\n  return function () {\n    var argsToForward = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      argsToForward[_i] = arguments[_i];\n    } // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n    Promise.resolve().then(function () {\n      return f.apply(void 0, argsToForward);\n    });\n  };\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Represents a blob being uploaded. Can be used to pause/resume/cancel the\n * upload and manage callbacks for various events.\n * @internal\n */\n\n\nvar UploadTask =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  /**\n   * @param ref - The firebaseStorage.Reference object this task came\n   *     from, untyped to avoid cyclic dependencies.\n   * @param blob - The blob to upload.\n   */\n  function UploadTask(ref, blob, metadata) {\n    var _this = this;\n\n    if (metadata === void 0) {\n      metadata = null;\n    }\n    /**\n     * Number of bytes transferred so far.\n     */\n\n\n    this._transferred = 0;\n    this._needToFetchStatus = false;\n    this._needToFetchMetadata = false;\n    this._observers = [];\n    this._error = undefined;\n    this._uploadUrl = undefined;\n    this._request = undefined;\n    this._chunkMultiplier = 1;\n    this._resolve = undefined;\n    this._reject = undefined;\n    this._ref = ref;\n    this._blob = blob;\n    this._metadata = metadata;\n    this._mappings = getMappings();\n    this._resumable = this._shouldDoResumable(this._blob);\n    this._state = \"running\"\n    /* RUNNING */\n    ;\n\n    this._errorHandler = function (error) {\n      _this._request = undefined;\n      _this._chunkMultiplier = 1;\n\n      if (error._codeEquals(\"canceled\"\n      /* CANCELED */\n      )) {\n        _this._needToFetchStatus = true;\n\n        _this.completeTransitions_();\n      } else {\n        _this._error = error;\n\n        _this._transition(\"error\"\n        /* ERROR */\n        );\n      }\n    };\n\n    this._metadataErrorHandler = function (error) {\n      _this._request = undefined;\n\n      if (error._codeEquals(\"canceled\"\n      /* CANCELED */\n      )) {\n        _this.completeTransitions_();\n      } else {\n        _this._error = error;\n\n        _this._transition(\"error\"\n        /* ERROR */\n        );\n      }\n    };\n\n    this._promise = new Promise(function (resolve, reject) {\n      _this._resolve = resolve;\n      _this._reject = reject;\n\n      _this._start();\n    }); // Prevent uncaught rejections on the internal promise from bubbling out\n    // to the top level with a dummy handler.\n\n    this._promise.then(null, function () {});\n  }\n\n  UploadTask.prototype._makeProgressCallback = function () {\n    var _this = this;\n\n    var sizeBefore = this._transferred;\n    return function (loaded) {\n      return _this._updateProgress(sizeBefore + loaded);\n    };\n  };\n\n  UploadTask.prototype._shouldDoResumable = function (blob) {\n    return blob.size() > 256 * 1024;\n  };\n\n  UploadTask.prototype._start = function () {\n    if (this._state !== \"running\"\n    /* RUNNING */\n    ) {\n        // This can happen if someone pauses us in a resume callback, for example.\n        return;\n      }\n\n    if (this._request !== undefined) {\n      return;\n    }\n\n    if (this._resumable) {\n      if (this._uploadUrl === undefined) {\n        this._createResumable();\n      } else {\n        if (this._needToFetchStatus) {\n          this._fetchStatus();\n        } else {\n          if (this._needToFetchMetadata) {\n            // Happens if we miss the metadata on upload completion.\n            this._fetchMetadata();\n          } else {\n            this._continueUpload();\n          }\n        }\n      }\n    } else {\n      this._oneShotUpload();\n    }\n  };\n\n  UploadTask.prototype._resolveToken = function (callback) {\n    var _this = this; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n    this._ref.storage._getAuthToken().then(function (authToken) {\n      switch (_this._state) {\n        case \"running\"\n        /* RUNNING */\n        :\n          callback(authToken);\n          break;\n\n        case \"canceling\"\n        /* CANCELING */\n        :\n          _this._transition(\"canceled\"\n          /* CANCELED */\n          );\n\n          break;\n\n        case \"pausing\"\n        /* PAUSING */\n        :\n          _this._transition(\"paused\"\n          /* PAUSED */\n          );\n\n          break;\n      }\n    });\n  }; // TODO(andysoto): assert false\n\n\n  UploadTask.prototype._createResumable = function () {\n    var _this = this;\n\n    this._resolveToken(function (authToken) {\n      var requestInfo = createResumableUpload(_this._ref.storage, _this._ref._location, _this._mappings, _this._blob, _this._metadata);\n\n      var createRequest = _this._ref.storage._makeRequest(requestInfo, authToken);\n\n      _this._request = createRequest;\n      createRequest.getPromise().then(function (url) {\n        _this._request = undefined;\n        _this._uploadUrl = url;\n        _this._needToFetchStatus = false;\n\n        _this.completeTransitions_();\n      }, _this._errorHandler);\n    });\n  };\n\n  UploadTask.prototype._fetchStatus = function () {\n    var _this = this; // TODO(andysoto): assert(this.uploadUrl_ !== null);\n\n\n    var url = this._uploadUrl;\n\n    this._resolveToken(function (authToken) {\n      var requestInfo = getResumableUploadStatus(_this._ref.storage, _this._ref._location, url, _this._blob);\n\n      var statusRequest = _this._ref.storage._makeRequest(requestInfo, authToken);\n\n      _this._request = statusRequest;\n      statusRequest.getPromise().then(function (status) {\n        status = status;\n        _this._request = undefined;\n\n        _this._updateProgress(status.current);\n\n        _this._needToFetchStatus = false;\n\n        if (status.finalized) {\n          _this._needToFetchMetadata = true;\n        }\n\n        _this.completeTransitions_();\n      }, _this._errorHandler);\n    });\n  };\n\n  UploadTask.prototype._continueUpload = function () {\n    var _this = this;\n\n    var chunkSize = RESUMABLE_UPLOAD_CHUNK_SIZE * this._chunkMultiplier;\n    var status = new ResumableUploadStatus(this._transferred, this._blob.size()); // TODO(andysoto): assert(this.uploadUrl_ !== null);\n\n    var url = this._uploadUrl;\n\n    this._resolveToken(function (authToken) {\n      var requestInfo;\n\n      try {\n        requestInfo = continueResumableUpload(_this._ref._location, _this._ref.storage, url, _this._blob, chunkSize, _this._mappings, status, _this._makeProgressCallback());\n      } catch (e) {\n        _this._error = e;\n\n        _this._transition(\"error\"\n        /* ERROR */\n        );\n\n        return;\n      }\n\n      var uploadRequest = _this._ref.storage._makeRequest(requestInfo, authToken);\n\n      _this._request = uploadRequest;\n      uploadRequest.getPromise().then(function (newStatus) {\n        _this._increaseMultiplier();\n\n        _this._request = undefined;\n\n        _this._updateProgress(newStatus.current);\n\n        if (newStatus.finalized) {\n          _this._metadata = newStatus.metadata;\n\n          _this._transition(\"success\"\n          /* SUCCESS */\n          );\n        } else {\n          _this.completeTransitions_();\n        }\n      }, _this._errorHandler);\n    });\n  };\n\n  UploadTask.prototype._increaseMultiplier = function () {\n    var currentSize = RESUMABLE_UPLOAD_CHUNK_SIZE * this._chunkMultiplier; // Max chunk size is 32M.\n\n    if (currentSize < 32 * 1024 * 1024) {\n      this._chunkMultiplier *= 2;\n    }\n  };\n\n  UploadTask.prototype._fetchMetadata = function () {\n    var _this = this;\n\n    this._resolveToken(function (authToken) {\n      var requestInfo = index_esm_getMetadata(_this._ref.storage, _this._ref._location, _this._mappings);\n\n      var metadataRequest = _this._ref.storage._makeRequest(requestInfo, authToken);\n\n      _this._request = metadataRequest;\n      metadataRequest.getPromise().then(function (metadata) {\n        _this._request = undefined;\n        _this._metadata = metadata;\n\n        _this._transition(\"success\"\n        /* SUCCESS */\n        );\n      }, _this._metadataErrorHandler);\n    });\n  };\n\n  UploadTask.prototype._oneShotUpload = function () {\n    var _this = this;\n\n    this._resolveToken(function (authToken) {\n      var requestInfo = multipartUpload(_this._ref.storage, _this._ref._location, _this._mappings, _this._blob, _this._metadata);\n\n      var multipartRequest = _this._ref.storage._makeRequest(requestInfo, authToken);\n\n      _this._request = multipartRequest;\n      multipartRequest.getPromise().then(function (metadata) {\n        _this._request = undefined;\n        _this._metadata = metadata;\n\n        _this._updateProgress(_this._blob.size());\n\n        _this._transition(\"success\"\n        /* SUCCESS */\n        );\n      }, _this._errorHandler);\n    });\n  };\n\n  UploadTask.prototype._updateProgress = function (transferred) {\n    var old = this._transferred;\n    this._transferred = transferred; // A progress update can make the \"transferred\" value smaller (e.g. a\n    // partial upload not completed by server, after which the \"transferred\"\n    // value may reset to the value at the beginning of the request).\n\n    if (this._transferred !== old) {\n      this._notifyObservers();\n    }\n  };\n\n  UploadTask.prototype._transition = function (state) {\n    if (this._state === state) {\n      return;\n    }\n\n    switch (state) {\n      case \"canceling\"\n      /* CANCELING */\n      :\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.RUNNING ||\n        //        this.state_ === InternalTaskState.PAUSING);\n        this._state = state;\n\n        if (this._request !== undefined) {\n          this._request.cancel();\n        }\n\n        break;\n\n      case \"pausing\"\n      /* PAUSING */\n      :\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.RUNNING);\n        this._state = state;\n\n        if (this._request !== undefined) {\n          this._request.cancel();\n        }\n\n        break;\n\n      case \"running\"\n      /* RUNNING */\n      :\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.PAUSED ||\n        //        this.state_ === InternalTaskState.PAUSING);\n        var wasPaused = this._state === \"paused\"\n        /* PAUSED */\n        ;\n        this._state = state;\n\n        if (wasPaused) {\n          this._notifyObservers();\n\n          this._start();\n        }\n\n        break;\n\n      case \"paused\"\n      /* PAUSED */\n      :\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.PAUSING);\n        this._state = state;\n\n        this._notifyObservers();\n\n        break;\n\n      case \"canceled\"\n      /* CANCELED */\n      :\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.PAUSED ||\n        //        this.state_ === InternalTaskState.CANCELING);\n        this._error = index_esm_canceled();\n        this._state = state;\n\n        this._notifyObservers();\n\n        break;\n\n      case \"error\"\n      /* ERROR */\n      :\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.RUNNING ||\n        //        this.state_ === InternalTaskState.PAUSING ||\n        //        this.state_ === InternalTaskState.CANCELING);\n        this._state = state;\n\n        this._notifyObservers();\n\n        break;\n\n      case \"success\"\n      /* SUCCESS */\n      :\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.RUNNING ||\n        //        this.state_ === InternalTaskState.PAUSING ||\n        //        this.state_ === InternalTaskState.CANCELING);\n        this._state = state;\n\n        this._notifyObservers();\n\n        break;\n    }\n  };\n\n  UploadTask.prototype.completeTransitions_ = function () {\n    switch (this._state) {\n      case \"pausing\"\n      /* PAUSING */\n      :\n        this._transition(\"paused\"\n        /* PAUSED */\n        );\n\n        break;\n\n      case \"canceling\"\n      /* CANCELING */\n      :\n        this._transition(\"canceled\"\n        /* CANCELED */\n        );\n\n        break;\n\n      case \"running\"\n      /* RUNNING */\n      :\n        this._start();\n\n        break;\n    }\n  };\n\n  Object.defineProperty(UploadTask.prototype, \"snapshot\", {\n    /**\n     * A snapshot of the current task state.\n     */\n    get: function get() {\n      var externalState = taskStateFromInternalTaskState(this._state);\n      return {\n        bytesTransferred: this._transferred,\n        totalBytes: this._blob.size(),\n        state: externalState,\n        metadata: this._metadata,\n        task: this,\n        ref: this._ref\n      };\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Adds a callback for an event.\n   * @param type - The type of event to listen for.\n   * @param nextOrObserver -\n   *     The `next` function, which gets called for each item in\n   *     the event stream, or an observer object with some or all of these three\n   *     properties (`next`, `error`, `complete`).\n   * @param error - A function that gets called with a `FirebaseStorageError`\n   *     if the event stream ends due to an error.\n   * @param completed - A function that gets called if the\n   *     event stream ends normally.\n   * @returns\n   *     If only the event argument is passed, returns a function you can use to\n   *     add callbacks (see the examples above). If more than just the event\n   *     argument is passed, returns a function you can call to unregister the\n   *     callbacks.\n   */\n\n  UploadTask.prototype.on = function (type, nextOrObserver, error, completed) {\n    var _this = this;\n\n    var observer = new Observer(nextOrObserver, error, completed);\n\n    this._addObserver(observer);\n\n    return function () {\n      _this._removeObserver(observer);\n    };\n  };\n  /**\n   * This object behaves like a Promise, and resolves with its snapshot data\n   * when the upload completes.\n   * @param onFulfilled - The fulfillment callback. Promise chaining works as normal.\n   * @param onRejected - The rejection callback.\n   */\n\n\n  UploadTask.prototype.then = function (onFulfilled, onRejected) {\n    // These casts are needed so that TypeScript can infer the types of the\n    // resulting Promise.\n    return this._promise.then(onFulfilled, onRejected);\n  };\n  /**\n   * Equivalent to calling `then(null, onRejected)`.\n   */\n\n\n  UploadTask.prototype.catch = function (onRejected) {\n    return this.then(null, onRejected);\n  };\n  /**\n   * Adds the given observer.\n   */\n\n\n  UploadTask.prototype._addObserver = function (observer) {\n    this._observers.push(observer);\n\n    this._notifyObserver(observer);\n  };\n  /**\n   * Removes the given observer.\n   */\n\n\n  UploadTask.prototype._removeObserver = function (observer) {\n    var i = this._observers.indexOf(observer);\n\n    if (i !== -1) {\n      this._observers.splice(i, 1);\n    }\n  };\n\n  UploadTask.prototype._notifyObservers = function () {\n    var _this = this;\n\n    this._finishPromise();\n\n    var observers = this._observers.slice();\n\n    observers.forEach(function (observer) {\n      _this._notifyObserver(observer);\n    });\n  };\n\n  UploadTask.prototype._finishPromise = function () {\n    if (this._resolve !== undefined) {\n      var triggered = true;\n\n      switch (taskStateFromInternalTaskState(this._state)) {\n        case TaskState.SUCCESS:\n          index_esm_async(this._resolve.bind(null, this.snapshot))();\n          break;\n\n        case TaskState.CANCELED:\n        case TaskState.ERROR:\n          var toCall = this._reject;\n          index_esm_async(toCall.bind(null, this._error))();\n          break;\n\n        default:\n          triggered = false;\n          break;\n      }\n\n      if (triggered) {\n        this._resolve = undefined;\n        this._reject = undefined;\n      }\n    }\n  };\n\n  UploadTask.prototype._notifyObserver = function (observer) {\n    var externalState = taskStateFromInternalTaskState(this._state);\n\n    switch (externalState) {\n      case TaskState.RUNNING:\n      case TaskState.PAUSED:\n        if (observer.next) {\n          index_esm_async(observer.next.bind(observer, this.snapshot))();\n        }\n\n        break;\n\n      case TaskState.SUCCESS:\n        if (observer.complete) {\n          index_esm_async(observer.complete.bind(observer))();\n        }\n\n        break;\n\n      case TaskState.CANCELED:\n      case TaskState.ERROR:\n        if (observer.error) {\n          index_esm_async(observer.error.bind(observer, this._error))();\n        }\n\n        break;\n\n      default:\n        // TODO(andysoto): assert(false);\n        if (observer.error) {\n          index_esm_async(observer.error.bind(observer, this._error))();\n        }\n\n    }\n  };\n  /**\n   * Resumes a paused task. Has no effect on a currently running or failed task.\n   * @returns True if the operation took effect, false if ignored.\n   */\n\n\n  UploadTask.prototype.resume = function () {\n    var valid = this._state === \"paused\"\n    /* PAUSED */\n    || this._state === \"pausing\"\n    /* PAUSING */\n    ;\n\n    if (valid) {\n      this._transition(\"running\"\n      /* RUNNING */\n      );\n    }\n\n    return valid;\n  };\n  /**\n   * Pauses a currently running task. Has no effect on a paused or failed task.\n   * @returns True if the operation took effect, false if ignored.\n   */\n\n\n  UploadTask.prototype.pause = function () {\n    var valid = this._state === \"running\"\n    /* RUNNING */\n    ;\n\n    if (valid) {\n      this._transition(\"pausing\"\n      /* PAUSING */\n      );\n    }\n\n    return valid;\n  };\n  /**\n   * Cancels a currently running or paused task. Has no effect on a complete or\n   * failed task.\n   * @returns True if the operation took effect, false if ignored.\n   */\n\n\n  UploadTask.prototype.cancel = function () {\n    var valid = this._state === \"running\"\n    /* RUNNING */\n    || this._state === \"pausing\"\n    /* PAUSING */\n    ;\n\n    if (valid) {\n      this._transition(\"canceling\"\n      /* CANCELING */\n      );\n    }\n\n    return valid;\n  };\n\n  return UploadTask;\n}();\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Provides methods to interact with a bucket in the Firebase Storage service.\n * @internal\n * @param _location - An fbs.location, or the URL at\n *     which to base this object, in one of the following forms:\n *         gs://<bucket>/<object-path>\n *         http[s]://firebasestorage.googleapis.com/\n *                     <api-version>/b/<bucket>/o/<object-path>\n *     Any query or fragment strings will be ignored in the http[s]\n *     format. If no value is passed, the storage object will use a URL based on\n *     the project ID of the base firebase.App instance.\n */\n\n\nvar Reference =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function Reference(_service, location) {\n    this._service = _service;\n\n    if (location instanceof Location) {\n      this._location = location;\n    } else {\n      this._location = Location.makeFromUrl(location);\n    }\n  }\n  /**\n   * Returns the URL for the bucket and path this object references,\n   *     in the form gs://<bucket>/<object-path>\n   * @override\n   */\n\n\n  Reference.prototype.toString = function () {\n    return 'gs://' + this._location.bucket + '/' + this._location.path;\n  };\n\n  Reference.prototype._newRef = function (service, location) {\n    return new Reference(service, location);\n  };\n\n  Object.defineProperty(Reference.prototype, \"root\", {\n    /**\n     * A reference to the root of this object's bucket.\n     */\n    get: function get() {\n      var location = new Location(this._location.bucket, '');\n      return this._newRef(this._service, location);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"bucket\", {\n    /**\n     * The name of the bucket containing this reference's object.\n     */\n    get: function get() {\n      return this._location.bucket;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"fullPath\", {\n    /**\n     * The full path of this object.\n     */\n    get: function get() {\n      return this._location.path;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"name\", {\n    /**\n     * The short name of this object, which is the last component of the full path.\n     * For example, if fullPath is 'full/path/image.png', name is 'image.png'.\n     */\n    get: function get() {\n      return lastComponent(this._location.path);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"storage\", {\n    /**\n     * The `StorageService` instance this `StorageReference` is associated with.\n     */\n    get: function get() {\n      return this._service;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"parent\", {\n    /**\n     * A `StorageReference` pointing to the parent location of this `StorageReference`, or null if\n     * this reference is the root.\n     */\n    get: function get() {\n      var newPath = index_esm_parent(this._location.path);\n\n      if (newPath === null) {\n        return null;\n      }\n\n      var location = new Location(this._location.bucket, newPath);\n      return new Reference(this._service, location);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Utility function to throw an error in methods that do not accept a root reference.\n   */\n\n  Reference.prototype._throwIfRoot = function (name) {\n    if (this._location.path === '') {\n      throw invalidRootOperation(name);\n    }\n  };\n\n  return Reference;\n}();\n/**\n * Uploads data to this object's location.\n * The upload can be paused and resumed, and exposes progress updates.\n * @public\n * @param ref - StorageReference where data should be uploaded.\n * @param data - The data to upload.\n * @param metadata - Metadata for the newly uploaded data.\n * @returns An UploadTask\n */\n\n\nfunction uploadBytesResumable(ref, data, metadata) {\n  ref._throwIfRoot('uploadBytesResumable');\n\n  return new UploadTask(ref, new FbsBlob(data), metadata);\n}\n/**\n * List all items (files) and prefixes (folders) under this storage reference.\n *\n * This is a helper method for calling list() repeatedly until there are\n * no more results. The default pagination size is 1000.\n *\n * Note: The results may not be consistent if objects are changed while this\n * operation is running.\n *\n * Warning: listAll may potentially consume too many resources if there are\n * too many results.\n * @public\n * @param ref - StorageReference to get list from.\n *\n * @returns A Promise that resolves with all the items and prefixes under\n *      the current storage reference. `prefixes` contains references to\n *      sub-directories and `items` contains references to objects in this\n *      folder. `nextPageToken` is never returned.\n */\n\n\nfunction index_esm_listAll(ref) {\n  var accumulator = {\n    prefixes: [],\n    items: []\n  };\n  return listAllHelper(ref, accumulator).then(function () {\n    return accumulator;\n  });\n}\n/**\n * Separated from listAll because async functions can't use \"arguments\".\n * @param ref\n * @param accumulator\n * @param pageToken\n */\n\n\nfunction listAllHelper(ref, accumulator, pageToken) {\n  return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n    var opt, nextPage;\n\n    var _a, _b;\n\n    return Object(tslib_es6[\"e\" /* __generator */])(this, function (_c) {\n      switch (_c.label) {\n        case 0:\n          opt = {\n            // maxResults is 1000 by default.\n            pageToken: pageToken\n          };\n          return [4\n          /*yield*/\n          , list$1(ref, opt)];\n\n        case 1:\n          nextPage = _c.sent();\n\n          (_a = accumulator.prefixes).push.apply(_a, nextPage.prefixes);\n\n          (_b = accumulator.items).push.apply(_b, nextPage.items);\n\n          if (!(nextPage.nextPageToken != null)) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , listAllHelper(ref, accumulator, nextPage.nextPageToken)];\n\n        case 2:\n          _c.sent();\n\n          _c.label = 3;\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\n * List items (files) and prefixes (folders) under this storage reference.\n *\n * List API is only available for Firebase Rules Version 2.\n *\n * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\n * delimited folder structure.\n * Refer to GCS's List API if you want to learn more.\n *\n * To adhere to Firebase Rules's Semantics, Firebase Storage does not\n * support objects whose paths end with \"/\" or contain two consecutive\n * \"/\"s. Firebase Storage List API will filter these unsupported objects.\n * list() may fail if there are too many unsupported objects in the bucket.\n * @public\n *\n * @param ref - StorageReference to get list from.\n * @param options - See ListOptions for details.\n * @returns A Promise that resolves with the items and prefixes.\n *      `prefixes` contains references to sub-folders and `items`\n *      contains references to objects in this folder. `nextPageToken`\n *      can be used to get the rest of the results.\n */\n\n\nfunction list$1(ref, options) {\n  return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n    var authToken, op, requestInfo;\n    return Object(tslib_es6[\"e\" /* __generator */])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (options != null) {\n            if (typeof options.maxResults === 'number') {\n              validateNumber('options.maxResults',\n              /* minValue= */\n              1,\n              /* maxValue= */\n              1000, options.maxResults);\n            }\n          }\n\n          return [4\n          /*yield*/\n          , ref.storage._getAuthToken()];\n\n        case 1:\n          authToken = _a.sent();\n          op = options || {};\n          requestInfo = list(ref.storage, ref._location,\n          /*delimiter= */\n          '/', op.pageToken, op.maxResults);\n          return [2\n          /*return*/\n          , ref.storage._makeRequest(requestInfo, authToken).getPromise()];\n      }\n    });\n  });\n}\n/**\n * A promise that resolves with the metadata for this object. If this\n * object doesn't exist or metadata cannot be retreived, the promise is\n * rejected.\n * @public\n * @param ref - StorageReference to get metadata from.\n */\n\n\nfunction getMetadata$1(ref) {\n  return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n    var authToken, requestInfo;\n    return Object(tslib_es6[\"e\" /* __generator */])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          ref._throwIfRoot('getMetadata');\n\n          return [4\n          /*yield*/\n          , ref.storage._getAuthToken()];\n\n        case 1:\n          authToken = _a.sent();\n          requestInfo = index_esm_getMetadata(ref.storage, ref._location, getMappings());\n          return [2\n          /*return*/\n          , ref.storage._makeRequest(requestInfo, authToken).getPromise()];\n      }\n    });\n  });\n}\n/**\n * Updates the metadata for this object.\n * @public\n * @param ref - StorageReference to update metadata for.\n * @param metadata - The new metadata for the object.\n *     Only values that have been explicitly set will be changed. Explicitly\n *     setting a value to null will remove the metadata.\n * @returns A promise that resolves\n *     with the new metadata for this object.\n *     See `firebaseStorage.Reference.prototype.getMetadata`\n */\n\n\nfunction updateMetadata$1(ref, metadata) {\n  return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n    var authToken, requestInfo;\n    return Object(tslib_es6[\"e\" /* __generator */])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          ref._throwIfRoot('updateMetadata');\n\n          return [4\n          /*yield*/\n          , ref.storage._getAuthToken()];\n\n        case 1:\n          authToken = _a.sent();\n          requestInfo = index_esm_updateMetadata(ref.storage, ref._location, metadata, getMappings());\n          return [2\n          /*return*/\n          , ref.storage._makeRequest(requestInfo, authToken).getPromise()];\n      }\n    });\n  });\n}\n/**\n * Returns the download URL for the given Reference.\n * @public\n * @returns A promise that resolves with the download\n *     URL for this object.\n */\n\n\nfunction index_esm_getDownloadURL(ref) {\n  return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n    var authToken, requestInfo;\n    return Object(tslib_es6[\"e\" /* __generator */])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          ref._throwIfRoot('getDownloadURL');\n\n          return [4\n          /*yield*/\n          , ref.storage._getAuthToken()];\n\n        case 1:\n          authToken = _a.sent();\n          requestInfo = getDownloadUrl(ref.storage, ref._location, getMappings());\n          return [2\n          /*return*/\n          , ref.storage._makeRequest(requestInfo, authToken).getPromise().then(function (url) {\n            if (url === null) {\n              throw noDownloadURL();\n            }\n\n            return url;\n          })];\n      }\n    });\n  });\n}\n/**\n * Deletes the object at this location.\n * @public\n * @param ref - StorageReference for object to delete.\n * @returns A promise that resolves if the deletion succeeds.\n */\n\n\nfunction deleteObject$1(ref) {\n  return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n    var authToken, requestInfo;\n    return Object(tslib_es6[\"e\" /* __generator */])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          ref._throwIfRoot('deleteObject');\n\n          return [4\n          /*yield*/\n          , ref.storage._getAuthToken()];\n\n        case 1:\n          authToken = _a.sent();\n          requestInfo = deleteObject(ref.storage, ref._location);\n          return [2\n          /*return*/\n          , ref.storage._makeRequest(requestInfo, authToken).getPromise()];\n      }\n    });\n  });\n}\n/**\n * Returns reference for object obtained by appending `childPath` to `ref`.\n *\n * @param ref - StorageReference to get child of.\n * @param childPath - Child path from provided ref.\n * @returns A reference to the object obtained by\n * appending childPath, removing any duplicate, beginning, or trailing\n * slashes.\n *\n */\n\n\nfunction _getChild(ref, childPath) {\n  var newPath = child(ref._location.path, childPath);\n  var location = new Location(ref._location.bucket, newPath);\n  return new Reference(ref.storage, location);\n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nfunction isUrl(path) {\n  return /^[A-Za-z]+:\\/\\//.test(path);\n}\n/**\n * Returns a firebaseStorage.Reference for the given url.\n */\n\n\nfunction refFromURL(service, url) {\n  return new Reference(service, url);\n}\n/**\n * Returns a firebaseStorage.Reference for the given path in the default\n * bucket.\n */\n\n\nfunction refFromPath(ref, path) {\n  if (ref instanceof index_esm_StorageService) {\n    var service = ref;\n\n    if (service._bucket == null) {\n      throw noDefaultBucket();\n    }\n\n    var reference = new Reference(service, service._bucket);\n\n    if (path != null) {\n      return refFromPath(reference, path);\n    } else {\n      return reference;\n    }\n  } else {\n    // ref is a Reference\n    if (path !== undefined) {\n      if (path.includes('..')) {\n        throw invalidArgument('`path` param cannot contain \"..\"');\n      }\n\n      return _getChild(ref, path);\n    } else {\n      return ref;\n    }\n  }\n}\n\nfunction index_esm_ref(serviceOrRef, pathOrUrl) {\n  if (pathOrUrl && isUrl(pathOrUrl)) {\n    if (serviceOrRef instanceof index_esm_StorageService) {\n      return refFromURL(serviceOrRef, pathOrUrl);\n    } else {\n      throw invalidArgument('To use ref(service, url), the first argument must be a Storage instance.');\n    }\n  } else {\n    return refFromPath(serviceOrRef, pathOrUrl);\n  }\n}\n\nfunction extractBucket(config) {\n  var bucketString = config === null || config === void 0 ? void 0 : config[CONFIG_STORAGE_BUCKET_KEY];\n\n  if (bucketString == null) {\n    return null;\n  }\n\n  return Location.makeFromBucketSpec(bucketString);\n}\n/**\n * A service that provides Firebase Storage Reference instances.\n * @public\n * @param opt_url - gs:// url to a custom Storage Bucket\n */\n\n\nvar index_esm_StorageService =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function StorageService(\n  /**\n   * FirebaseApp associated with this StorageService instance.\n   */\n  app, _authProvider, _pool, _url, _firebaseVersion) {\n    this.app = app;\n    this._authProvider = _authProvider;\n    this._pool = _pool;\n    this._url = _url;\n    this._firebaseVersion = _firebaseVersion;\n    this._bucket = null;\n    this._appId = null;\n    this._deleted = false;\n    this._maxOperationRetryTime = DEFAULT_MAX_OPERATION_RETRY_TIME;\n    this._maxUploadRetryTime = DEFAULT_MAX_UPLOAD_RETRY_TIME;\n    this._requests = new Set();\n\n    if (_url != null) {\n      this._bucket = Location.makeFromBucketSpec(_url);\n    } else {\n      this._bucket = extractBucket(this.app.options);\n    }\n  }\n\n  Object.defineProperty(StorageService.prototype, \"maxUploadRetryTime\", {\n    /**\n     * The maximum time to retry uploads in milliseconds.\n     */\n    get: function get() {\n      return this._maxUploadRetryTime;\n    },\n    set: function set(time) {\n      validateNumber('time',\n      /* minValue=*/\n      0,\n      /* maxValue= */\n      Number.POSITIVE_INFINITY, time);\n      this._maxUploadRetryTime = time;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StorageService.prototype, \"maxOperationRetryTime\", {\n    /**\n     * The maximum time to retry operations other than uploads or downloads in\n     * milliseconds.\n     */\n    get: function get() {\n      return this._maxOperationRetryTime;\n    },\n    set: function set(time) {\n      validateNumber('time',\n      /* minValue=*/\n      0,\n      /* maxValue= */\n      Number.POSITIVE_INFINITY, time);\n      this._maxOperationRetryTime = time;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StorageService.prototype._getAuthToken = function () {\n    return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n      var auth, tokenData;\n      return Object(tslib_es6[\"e\" /* __generator */])(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            auth = this._authProvider.getImmediate({\n              optional: true\n            });\n            if (!auth) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , auth.getToken()];\n\n          case 1:\n            tokenData = _a.sent();\n\n            if (tokenData !== null) {\n              return [2\n              /*return*/\n              , tokenData.accessToken];\n            }\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            , null];\n        }\n      });\n    });\n  };\n  /**\n   * Stop running requests and prevent more from being created.\n   */\n\n\n  StorageService.prototype._delete = function () {\n    this._deleted = true;\n\n    this._requests.forEach(function (request) {\n      return request.cancel();\n    });\n\n    this._requests.clear();\n\n    return Promise.resolve();\n  };\n  /**\n   * Returns a new firebaseStorage.Reference object referencing this StorageService\n   * at the given Location.\n   */\n\n\n  StorageService.prototype._makeStorageReference = function (loc) {\n    return new Reference(this, loc);\n  };\n  /**\n   * @param requestInfo - HTTP RequestInfo object\n   * @param authToken - Firebase auth token\n   */\n\n\n  StorageService.prototype._makeRequest = function (requestInfo, authToken) {\n    var _this = this;\n\n    if (!this._deleted) {\n      var request_1 = makeRequest(requestInfo, this._appId, authToken, this._pool, this._firebaseVersion);\n\n      this._requests.add(request_1); // Request removes itself from set when complete.\n\n\n      request_1.getPromise().then(function () {\n        return _this._requests.delete(request_1);\n      }, function () {\n        return _this._requests.delete(request_1);\n      });\n      return request_1;\n    } else {\n      return new FailRequest(appDeleted());\n    }\n  };\n\n  return StorageService;\n}();\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Uploads data to this object's location.\n * The upload can be paused and resumed, and exposes progress updates.\n * @public\n * @param ref - StorageReference where data should be uploaded.\n * @param data - The data to upload.\n * @param metadata - Metadata for the data to upload.\n * @returns An UploadTask\n */\n\n\nfunction uploadBytesResumable$1(ref, data, metadata) {\n  return uploadBytesResumable(ref, data, metadata);\n}\n/**\n * A promise that resolves with the metadata for this object. If this\n * object doesn't exist or metadata cannot be retreived, the promise is\n * rejected.\n * @public\n * @param ref - StorageReference to get metadata from.\n */\n\n\nfunction getMetadata$2(ref) {\n  return getMetadata$1(ref);\n}\n/**\n * Updates the metadata for this object.\n * @public\n * @param ref - StorageReference to update metadata for.\n * @param metadata - The new metadata for the object.\n *     Only values that have been explicitly set will be changed. Explicitly\n *     setting a value to null will remove the metadata.\n * @returns A promise that resolves with the new metadata for this object.\n */\n\n\nfunction updateMetadata$2(ref, metadata) {\n  return updateMetadata$1(ref, metadata);\n}\n/**\n * List items (files) and prefixes (folders) under this storage reference.\n *\n * List API is only available for Firebase Rules Version 2.\n *\n * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\n * delimited folder structure.\n * Refer to GCS's List API if you want to learn more.\n *\n * To adhere to Firebase Rules's Semantics, Firebase Storage does not\n * support objects whose paths end with \"/\" or contain two consecutive\n * \"/\"s. Firebase Storage List API will filter these unsupported objects.\n * list() may fail if there are too many unsupported objects in the bucket.\n * @public\n *\n * @param ref - StorageReference to get list from.\n * @param options - See ListOptions for details.\n * @returns A Promise that resolves with the items and prefixes.\n *      `prefixes` contains references to sub-folders and `items`\n *      contains references to objects in this folder. `nextPageToken`\n *      can be used to get the rest of the results.\n */\n\n\nfunction list$2(ref, options) {\n  return list$1(ref, options);\n}\n/**\n * List all items (files) and prefixes (folders) under this storage reference.\n *\n * This is a helper method for calling list() repeatedly until there are\n * no more results. The default pagination size is 1000.\n *\n * Note: The results may not be consistent if objects are changed while this\n * operation is running.\n *\n * Warning: listAll may potentially consume too many resources if there are\n * too many results.\n * @public\n * @param ref - StorageReference to get list from.\n *\n * @returns A Promise that resolves with all the items and prefixes under\n *      the current storage reference. `prefixes` contains references to\n *      sub-directories and `items` contains references to objects in this\n *      folder. `nextPageToken` is never returned.\n */\n\n\nfunction listAll$1(ref) {\n  return index_esm_listAll(ref);\n}\n/**\n * Returns the download URL for the given Reference.\n * @public\n * @returns A promise that resolves with the download\n *     URL for this object.\n */\n\n\nfunction getDownloadURL$1(ref) {\n  return index_esm_getDownloadURL(ref);\n}\n/**\n * Deletes the object at this location.\n * @public\n * @param ref - StorageReference for object to delete.\n * @returns A promise that resolves if the deletion succeeds.\n */\n\n\nfunction deleteObject$2(ref) {\n  return deleteObject$1(ref);\n}\n\nfunction ref$1(serviceOrRef, pathOrUrl) {\n  return index_esm_ref(serviceOrRef, pathOrUrl);\n}\n/**\n * @internal\n */\n\n\nfunction _getChild$1(ref, childPath) {\n  return _getChild(ref, childPath);\n}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nvar UploadTaskSnapshotCompat =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function UploadTaskSnapshotCompat(_delegate, task, ref) {\n    this._delegate = _delegate;\n    this.task = task;\n    this.ref = ref;\n  }\n\n  Object.defineProperty(UploadTaskSnapshotCompat.prototype, \"bytesTransferred\", {\n    get: function get() {\n      return this._delegate.bytesTransferred;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(UploadTaskSnapshotCompat.prototype, \"metadata\", {\n    get: function get() {\n      return this._delegate.metadata;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(UploadTaskSnapshotCompat.prototype, \"state\", {\n    get: function get() {\n      return this._delegate.state;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(UploadTaskSnapshotCompat.prototype, \"totalBytes\", {\n    get: function get() {\n      return this._delegate.totalBytes;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return UploadTaskSnapshotCompat;\n}();\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nvar UploadTaskCompat =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function UploadTaskCompat(_delegate, _ref) {\n    this._delegate = _delegate;\n    this._ref = _ref;\n    this.cancel = this._delegate.cancel.bind(this._delegate);\n    this.catch = this._delegate.catch.bind(this._delegate);\n    this.pause = this._delegate.pause.bind(this._delegate);\n    this.resume = this._delegate.resume.bind(this._delegate);\n  }\n\n  Object.defineProperty(UploadTaskCompat.prototype, \"snapshot\", {\n    get: function get() {\n      return new UploadTaskSnapshotCompat(this._delegate.snapshot, this, this._ref);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  UploadTaskCompat.prototype.then = function (onFulfilled, onRejected) {\n    var _this = this;\n\n    return this._delegate.then(function (snapshot) {\n      if (onFulfilled) {\n        return onFulfilled(new UploadTaskSnapshotCompat(snapshot, _this, _this._ref));\n      }\n    }, onRejected);\n  };\n\n  UploadTaskCompat.prototype.on = function (type, nextOrObserver, error, completed) {\n    var _this = this;\n\n    var wrappedNextOrObserver = undefined;\n\n    if (!!nextOrObserver) {\n      if (typeof nextOrObserver === 'function') {\n        wrappedNextOrObserver = function wrappedNextOrObserver(taskSnapshot) {\n          return nextOrObserver(new UploadTaskSnapshotCompat(taskSnapshot, _this, _this._ref));\n        };\n      } else {\n        wrappedNextOrObserver = {\n          next: !!nextOrObserver.next ? function (taskSnapshot) {\n            return nextOrObserver.next(new UploadTaskSnapshotCompat(taskSnapshot, _this, _this._ref));\n          } : undefined,\n          complete: nextOrObserver.complete || undefined,\n          error: nextOrObserver.error || undefined\n        };\n      }\n    }\n\n    return this._delegate.on(type, wrappedNextOrObserver, error || undefined, completed || undefined);\n  };\n\n  return UploadTaskCompat;\n}();\n\nvar ListResultCompat =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function ListResultCompat(_delegate, _service) {\n    this._delegate = _delegate;\n    this._service = _service;\n  }\n\n  Object.defineProperty(ListResultCompat.prototype, \"prefixes\", {\n    get: function get() {\n      var _this = this;\n\n      return this._delegate.prefixes.map(function (ref) {\n        return new index_esm_ReferenceCompat(ref, _this._service);\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(ListResultCompat.prototype, \"items\", {\n    get: function get() {\n      var _this = this;\n\n      return this._delegate.items.map(function (ref) {\n        return new index_esm_ReferenceCompat(ref, _this._service);\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(ListResultCompat.prototype, \"nextPageToken\", {\n    get: function get() {\n      return this._delegate.nextPageToken || null;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return ListResultCompat;\n}();\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *  http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nvar index_esm_ReferenceCompat =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function ReferenceCompat(_delegate, storage) {\n    this._delegate = _delegate;\n    this.storage = storage;\n  }\n\n  Object.defineProperty(ReferenceCompat.prototype, \"name\", {\n    get: function get() {\n      return this._delegate.name;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(ReferenceCompat.prototype, \"bucket\", {\n    get: function get() {\n      return this._delegate.bucket;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(ReferenceCompat.prototype, \"fullPath\", {\n    get: function get() {\n      return this._delegate.fullPath;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  ReferenceCompat.prototype.toString = function () {\n    return this._delegate.toString();\n  };\n  /**\n   * @returns A reference to the object obtained by\n   * appending childPath, removing any duplicate, beginning, or trailing\n   * slashes.\n   */\n\n\n  ReferenceCompat.prototype.child = function (childPath) {\n    var reference = _getChild$1(this._delegate, childPath);\n\n    return new ReferenceCompat(reference, this.storage);\n  };\n\n  Object.defineProperty(ReferenceCompat.prototype, \"root\", {\n    get: function get() {\n      return new ReferenceCompat(this._delegate.root, this.storage);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(ReferenceCompat.prototype, \"parent\", {\n    /**\n     * @returns A reference to the parent of the\n     * current object, or null if the current object is the root.\n     */\n    get: function get() {\n      var reference = this._delegate.parent;\n\n      if (reference == null) {\n        return null;\n      }\n\n      return new ReferenceCompat(reference, this.storage);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Uploads a blob to this object's location.\n   * @param data - The blob to upload.\n   * @returns An UploadTask that lets you control and\n   * observe the upload.\n   */\n\n  ReferenceCompat.prototype.put = function (data, metadata) {\n    this._throwIfRoot('put');\n\n    return new UploadTaskCompat(uploadBytesResumable$1(this._delegate, data, metadata), this);\n  };\n  /**\n   * Uploads a string to this object's location.\n   * @param value - The string to upload.\n   * @param format - The format of the string to upload.\n   * @returns An UploadTask that lets you control and\n   * observe the upload.\n   */\n\n\n  ReferenceCompat.prototype.putString = function (value, format, metadata) {\n    if (format === void 0) {\n      format = StringFormat.RAW;\n    }\n\n    this._throwIfRoot('putString');\n\n    var data = dataFromString(format, value);\n\n    var metadataClone = Object(tslib_es6[\"a\" /* __assign */])({}, metadata);\n\n    if (metadataClone['contentType'] == null && data.contentType != null) {\n      metadataClone['contentType'] = data.contentType;\n    }\n\n    return new UploadTaskCompat(new UploadTask(this._delegate, new FbsBlob(data.data, true), metadataClone), this);\n  };\n  /**\n   * List all items (files) and prefixes (folders) under this storage reference.\n   *\n   * This is a helper method for calling list() repeatedly until there are\n   * no more results. The default pagination size is 1000.\n   *\n   * Note: The results may not be consistent if objects are changed while this\n   * operation is running.\n   *\n   * Warning: listAll may potentially consume too many resources if there are\n   * too many results.\n   *\n   * @returns A Promise that resolves with all the items and prefixes under\n   *  the current storage reference. `prefixes` contains references to\n   *  sub-directories and `items` contains references to objects in this\n   *  folder. `nextPageToken` is never returned.\n   */\n\n\n  ReferenceCompat.prototype.listAll = function () {\n    var _this = this;\n\n    return listAll$1(this._delegate).then(function (r) {\n      return new ListResultCompat(r, _this.storage);\n    });\n  };\n  /**\n   * List items (files) and prefixes (folders) under this storage reference.\n   *\n   * List API is only available for Firebase Rules Version 2.\n   *\n   * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\n   * delimited folder structure. Refer to GCS's List API if you want to learn more.\n   *\n   * To adhere to Firebase Rules's Semantics, Firebase Storage does not\n   * support objects whose paths end with \"/\" or contain two consecutive\n   * \"/\"s. Firebase Storage List API will filter these unsupported objects.\n   * list() may fail if there are too many unsupported objects in the bucket.\n   *\n   * @param options - See ListOptions for details.\n   * @returns A Promise that resolves with the items and prefixes.\n   * `prefixes` contains references to sub-folders and `items`\n   * contains references to objects in this folder. `nextPageToken`\n   * can be used to get the rest of the results.\n   */\n\n\n  ReferenceCompat.prototype.list = function (options) {\n    var _this = this;\n\n    return list$2(this._delegate, options || undefined).then(function (r) {\n      return new ListResultCompat(r, _this.storage);\n    });\n  };\n  /**\n   * A promise that resolves with the metadata for this object. If this\n   * object doesn't exist or metadata cannot be retreived, the promise is\n   * rejected.\n   */\n\n\n  ReferenceCompat.prototype.getMetadata = function () {\n    return getMetadata$2(this._delegate);\n  };\n  /**\n   * Updates the metadata for this object.\n   * @param metadata - The new metadata for the object.\n   * Only values that have been explicitly set will be changed. Explicitly\n   * setting a value to null will remove the metadata.\n   * @returns A promise that resolves\n   * with the new metadata for this object.\n   * @see firebaseStorage.Reference.prototype.getMetadata\n   */\n\n\n  ReferenceCompat.prototype.updateMetadata = function (metadata) {\n    return updateMetadata$2(this._delegate, metadata);\n  };\n  /**\n   * @returns A promise that resolves with the download\n   * URL for this object.\n   */\n\n\n  ReferenceCompat.prototype.getDownloadURL = function () {\n    return getDownloadURL$1(this._delegate);\n  };\n  /**\n   * Deletes the object at this location.\n   * @returns A promise that resolves if the deletion succeeds.\n   */\n\n\n  ReferenceCompat.prototype.delete = function () {\n    this._throwIfRoot('delete');\n\n    return deleteObject$2(this._delegate);\n  };\n\n  ReferenceCompat.prototype._throwIfRoot = function (name) {\n    if (this._delegate._location.path === '') {\n      throw invalidRootOperation(name);\n    }\n  };\n\n  return ReferenceCompat;\n}();\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * A service that provides firebaseStorage.Reference instances.\n * @param opt_url gs:// url to a custom Storage Bucket\n */\n\n\nvar StorageServiceCompat =\n/** @class */\n\n/*@__PURE__*/\nfunction () {\n  function StorageServiceCompat(app, _delegate) {\n    var _this = this;\n\n    this.app = app;\n    this._delegate = _delegate;\n    this.INTERNAL = {\n      /**\n       * Called when the associated app is deleted.\n       */\n      delete: function _delete() {\n        return _this._delegate._delete();\n      }\n    };\n  }\n\n  Object.defineProperty(StorageServiceCompat.prototype, \"maxOperationRetryTime\", {\n    get: function get() {\n      return this._delegate.maxOperationRetryTime;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StorageServiceCompat.prototype, \"maxUploadRetryTime\", {\n    get: function get() {\n      return this._delegate.maxUploadRetryTime;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Returns a firebaseStorage.Reference for the given path in the default\n   * bucket.\n   */\n\n  StorageServiceCompat.prototype.ref = function (path) {\n    if (isUrl(path)) {\n      throw invalidArgument('ref() expected a child path but got a URL, use refFromURL instead.');\n    }\n\n    return new index_esm_ReferenceCompat(ref$1(this._delegate, path), this);\n  };\n  /**\n   * Returns a firebaseStorage.Reference object for the given absolute URL,\n   * which must be a gs:// or http[s]:// URL.\n   */\n\n\n  StorageServiceCompat.prototype.refFromURL = function (url) {\n    if (!isUrl(url)) {\n      throw invalidArgument('refFromURL() expected a full URL but got a child path, use ref() instead.');\n    }\n\n    try {\n      Location.makeFromUrl(url);\n    } catch (e) {\n      throw invalidArgument('refFromUrl() expected a valid full URL but got an invalid one.');\n    }\n\n    return new index_esm_ReferenceCompat(ref$1(this._delegate, url), this);\n  };\n\n  StorageServiceCompat.prototype.setMaxUploadRetryTime = function (time) {\n    this._delegate.maxUploadRetryTime = time;\n  };\n\n  StorageServiceCompat.prototype.setMaxOperationRetryTime = function (time) {\n    this._delegate.maxOperationRetryTime = time;\n  };\n\n  return StorageServiceCompat;\n}();\n\nvar index_esm_name = \"@firebase/storage\";\nvar version = \"0.4.5\";\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Type constant for Firebase Storage.\n */\n\nvar STORAGE_TYPE = 'storage';\n\nfunction factory(container, _a) {\n  var url = _a.instanceIdentifier; // Dependencies\n  // TODO: This should eventually be 'app-compat'\n\n  var app = container.getProvider('app').getImmediate();\n  var authProvider = container.getProvider('auth-internal'); // TODO: get StorageService instance from component framework instead\n  // of creating a new one.\n\n  var storageServiceCompat = new StorageServiceCompat(app, new index_esm_StorageService(app, authProvider, new XhrIoPool(), url, index_esm[\"a\" /* default */].SDK_VERSION));\n  return storageServiceCompat;\n}\n\nfunction registerStorage(instance) {\n  var namespaceExports = {\n    // no-inline\n    TaskState: TaskState,\n    TaskEvent: TaskEvent,\n    StringFormat: StringFormat,\n    Storage: index_esm_StorageService,\n    Reference: index_esm_ReferenceCompat\n  };\n  instance.INTERNAL.registerComponent(new component_dist_index_esm[\"a\" /* Component */](STORAGE_TYPE, factory, \"PUBLIC\"\n  /* PUBLIC */\n  ).setServiceProps(namespaceExports).setMultipleInstances(true));\n  instance.registerVersion(index_esm_name, version);\n}\n\nregisterStorage(index_esm[\"a\" /* default */]);\n\n// CONCATENATED MODULE: ./node_modules/firebase/storage/dist/index.esm.js\n\n// CONCATENATED MODULE: ./node_modules/@angular/fire/__ivy_ngcc__/fesm2015/angular-fire-storage.js\n\n\n\n\n\n\n\n\n/**\n * @fileoverview added by tsickle\n * Generated from: observable/fromTask.ts\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n// Things aren't working great, I'm having to put in a lot of work-arounds for what\n// appear to be Firebase JS SDK bugs https://github.com/firebase/firebase-js-sdk/issues/4158\n\n/**\n * @param {?} task\n * @return {?}\n */\n\n\n\nfunction fromTask(task) {\n  return new Observable[\"a\" /* Observable */](\n  /**\n  * @param {?} subscriber\n  * @return {?}\n  */\n\n  /**\n  * @param {?} subscriber\n  * @return {?}\n  */\n  function (subscriber) {\n    /** @type {?} */\n    var progress =\n    /**\n    * @param {?} snap\n    * @return {?}\n    */\n    function progress(snap) {\n      return subscriber.next(snap);\n    };\n    /** @type {?} */\n\n\n    var error =\n    /**\n    * @param {?} e\n    * @return {?}\n    */\n\n    /**\n    * @param {?} e\n    * @return {?}\n    */\n    function error(e) {\n      return subscriber.error(e);\n    };\n    /** @type {?} */\n\n\n    var complete =\n    /**\n    * @return {?}\n    */\n    function complete() {\n      return subscriber.complete();\n    }; // emit the current snapshot, so they don't have to wait for state_changes\n    // to fire next... this is stale if the task is no longer running :(\n\n\n    progress(task.snapshot);\n    /** @type {?} */\n\n    var unsub = task.on('state_changed', progress); // it turns out that neither task snapshot nor 'state_changed' fire the last\n    // snapshot before completion, the one with status 'success\" and 100% progress\n    // so let's use the promise form of the task for that\n\n    task.then(\n    /**\n    * @param {?} snapshot\n    * @return {?}\n    */\n\n    /**\n    * @param {?} snapshot\n    * @return {?}\n    */\n    function (snapshot) {\n      progress(snapshot);\n      complete();\n    },\n    /**\n    * @param {?} e\n    * @return {?}\n    */\n\n    /**\n    * @param {?} e\n    * @return {?}\n    */\n    function (e) {\n      // TODO investigate, again this is stale, we never fire a canceled or error it seems\n      progress(task.snapshot);\n      error(e);\n    }); // on's type if Function, rather than () => void, need to wrap\n\n    return (\n      /**\n      * @return {?}\n      */\n      function unsubscribe() {\n        unsub();\n      }\n    );\n  }).pipe( // deal with sync emissions from first emitting `task.snapshot`, this makes sure\n  // that if the task is already finished we don't emit the old running state\n  Object(debounceTime[\"a\" /* debounceTime */])(0));\n}\n/**\n * @fileoverview added by tsickle\n * Generated from: task.ts\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/**\n * @record\n */\n\n\nfunction AngularFireUploadTask() {}\n\nif (false) {}\n/**\n * Create an AngularFireUploadTask from a regular UploadTask from the Storage SDK.\n * This method creates an observable of the upload and returns on object that provides\n * multiple methods for controlling and monitoring the file upload.\n * @param {?} task\n * @return {?}\n */\n\n\nfunction createUploadTask(task) {\n  /** @type {?} */\n  var inner$ = fromTask(task);\n  return {\n    task: task,\n    then: task.then.bind(task),\n    catch: task.catch.bind(task),\n    pause: task.pause.bind(task),\n    cancel: task.cancel.bind(task),\n    resume: task.resume.bind(task),\n    snapshotChanges:\n    /**\n    * @return {?}\n    */\n    function snapshotChanges() {\n      return inner$;\n    },\n    percentageChanges:\n    /**\n    * @return {?}\n    */\n    function percentageChanges() {\n      return inner$.pipe(Object(map[\"a\" /* map */])(\n      /**\n      * @param {?} s\n      * @return {?}\n      */\n\n      /**\n      * @param {?} s\n      * @return {?}\n      */\n      function (s) {\n        return s.bytesTransferred / s.totalBytes * 100;\n      }));\n    }\n  };\n}\n/**\n * @fileoverview added by tsickle\n * Generated from: ref.ts\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/**\n * @record\n */\n\n\nfunction AngularFireStorageReference() {}\n\nif (false) {}\n/**\n * Create an AngularFire wrapped Storage Reference. This object\n * creates observable methods from promise based methods.\n * @param {?} ref\n * @param {?} schedulers\n * @param {?} keepUnstableUntilFirst\n * @return {?}\n */\n\n\nfunction createStorageRef(ref, schedulers, keepUnstableUntilFirst) {\n  return {\n    getDownloadURL:\n    /**\n    * @return {?}\n    */\n    function getDownloadURL() {\n      return Object(of[\"a\" /* of */])(undefined).pipe(Object(observeOn[\"b\" /* observeOn */])(schedulers.outsideAngular), Object(switchMap[\"a\" /* switchMap */])(\n      /**\n      * @return {?}\n      */\n      function () {\n        return ref.getDownloadURL();\n      }), keepUnstableUntilFirst);\n    },\n    getMetadata:\n    /**\n    * @return {?}\n    */\n    function getMetadata() {\n      return Object(of[\"a\" /* of */])(undefined).pipe(Object(observeOn[\"b\" /* observeOn */])(schedulers.outsideAngular), Object(switchMap[\"a\" /* switchMap */])(\n      /**\n      * @return {?}\n      */\n      function () {\n        return ref.getMetadata();\n      }), keepUnstableUntilFirst);\n    },\n    delete:\n    /**\n    * @return {?}\n    */\n    function _delete() {\n      return Object(from[\"a\" /* from */])(ref.delete());\n    },\n    child:\n    /**\n    * @param {?} path\n    * @return {?}\n    */\n    function child(path) {\n      return createStorageRef(ref.child(path), schedulers, keepUnstableUntilFirst);\n    },\n    updateMetadata:\n    /**\n    * @param {?} meta\n    * @return {?}\n    */\n    function updateMetadata(meta) {\n      return Object(from[\"a\" /* from */])(ref.updateMetadata(meta));\n    },\n    put:\n    /**\n    * @param {?} data\n    * @param {?=} metadata\n    * @return {?}\n    */\n    function put(data, metadata) {\n      /** @type {?} */\n      var task = ref.put(data, metadata);\n      return createUploadTask(task);\n    },\n    putString:\n    /**\n    * @param {?} data\n    * @param {?=} format\n    * @param {?=} metadata\n    * @return {?}\n    */\n    function putString(data, format, metadata) {\n      /** @type {?} */\n      var task = ref.putString(data, format, metadata);\n      return createUploadTask(task);\n    },\n    listAll:\n    /**\n    * @return {?}\n    */\n    function listAll() {\n      return Object(from[\"a\" /* from */])(ref.listAll());\n    }\n  };\n}\n/**\n * @fileoverview added by tsickle\n * Generated from: storage.ts\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/** @type {?} */\n\n\nvar BUCKET = new core[\"s\" /* InjectionToken */]('angularfire2.storageBucket');\n/** @type {?} */\n\nvar MAX_UPLOAD_RETRY_TIME = new core[\"s\" /* InjectionToken */]('angularfire2.storage.maxUploadRetryTime');\n/** @type {?} */\n\nvar MAX_OPERATION_RETRY_TIME = new core[\"s\" /* InjectionToken */]('angularfire2.storage.maxOperationRetryTime');\n\nvar angular_fire_storage_AngularFireStorage = /*@__PURE__*/function () {\n  var AngularFireStorage = /*#__PURE__*/function () {\n    /**\n     * @param {?} options\n     * @param {?} nameOrConfig\n     * @param {?} storageBucket\n     * @param {?} platformId\n     * @param {?} zone\n     * @param {?} maxUploadRetryTime\n     * @param {?} maxOperationRetryTime\n     */\n    function AngularFireStorage(options, nameOrConfig, storageBucket, // tslint:disable-next-line:ban-types\n    platformId, zone, maxUploadRetryTime, maxOperationRetryTime) {\n      Object(classCallCheck[\"a\" /* default */])(this, AngularFireStorage);\n\n      this.schedulers = new angular_fire[\"d\" /* ɵAngularFireSchedulers */](zone);\n      this.keepUnstableUntilFirst = Object(angular_fire[\"h\" /* ɵkeepUnstableUntilFirstFactory */])(this.schedulers);\n      /** @type {?} */\n\n      var app = Object(angular_fire[\"g\" /* ɵfirebaseAppFactory */])(options, zone, nameOrConfig);\n      this.storage = Object(angular_fire[\"f\" /* ɵfetchInstance */])(\"\".concat(app.name, \".storage.\").concat(storageBucket), 'AngularFireStorage', app,\n      /**\n      * @return {?}\n      */\n      function () {\n        /** @type {?} */\n        var storage = zone.runOutsideAngular(\n        /**\n        * @return {?}\n        */\n        function () {\n          return app.storage(storageBucket || undefined);\n        });\n\n        if (maxUploadRetryTime) {\n          storage.setMaxUploadRetryTime(maxUploadRetryTime);\n        }\n\n        if (maxOperationRetryTime) {\n          storage.setMaxOperationRetryTime(maxOperationRetryTime);\n        }\n\n        return storage;\n      }, [maxUploadRetryTime, maxOperationRetryTime]);\n    }\n    /**\n     * @param {?} path\n     * @return {?}\n     */\n\n\n    Object(createClass[\"a\" /* default */])(AngularFireStorage, [{\n      key: \"ref\",\n      value: function ref(path) {\n        return createStorageRef(this.storage.ref(path), this.schedulers, this.keepUnstableUntilFirst);\n      }\n      /**\n       * @param {?} path\n       * @return {?}\n       */\n\n    }, {\n      key: \"refFromURL\",\n      value: function refFromURL(path) {\n        return createStorageRef(this.storage.refFromURL(path), this.schedulers, this.keepUnstableUntilFirst);\n      }\n      /**\n       * @param {?} path\n       * @param {?} data\n       * @param {?=} metadata\n       * @return {?}\n       */\n\n    }, {\n      key: \"upload\",\n      value: function upload(path, data, metadata) {\n        /** @type {?} */\n        var storageRef = this.storage.ref(path);\n        /** @type {?} */\n\n        var ref = createStorageRef(storageRef, this.schedulers, this.keepUnstableUntilFirst);\n        return ref.put(data, metadata);\n      }\n    }]);\n\n    return AngularFireStorage;\n  }();\n\n  AngularFireStorage.ɵfac = function AngularFireStorage_Factory(t) {\n    return new (t || AngularFireStorage)(core[\"bc\" /* ɵɵinject */](angular_fire[\"c\" /* FIREBASE_OPTIONS */]), core[\"bc\" /* ɵɵinject */](angular_fire[\"b\" /* FIREBASE_APP_NAME */], 8), core[\"bc\" /* ɵɵinject */](BUCKET, 8), core[\"bc\" /* ɵɵinject */](core[\"D\" /* PLATFORM_ID */]), core[\"bc\" /* ɵɵinject */](core[\"B\" /* NgZone */]), core[\"bc\" /* ɵɵinject */](MAX_UPLOAD_RETRY_TIME, 8), core[\"bc\" /* ɵɵinject */](MAX_OPERATION_RETRY_TIME, 8));\n  };\n  /** @nocollapse */\n\n\n  AngularFireStorage.ɵprov = Object(core[\"Lb\" /* ɵɵdefineInjectable */])({\n    factory: function AngularFireStorage_Factory() {\n      return new AngularFireStorage(Object(core[\"bc\" /* ɵɵinject */])(angular_fire[\"c\" /* FIREBASE_OPTIONS */]), Object(core[\"bc\" /* ɵɵinject */])(angular_fire[\"b\" /* FIREBASE_APP_NAME */], 8), Object(core[\"bc\" /* ɵɵinject */])(BUCKET, 8), Object(core[\"bc\" /* ɵɵinject */])(core[\"D\" /* PLATFORM_ID */]), Object(core[\"bc\" /* ɵɵinject */])(core[\"B\" /* NgZone */]), Object(core[\"bc\" /* ɵɵinject */])(MAX_UPLOAD_RETRY_TIME, 8), Object(core[\"bc\" /* ɵɵinject */])(MAX_OPERATION_RETRY_TIME, 8));\n    },\n    token: AngularFireStorage,\n    providedIn: \"any\"\n  });\n  return AngularFireStorage;\n}();\n\nif (false) {}\n\nvar angular_fire_storage_GetDownloadURLPipe = /*@__PURE__*/function () {\n  var GetDownloadURLPipe = /*#__PURE__*/function () {\n    /**\n     * @param {?} storage\n     * @param {?} cdr\n     */\n    function GetDownloadURLPipe(storage, cdr) {\n      Object(classCallCheck[\"a\" /* default */])(this, GetDownloadURLPipe);\n\n      this.storage = storage;\n      this.asyncPipe = new common[\"b\" /* AsyncPipe */](cdr);\n    }\n    /**\n     * @param {?} path\n     * @return {?}\n     */\n\n\n    Object(createClass[\"a\" /* default */])(GetDownloadURLPipe, [{\n      key: \"transform\",\n      value: function transform(path) {\n        if (path !== this.path) {\n          this.path = path;\n          this.downloadUrl$ = this.storage.ref(path).getDownloadURL();\n        }\n\n        return this.asyncPipe.transform(this.downloadUrl$);\n      }\n      /**\n       * @return {?}\n       */\n\n    }, {\n      key: \"ngOnDestroy\",\n      value: function ngOnDestroy() {\n        this.asyncPipe.ngOnDestroy();\n      }\n    }]);\n\n    return GetDownloadURLPipe;\n  }();\n\n  GetDownloadURLPipe.ɵfac = function GetDownloadURLPipe_Factory(t) {\n    return new (t || GetDownloadURLPipe)(core[\"Pb\" /* ɵɵdirectiveInject */](angular_fire_storage_AngularFireStorage), core[\"dc\" /* ɵɵinjectPipeChangeDetectorRef */]());\n  };\n\n  GetDownloadURLPipe.ɵpipe = core[\"Ob\" /* ɵɵdefinePipe */]({\n    name: \"getDownloadURL\",\n    type: GetDownloadURLPipe,\n    pure: false\n  });\n  return GetDownloadURLPipe;\n}();\n\nif (false) {}\n\nvar angular_fire_storage_GetDownloadURLPipeModule = /*@__PURE__*/function () {\n  var GetDownloadURLPipeModule = function GetDownloadURLPipeModule() {\n    Object(classCallCheck[\"a\" /* default */])(this, GetDownloadURLPipeModule);\n  };\n\n  GetDownloadURLPipeModule.ɵmod = core[\"Nb\" /* ɵɵdefineNgModule */]({\n    type: GetDownloadURLPipeModule\n  });\n  GetDownloadURLPipeModule.ɵinj = core[\"Mb\" /* ɵɵdefineInjector */]({\n    factory: function GetDownloadURLPipeModule_Factory(t) {\n      return new (t || GetDownloadURLPipeModule)();\n    }\n  });\n  return GetDownloadURLPipeModule;\n}();\n\n(function () {\n  (typeof ngJitMode === \"undefined\" || ngJitMode) && core[\"zc\" /* ɵɵsetNgModuleScope */](angular_fire_storage_GetDownloadURLPipeModule, {\n    declarations: [angular_fire_storage_GetDownloadURLPipe],\n    exports: [angular_fire_storage_GetDownloadURLPipe]\n  });\n})();\n\nvar angular_fire_storage_AngularFireStorageModule = /*@__PURE__*/function () {\n  var AngularFireStorageModule = function AngularFireStorageModule() {\n    Object(classCallCheck[\"a\" /* default */])(this, AngularFireStorageModule);\n  };\n\n  AngularFireStorageModule.ɵmod = core[\"Nb\" /* ɵɵdefineNgModule */]({\n    type: AngularFireStorageModule\n  });\n  AngularFireStorageModule.ɵinj = core[\"Mb\" /* ɵɵdefineInjector */]({\n    factory: function AngularFireStorageModule_Factory(t) {\n      return new (t || AngularFireStorageModule)();\n    },\n    providers: [angular_fire_storage_AngularFireStorage],\n    imports: [angular_fire_storage_GetDownloadURLPipeModule]\n  });\n  return AngularFireStorageModule;\n}();\n\n(function () {\n  (typeof ngJitMode === \"undefined\" || ngJitMode) && core[\"zc\" /* ɵɵsetNgModuleScope */](angular_fire_storage_AngularFireStorageModule, {\n    exports: [angular_fire_storage_GetDownloadURLPipeModule]\n  });\n})();\n/**\n * @fileoverview added by tsickle\n * Generated from: public_api.ts\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/**\n * @fileoverview added by tsickle\n * Generated from: angular-fire-storage.ts\n * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/__ivy_ngcc__/fesm2015/expansion.js + 3 modules\nvar expansion = __webpack_require__(\"7EHt\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/__ivy_ngcc__/fesm2015/progress-bar.js\nvar progress_bar = __webpack_require__(\"bv9b\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/__ivy_ngcc__/fesm2015/form-field.js\nvar form_field = __webpack_require__(\"kmnG\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/__ivy_ngcc__/fesm2015/input.js + 1 modules\nvar input = __webpack_require__(\"qFsG\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/forms/__ivy_ngcc__/fesm2015/forms.js\nvar fesm2015_forms = __webpack_require__(\"3Pt+\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/__ivy_ngcc__/fesm2015/button.js\nvar fesm2015_button = __webpack_require__(\"bTqV\");\n\n// CONCATENATED MODULE: ./src/app/components/post/post-dashboard/post-dashboard.component.ts\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try {\n            step(generator.next(value));\n        }\n        catch (e) {\n            reject(e);\n        } }\n        function rejected(value) { try {\n            step(generator[\"throw\"](value));\n        }\n        catch (e) {\n            reject(e);\n        } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function () { if (t[0] & 1)\n            throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f)\n            throw new TypeError(\"Generator is already executing.\");\n        while (_)\n            try {\n                if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done)\n                    return t;\n                if (y = 0, t)\n                    op = [op[0] & 2, t.value];\n                switch (op[0]) {\n                    case 0:\n                    case 1:\n                        t = op;\n                        break;\n                    case 4:\n                        _.label++;\n                        return { value: op[1], done: false };\n                    case 5:\n                        _.label++;\n                        y = op[1];\n                        op = [0];\n                        continue;\n                    case 7:\n                        op = _.ops.pop();\n                        _.trys.pop();\n                        continue;\n                    default:\n                        if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n                            _ = 0;\n                            continue;\n                        }\n                        if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) {\n                            _.label = op[1];\n                            break;\n                        }\n                        if (op[0] === 6 && _.label < t[1]) {\n                            _.label = t[1];\n                            t = op;\n                            break;\n                        }\n                        if (t && _.label < t[2]) {\n                            _.label = t[2];\n                            _.ops.push(op);\n                            break;\n                        }\n                        if (t[2])\n                            _.ops.pop();\n                        _.trys.pop();\n                        continue;\n                }\n                op = body.call(thisArg, _);\n            }\n            catch (e) {\n                op = [6, e];\n                y = 0;\n            }\n            finally {\n                f = t = 0;\n            }\n        if (op[0] & 5)\n            throw op[1];\n        return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar post_dashboard_component_PostDashboardComponent = /** @class */ /*@__PURE__*/ (function () {\n    function PostDashboardComponent(auth, postService, storage, router) {\n        this.auth = auth;\n        this.postService = postService;\n        this.storage = storage;\n        this.router = router;\n        this.saving = 'Create Post';\n    }\n    PostDashboardComponent.prototype.ngOnInit = function () { };\n    PostDashboardComponent.prototype.createPost = function () {\n        var _this = this;\n        var postData = {\n            author: this.auth.authState.displayName || this.auth.authState.email,\n            authorId: this.auth.currentUserId,\n            content: this.content,\n            image: this.image || null,\n            published: new Date(),\n            title: this.title\n        };\n        this.postService.create(postData);\n        this.title = '';\n        this.content = '';\n        this.image = '';\n        this.saving = 'Post Created!';\n        setTimeout(function () { return (_this.saving = 'Create Post'); }, 3000);\n        this.router.navigateByUrl('blog');\n    };\n    PostDashboardComponent.prototype.uploadImage = function (event) {\n        return __awaiter(this, void 0, void 0, function () {\n            var file, path, task, ref, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        file = event.target.files[0];\n                        path = \"posts/\" + file.name;\n                        if (!(file.type.split('/')[0] !== 'image'))\n                            return [3 /*break*/, 1];\n                        return [2 /*return*/, alert('only image files')];\n                    case 1:\n                        task = this.storage.upload(path, file);\n                        ref = this.storage.ref(path);\n                        this.uploadPercent = task.percentageChanges();\n                        // upload image, save url\n                        return [4 /*yield*/, task];\n                    case 2:\n                        // upload image, save url\n                        _b.sent();\n                        console.log('Image uploaded!');\n                        _a = this;\n                        return [4 /*yield*/, ref.getDownloadURL().toPromise()];\n                    case 3:\n                        _a.image = _b.sent();\n                        _b.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    PostDashboardComponent.ɵfac = function PostDashboardComponent_Factory(t) { return new (t || PostDashboardComponent)(core[\"Pb\" /* ɵɵdirectiveInject */](auth_service[\"a\" /* AuthService */]), core[\"Pb\" /* ɵɵdirectiveInject */](post_service_PostService), core[\"Pb\" /* ɵɵdirectiveInject */](angular_fire_storage_AngularFireStorage), core[\"Pb\" /* ɵɵdirectiveInject */](router[\"c\" /* Router */])); };\n    PostDashboardComponent.ɵcmp = core[\"Jb\" /* ɵɵdefineComponent */]({ type: PostDashboardComponent, selectors: [[\"app-post-dashboard\"]], decls: 20, vars: 9, consts: [[\"type\", \"file\", \"name\", \"file\", \"id\", \"file\", 3, \"change\"], [3, \"hidden\"], [\"mode\", \"determinate\", 3, \"value\"], [3, \"src\"], [\"matInput\", \"\", \"placeholder\", \"Post title\", \"name\", \"title\", 3, \"ngModel\", \"ngModelChange\"], [\"matInput\", \"\", \"placeholder\", \"Post content\", \"name\", \"content\", \"rows\", \"10\", 3, \"ngModel\", \"ngModelChange\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 3, \"click\"]], template: function PostDashboardComponent_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ub\" /* ɵɵelementStart */](0, \"section\");\n                core[\"Ub\" /* ɵɵelementStart */](1, \"mat-accordion\");\n                core[\"Ub\" /* ɵɵelementStart */](2, \"mat-expansion-panel\");\n                core[\"Ub\" /* ɵɵelementStart */](3, \"mat-expansion-panel-header\");\n                core[\"Ub\" /* ɵɵelementStart */](4, \"mat-panel-title\");\n                core[\"Fc\" /* ɵɵtext */](5, \" Create a Post \");\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Ub\" /* ɵɵelementStart */](6, \"input\", 0);\n                core[\"ec\" /* ɵɵlistener */](\"change\", function PostDashboardComponent_Template_input_change_6_listener($event) { return ctx.uploadImage($event); });\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Ub\" /* ɵɵelementStart */](7, \"div\", 1);\n                core[\"Qb\" /* ɵɵelement */](8, \"mat-progress-bar\", 2);\n                core[\"jc\" /* ɵɵpipe */](9, \"async\");\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Ub\" /* ɵɵelementStart */](10, \"div\", 1);\n                core[\"Qb\" /* ɵɵelement */](11, \"img\", 3);\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Ub\" /* ɵɵelementStart */](12, \"mat-form-field\");\n                core[\"Ub\" /* ɵɵelementStart */](13, \"input\", 4);\n                core[\"ec\" /* ɵɵlistener */](\"ngModelChange\", function PostDashboardComponent_Template_input_ngModelChange_13_listener($event) { return ctx.title = $event; });\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Qb\" /* ɵɵelement */](14, \"br\");\n                core[\"Ub\" /* ɵɵelementStart */](15, \"mat-form-field\");\n                core[\"Ub\" /* ɵɵelementStart */](16, \"textarea\", 5);\n                core[\"ec\" /* ɵɵlistener */](\"ngModelChange\", function PostDashboardComponent_Template_textarea_ngModelChange_16_listener($event) { return ctx.content = $event; });\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Qb\" /* ɵɵelement */](17, \"br\");\n                core[\"Ub\" /* ɵɵelementStart */](18, \"button\", 6);\n                core[\"ec\" /* ɵɵlistener */](\"click\", function PostDashboardComponent_Template_button_click_18_listener() { return ctx.createPost(); });\n                core[\"Fc\" /* ɵɵtext */](19);\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Tb\" /* ɵɵelementEnd */]();\n                core[\"Tb\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"Cb\" /* ɵɵadvance */](7);\n                core[\"oc\" /* ɵɵproperty */](\"hidden\", !ctx.uploadPercent);\n                core[\"Cb\" /* ɵɵadvance */](1);\n                core[\"pc\" /* ɵɵpropertyInterpolate */](\"value\", core[\"kc\" /* ɵɵpipeBind1 */](9, 7, ctx.uploadPercent));\n                core[\"Cb\" /* ɵɵadvance */](2);\n                core[\"oc\" /* ɵɵproperty */](\"hidden\", !ctx.image);\n                core[\"Cb\" /* ɵɵadvance */](1);\n                core[\"oc\" /* ɵɵproperty */](\"src\", ctx.image || \"//:0\", core[\"yc\" /* ɵɵsanitizeUrl */]);\n                core[\"Cb\" /* ɵɵadvance */](2);\n                core[\"oc\" /* ɵɵproperty */](\"ngModel\", ctx.title);\n                core[\"Cb\" /* ɵɵadvance */](3);\n                core[\"oc\" /* ɵɵproperty */](\"ngModel\", ctx.content);\n                core[\"Cb\" /* ɵɵadvance */](3);\n                core[\"Gc\" /* ɵɵtextInterpolate */](ctx.saving);\n            }\n        }, directives: [expansion[\"a\" /* MatAccordion */], expansion[\"c\" /* MatExpansionPanel */], expansion[\"d\" /* MatExpansionPanelHeader */], expansion[\"e\" /* MatExpansionPanelTitle */], progress_bar[\"a\" /* MatProgressBar */], form_field[\"b\" /* MatFormField */], input[\"a\" /* MatInput */], fesm2015_forms[\"b\" /* DefaultValueAccessor */], fesm2015_forms[\"h\" /* NgControlStatus */], fesm2015_forms[\"j\" /* NgModel */], fesm2015_button[\"a\" /* MatButton */]], pipes: [common[\"b\" /* AsyncPipe */]], styles: [\"section[_ngcontent-%COMP%]{max-width:700px;margin:2em auto}img[_ngcontent-%COMP%], mat-form-field[_ngcontent-%COMP%]{width:100%}\"] });\n    return PostDashboardComponent;\n}());\n\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/__ivy_ngcc__/fesm2015/card.js\nvar card = __webpack_require__(\"Wp6s\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/__ivy_ngcc__/fesm2015/icon.js + 1 modules\nvar icon = __webpack_require__(\"NFeN\");\n\n// CONCATENATED MODULE: ./src/app/components/post/post-detail/post-detail.component.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction PostDetailComponent_ng_container_0_button_13_Template(rf, ctx) {\n    if (rf & 1) {\n        var _r4 = core[\"Vb\" /* ɵɵgetCurrentView */]();\n        core[\"Ub\" /* ɵɵelementStart */](0, \"button\", 8);\n        core[\"ec\" /* ɵɵlistener */](\"click\", function PostDetailComponent_ng_container_0_button_13_Template_button_click_0_listener() { core[\"wc\" /* ɵɵrestoreView */](_r4); var ctx_r3 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r3.editing = false; });\n        core[\"Fc\" /* ɵɵtext */](1, \"Cancel\");\n        core[\"Tb\" /* ɵɵelementEnd */]();\n    }\n}\nfunction PostDetailComponent_ng_container_0_mat_card_actions_26_Template(rf, ctx) {\n    if (rf & 1) {\n        var _r6 = core[\"Vb\" /* ɵɵgetCurrentView */]();\n        core[\"Ub\" /* ɵɵelementStart */](0, \"mat-card-actions\", 9);\n        core[\"Ub\" /* ɵɵelementStart */](1, \"button\", 10);\n        core[\"ec\" /* ɵɵlistener */](\"click\", function PostDetailComponent_ng_container_0_mat_card_actions_26_Template_button_click_1_listener() { core[\"wc\" /* ɵɵrestoreView */](_r6); var ctx_r5 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r5.editing = true; });\n        core[\"Ub\" /* ɵɵelementStart */](2, \"mat-icon\");\n        core[\"Fc\" /* ɵɵtext */](3, \"edit\");\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Ub\" /* ɵɵelementStart */](4, \"button\", 10);\n        core[\"ec\" /* ɵɵlistener */](\"click\", function PostDetailComponent_ng_container_0_mat_card_actions_26_Template_button_click_4_listener() { core[\"wc\" /* ɵɵrestoreView */](_r6); var ctx_r7 = core[\"ic\" /* ɵɵnextContext */](2); return ctx_r7.delete(ctx_r7.post.id); });\n        core[\"Ub\" /* ɵɵelementStart */](5, \"mat-icon\");\n        core[\"Fc\" /* ɵɵtext */](6, \"delete\");\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n    }\n}\nfunction PostDetailComponent_ng_container_0_Template(rf, ctx) {\n    if (rf & 1) {\n        var _r9 = core[\"Vb\" /* ɵɵgetCurrentView */]();\n        core[\"Sb\" /* ɵɵelementContainerStart */](0);\n        core[\"Ub\" /* ɵɵelementStart */](1, \"div\", 1);\n        core[\"Ub\" /* ɵɵelementStart */](2, \"mat-card\");\n        core[\"Ub\" /* ɵɵelementStart */](3, \"h1\");\n        core[\"Fc\" /* ɵɵtext */](4, \"Edit Post\");\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Ub\" /* ɵɵelementStart */](5, \"mat-form-field\");\n        core[\"Ub\" /* ɵɵelementStart */](6, \"input\", 2);\n        core[\"ec\" /* ɵɵlistener */](\"ngModelChange\", function PostDetailComponent_ng_container_0_Template_input_ngModelChange_6_listener($event) { core[\"wc\" /* ɵɵrestoreView */](_r9); var ctx_r8 = core[\"ic\" /* ɵɵnextContext */](); return ctx_r8.post.title = $event; });\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Qb\" /* ɵɵelement */](7, \"br\");\n        core[\"Ub\" /* ɵɵelementStart */](8, \"mat-form-field\");\n        core[\"Ub\" /* ɵɵelementStart */](9, \"textarea\", 3);\n        core[\"ec\" /* ɵɵlistener */](\"ngModelChange\", function PostDetailComponent_ng_container_0_Template_textarea_ngModelChange_9_listener($event) { core[\"wc\" /* ɵɵrestoreView */](_r9); var ctx_r10 = core[\"ic\" /* ɵɵnextContext */](); return ctx_r10.post.content = $event; });\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Qb\" /* ɵɵelement */](10, \"br\");\n        core[\"Ub\" /* ɵɵelementStart */](11, \"button\", 4);\n        core[\"ec\" /* ɵɵlistener */](\"click\", function PostDetailComponent_ng_container_0_Template_button_click_11_listener() { core[\"wc\" /* ɵɵrestoreView */](_r9); var ctx_r11 = core[\"ic\" /* ɵɵnextContext */](); return ctx_r11.updatePost(); });\n        core[\"Fc\" /* ɵɵtext */](12, \"Save\");\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵtemplate */](13, PostDetailComponent_ng_container_0_button_13_Template, 2, 0, \"button\", 5);\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Ub\" /* ɵɵelementStart */](14, \"div\", 1);\n        core[\"Ub\" /* ɵɵelementStart */](15, \"mat-card\");\n        core[\"Qb\" /* ɵɵelement */](16, \"img\", 6);\n        core[\"Ub\" /* ɵɵelementStart */](17, \"h2\");\n        core[\"Fc\" /* ɵɵtext */](18);\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Ub\" /* ɵɵelementStart */](19, \"p\");\n        core[\"Ub\" /* ɵɵelementStart */](20, \"small\");\n        core[\"Fc\" /* ɵɵtext */](21);\n        core[\"jc\" /* ɵɵpipe */](22, \"date\");\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Ub\" /* ɵɵelementStart */](23, \"mat-card-content\");\n        core[\"Ub\" /* ɵɵelementStart */](24, \"p\");\n        core[\"Fc\" /* ɵɵtext */](25);\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵtemplate */](26, PostDetailComponent_ng_container_0_mat_card_actions_26_Template, 7, 0, \"mat-card-actions\", 7);\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Rb\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        var ctx_r0 = core[\"ic\" /* ɵɵnextContext */]();\n        core[\"Cb\" /* ɵɵadvance */](1);\n        core[\"oc\" /* ɵɵproperty */](\"hidden\", !ctx_r0.editing);\n        core[\"Cb\" /* ɵɵadvance */](5);\n        core[\"oc\" /* ɵɵproperty */](\"ngModel\", ctx_r0.post.title);\n        core[\"Cb\" /* ɵɵadvance */](3);\n        core[\"oc\" /* ɵɵproperty */](\"ngModel\", ctx_r0.post.content);\n        core[\"Cb\" /* ɵɵadvance */](4);\n        core[\"oc\" /* ɵɵproperty */](\"ngIf\", ctx_r0.editing);\n        core[\"Cb\" /* ɵɵadvance */](1);\n        core[\"oc\" /* ɵɵproperty */](\"hidden\", ctx_r0.editing);\n        core[\"Cb\" /* ɵɵadvance */](2);\n        core[\"pc\" /* ɵɵpropertyInterpolate */](\"src\", ctx_r0.post.image, core[\"yc\" /* ɵɵsanitizeUrl */]);\n        core[\"pc\" /* ɵɵpropertyInterpolate */](\"alt\", ctx_r0.post.title);\n        core[\"Cb\" /* ɵɵadvance */](2);\n        core[\"Gc\" /* ɵɵtextInterpolate */](ctx_r0.post.title);\n        core[\"Cb\" /* ɵɵadvance */](3);\n        core[\"Ic\" /* ɵɵtextInterpolate2 */](\"Posted by \", ctx_r0.post.author, \" \\u2022 on \", core[\"lc\" /* ɵɵpipeBind2 */](22, 12, ctx_r0.post.published.toDate(), \"fullDate\"), \"\");\n        core[\"Cb\" /* ɵɵadvance */](4);\n        core[\"Gc\" /* ɵɵtextInterpolate */](ctx_r0.post.content);\n        core[\"Cb\" /* ɵɵadvance */](1);\n        core[\"oc\" /* ɵɵproperty */](\"ngIf\", ctx_r0.auth.currentUserId === ctx_r0.post.authorId);\n    }\n}\nvar post_detail_component_PostDetailComponent = /** @class */ /*@__PURE__*/ (function () {\n    function PostDetailComponent(route, router, postService, auth) {\n        this.route = route;\n        this.router = router;\n        this.postService = postService;\n        this.auth = auth;\n        this.editing = false;\n    }\n    PostDetailComponent.prototype.ngOnInit = function () {\n        console.log(\"detal loaded\");\n        this.getPost();\n    };\n    PostDetailComponent.prototype.getPost = function () {\n        var _this = this;\n        var id = this.route.snapshot.paramMap.get('id');\n        this.postService.getPostData(id).subscribe(function (post) { return (_this.post = post); });\n    };\n    PostDetailComponent.prototype.updatePost = function () {\n        var formData = {\n            title: this.post.title,\n            content: this.post.content\n        };\n        var id = this.route.snapshot.paramMap.get('id');\n        this.postService.update(id, formData);\n        this.editing = false;\n    };\n    PostDetailComponent.prototype.delete = function () {\n        var id = this.route.snapshot.paramMap.get('id');\n        this.postService.delete(id);\n        this.router.navigate(['/blog']);\n    };\n    PostDetailComponent.ɵfac = function PostDetailComponent_Factory(t) { return new (t || PostDetailComponent)(core[\"Pb\" /* ɵɵdirectiveInject */](router[\"a\" /* ActivatedRoute */]), core[\"Pb\" /* ɵɵdirectiveInject */](router[\"c\" /* Router */]), core[\"Pb\" /* ɵɵdirectiveInject */](post_service_PostService), core[\"Pb\" /* ɵɵdirectiveInject */](auth_service[\"a\" /* AuthService */])); };\n    PostDetailComponent.ɵcmp = core[\"Jb\" /* ɵɵdefineComponent */]({ type: PostDetailComponent, selectors: [[\"app-post-detail\"]], decls: 1, vars: 1, consts: [[4, \"ngIf\"], [3, \"hidden\"], [\"matInput\", \"\", \"placeholder\", \"Post title\", \"name\", \"title\", 3, \"ngModel\", \"ngModelChange\"], [\"matInput\", \"\", \"placeholder\", \"Post content\", \"name\", \"content\", \"rows\", \"10\", 3, \"ngModel\", \"ngModelChange\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 3, \"click\"], [\"mat-button\", \"\", 3, \"click\", 4, \"ngIf\"], [\"mat-card-image\", \"\", 3, \"src\", \"alt\"], [\"align\", \"end\", 4, \"ngIf\"], [\"mat-button\", \"\", 3, \"click\"], [\"align\", \"end\"], [\"mat-icon-button\", \"\", 3, \"click\"]], template: function PostDetailComponent_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Dc\" /* ɵɵtemplate */](0, PostDetailComponent_ng_container_0_Template, 27, 15, \"ng-container\", 0);\n            }\n            if (rf & 2) {\n                core[\"oc\" /* ɵɵproperty */](\"ngIf\", ctx.post);\n            }\n        }, directives: [common[\"m\" /* NgIf */], card[\"a\" /* MatCard */], form_field[\"b\" /* MatFormField */], input[\"a\" /* MatInput */], fesm2015_forms[\"b\" /* DefaultValueAccessor */], fesm2015_forms[\"h\" /* NgControlStatus */], fesm2015_forms[\"j\" /* NgModel */], fesm2015_button[\"a\" /* MatButton */], card[\"d\" /* MatCardImage */], card[\"c\" /* MatCardContent */], card[\"b\" /* MatCardActions */], icon[\"a\" /* MatIcon */]], pipes: [common[\"e\" /* DatePipe */]], styles: [\"mat-card[_ngcontent-%COMP%]{margin:10px auto;max-width:700px}mat-form-field[_ngcontent-%COMP%]{width:100%}\"] });\n    return PostDetailComponent;\n}());\n\n\n// CONCATENATED MODULE: ./src/app/components/post/post-list/post-list.component.ts\n\n\n\n\n\n\n\n\n\n\nfunction PostListComponent_mat_card_1_mat_card_actions_9_Template(rf, ctx) {\n    if (rf & 1) {\n        var _r5 = core[\"Vb\" /* ɵɵgetCurrentView */]();\n        core[\"Ub\" /* ɵɵelementStart */](0, \"mat-card-actions\", 4);\n        core[\"Ub\" /* ɵɵelementStart */](1, \"button\", 5);\n        core[\"ec\" /* ɵɵlistener */](\"click\", function PostListComponent_mat_card_1_mat_card_actions_9_Template_button_click_1_listener() { core[\"wc\" /* ɵɵrestoreView */](_r5); var post_r1 = core[\"ic\" /* ɵɵnextContext */]().$implicit; var ctx_r3 = core[\"ic\" /* ɵɵnextContext */](); return ctx_r3.delete(post_r1.id); });\n        core[\"Ub\" /* ɵɵelementStart */](2, \"mat-icon\");\n        core[\"Fc\" /* ɵɵtext */](3, \"delete\");\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n    }\n}\nfunction PostListComponent_mat_card_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ub\" /* ɵɵelementStart */](0, \"mat-card\");\n        core[\"Ub\" /* ɵɵelementStart */](1, \"mat-card-content\", 1);\n        core[\"Qb\" /* ɵɵelement */](2, \"img\", 2);\n        core[\"Ub\" /* ɵɵelementStart */](3, \"h2\");\n        core[\"Fc\" /* ɵɵtext */](4);\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Ub\" /* ɵɵelementStart */](5, \"p\");\n        core[\"Ub\" /* ɵɵelementStart */](6, \"small\");\n        core[\"Fc\" /* ɵɵtext */](7);\n        core[\"jc\" /* ɵɵpipe */](8, \"date\");\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Tb\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵtemplate */](9, PostListComponent_mat_card_1_mat_card_actions_9_Template, 4, 0, \"mat-card-actions\", 3);\n        core[\"Tb\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        var post_r1 = ctx.$implicit;\n        var ctx_r0 = core[\"ic\" /* ɵɵnextContext */]();\n        core[\"Cb\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵpropertyInterpolate */](\"routerLink\", post_r1.id);\n        core[\"Cb\" /* ɵɵadvance */](1);\n        core[\"pc\" /* ɵɵpropertyInterpolate */](\"src\", post_r1.image, core[\"yc\" /* ɵɵsanitizeUrl */]);\n        core[\"pc\" /* ɵɵpropertyInterpolate */](\"alt\", post_r1.title);\n        core[\"Cb\" /* ɵɵadvance */](2);\n        core[\"Gc\" /* ɵɵtextInterpolate */](post_r1.title);\n        core[\"Cb\" /* ɵɵadvance */](3);\n        core[\"Ic\" /* ɵɵtextInterpolate2 */](\"Posted by \", post_r1.author, \" \\u2022 on \", core[\"lc\" /* ɵɵpipeBind2 */](8, 7, post_r1.published.toDate(), \"fullDate\"), \"\");\n        core[\"Cb\" /* ɵɵadvance */](2);\n        core[\"oc\" /* ɵɵproperty */](\"ngIf\", ctx_r0.auth.currentUserId === post_r1.authorId);\n    }\n}\nvar post_list_component_PostListComponent = /** @class */ /*@__PURE__*/ (function () {\n    function PostListComponent(postService, auth) {\n        this.postService = postService;\n        this.auth = auth;\n    }\n    PostListComponent.prototype.ngOnInit = function () {\n        console.log(\"loaded\");\n        this.posts = this.postService.getPosts();\n    };\n    PostListComponent.prototype.delete = function (id) {\n        this.postService.delete(id);\n    };\n    PostListComponent.ɵfac = function PostListComponent_Factory(t) { return new (t || PostListComponent)(core[\"Pb\" /* ɵɵdirectiveInject */](post_service_PostService), core[\"Pb\" /* ɵɵdirectiveInject */](auth_service[\"a\" /* AuthService */])); };\n    PostListComponent.ɵcmp = core[\"Jb\" /* ɵɵdefineComponent */]({ type: PostListComponent, selectors: [[\"app-post-list\"]], decls: 3, vars: 3, consts: [[4, \"ngFor\", \"ngForOf\"], [3, \"routerLink\"], [\"mat-card-image\", \"\", 3, \"src\", \"alt\"], [\"align\", \"end\", 4, \"ngIf\"], [\"align\", \"end\"], [\"mat-icon-button\", \"\", 3, \"click\"]], template: function PostListComponent_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ub\" /* ɵɵelementStart */](0, \"section\");\n                core[\"Dc\" /* ɵɵtemplate */](1, PostListComponent_mat_card_1_Template, 10, 10, \"mat-card\", 0);\n                core[\"jc\" /* ɵɵpipe */](2, \"async\");\n                core[\"Tb\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"Cb\" /* ɵɵadvance */](1);\n                core[\"oc\" /* ɵɵproperty */](\"ngForOf\", core[\"kc\" /* ɵɵpipeBind1 */](2, 1, ctx.posts));\n            }\n        }, directives: [common[\"l\" /* NgForOf */], card[\"a\" /* MatCard */], card[\"c\" /* MatCardContent */], router[\"d\" /* RouterLink */], card[\"d\" /* MatCardImage */], common[\"m\" /* NgIf */], card[\"b\" /* MatCardActions */], fesm2015_button[\"a\" /* MatButton */], icon[\"a\" /* MatIcon */]], pipes: [common[\"b\" /* AsyncPipe */], common[\"e\" /* DatePipe */]], styles: [\"section[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));grid-template-rows:auto;grid-gap:10px;margin:0 auto;max-width:90%}mat-card[_ngcontent-%COMP%]{margin:10px 0}\"] });\n    return PostListComponent;\n}());\n\n\n// EXTERNAL MODULE: ./node_modules/@angular/material/__ivy_ngcc__/fesm2015/toolbar.js\nvar toolbar = __webpack_require__(\"/t3+\");\n\n// CONCATENATED MODULE: ./src/app/core/auth-guard.service.ts\n\n\n\n\n\nvar auth_guard_service_AuthGuardService = /** @class */ /*@__PURE__*/ (function () {\n    function AuthGuardService(authService, router) {\n        this.authService = authService;\n        this.router = router;\n        this.routeURL = this.router.url;\n    }\n    AuthGuardService.prototype.canActivate = function (next, state) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _this.authService.user.subscribe(function (user) {\n                if (!user && _this.routeURL !== '/homepage') {\n                    _this.routeURL = '/login';\n                    _this.router.navigate(['/homepage'], {\n                        queryParams: {\n                            return: 'login'\n                        }\n                    });\n                    alert(\"Not logged in\");\n                    return resolve(false);\n                }\n                else {\n                    _this.routeURL = _this.router.url;\n                    return resolve(true);\n                }\n            });\n        });\n    };\n    AuthGuardService.ɵfac = function AuthGuardService_Factory(t) { return new (t || AuthGuardService)(core[\"bc\" /* ɵɵinject */](auth_service[\"a\" /* AuthService */]), core[\"bc\" /* ɵɵinject */](router[\"c\" /* Router */])); };\n    AuthGuardService.ɵprov = core[\"Lb\" /* ɵɵdefineInjectable */]({ token: AuthGuardService, factory: AuthGuardService.ɵfac, providedIn: 'root' });\n    return AuthGuardService;\n}());\n\n\n// CONCATENATED MODULE: ./src/app/components/post/posts.module.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar routes = [\n    { path: '', component: post_list_component_PostListComponent },\n    { path: 'dashboard', component: post_dashboard_component_PostDashboardComponent, canActivate: [auth_guard_service_AuthGuardService] },\n    { path: ':id', component: post_detail_component_PostDetailComponent },\n];\nvar posts_module_PostsModule = /** @class */ /*@__PURE__*/ (function () {\n    function PostsModule() {\n    }\n    PostsModule.ɵmod = core[\"Nb\" /* ɵɵdefineNgModule */]({ type: PostsModule });\n    PostsModule.ɵinj = core[\"Mb\" /* ɵɵdefineInjector */]({ factory: function PostsModule_Factory(t) { return new (t || PostsModule)(); }, providers: [post_service_PostService], imports: [[\n                router[\"f\" /* RouterModule */].forChild(routes), common[\"c\" /* CommonModule */],\n                card[\"e\" /* MatCardModule */],\n                fesm2015_button[\"b\" /* MatButtonModule */],\n                card[\"e\" /* MatCardModule */],\n                expansion[\"b\" /* MatExpansionModule */],\n                progress_bar[\"b\" /* MatProgressBarModule */],\n                icon[\"b\" /* MatIconModule */],\n                input[\"b\" /* MatInputModule */],\n                toolbar[\"a\" /* MatToolbarModule */],\n                fesm2015_forms[\"d\" /* FormsModule */]\n            ]] });\n    return PostsModule;\n}());\n\n\n\n/***/ })\n\n}]);","inputSourceMap":null}